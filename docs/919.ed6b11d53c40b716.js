"use strict";(self.webpackChunktodo_ngrx=self.webpackChunktodo_ngrx||[]).push([[919],{1076:(uo,pn,fe)=>{fe.d(pn,{Am:()=>us,Bd:()=>ne,FA:()=>je,Fy:()=>Or,I9:()=>_n,Im:()=>St,Ku:()=>mr,Ll:()=>ft,T9:()=>dt,Uj:()=>$e,XA:()=>Ze,ZQ:()=>Te,bD:()=>hr,cY:()=>Fe,eX:()=>ur,g:()=>Be,gR:()=>Ai,hp:()=>Lr,jZ:()=>Ue,lT:()=>Gt,lV:()=>mn,mS:()=>Ke,nr:()=>Dn,p7:()=>Et,sr:()=>At,tD:()=>yn,u:()=>te,zW:()=>jn,zw:()=>Ie});const Y=function(P){const R=[];let x=0;for(let Q=0;Q<P.length;Q++){let q=P.charCodeAt(Q);q<128?R[x++]=q:q<2048?(R[x++]=q>>6|192,R[x++]=63&q|128):55296==(64512&q)&&Q+1<P.length&&56320==(64512&P.charCodeAt(Q+1))?(q=65536+((1023&q)<<10)+(1023&P.charCodeAt(++Q)),R[x++]=q>>18|240,R[x++]=q>>12&63|128,R[x++]=q>>6&63|128,R[x++]=63&q|128):(R[x++]=q>>12|224,R[x++]=q>>6&63|128,R[x++]=63&q|128)}return R},Lt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(P,R){if(!Array.isArray(P))throw Error("encodeByteArray takes an array as a parameter");this.init_();const x=R?this.byteToCharMapWebSafe_:this.byteToCharMap_,Q=[];for(let q=0;q<P.length;q+=3){const ce=P[q],ve=q+1<P.length,xe=ve?P[q+1]:0,Ct=q+2<P.length,et=Ct?P[q+2]:0;let Nt=(15&xe)<<2|et>>6,kn=63&et;Ct||(kn=64,ve||(Nt=64)),Q.push(x[ce>>2],x[(3&ce)<<4|xe>>4],x[Nt],x[kn])}return Q.join("")},encodeString(P,R){return this.HAS_NATIVE_SUPPORT&&!R?btoa(P):this.encodeByteArray(Y(P),R)},decodeString(P,R){return this.HAS_NATIVE_SUPPORT&&!R?atob(P):function(P){const R=[];let x=0,Q=0;for(;x<P.length;){const q=P[x++];if(q<128)R[Q++]=String.fromCharCode(q);else if(q>191&&q<224){const ce=P[x++];R[Q++]=String.fromCharCode((31&q)<<6|63&ce)}else if(q>239&&q<365){const Ct=((7&q)<<18|(63&P[x++])<<12|(63&P[x++])<<6|63&P[x++])-65536;R[Q++]=String.fromCharCode(55296+(Ct>>10)),R[Q++]=String.fromCharCode(56320+(1023&Ct))}else{const ce=P[x++],ve=P[x++];R[Q++]=String.fromCharCode((15&q)<<12|(63&ce)<<6|63&ve)}}return R.join("")}(this.decodeStringToByteArray(P,R))},decodeStringToByteArray(P,R){this.init_();const x=R?this.charToByteMapWebSafe_:this.charToByteMap_,Q=[];for(let q=0;q<P.length;){const ce=x[P.charAt(q++)],xe=q<P.length?x[P.charAt(q)]:0;++q;const et=q<P.length?x[P.charAt(q)]:64;++q;const be=q<P.length?x[P.charAt(q)]:64;if(++q,null==ce||null==xe||null==et||null==be)throw new Dt;Q.push(ce<<2|xe>>4),64!==et&&(Q.push(xe<<4&240|et>>2),64!==be&&Q.push(et<<6&192|be))}return Q},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let P=0;P<this.ENCODED_VALS.length;P++)this.byteToCharMap_[P]=this.ENCODED_VALS.charAt(P),this.charToByteMap_[this.byteToCharMap_[P]]=P,this.byteToCharMapWebSafe_[P]=this.ENCODED_VALS_WEBSAFE.charAt(P),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[P]]=P,P>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(P)]=P,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(P)]=P)}}};class Dt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $e=function(P){return function(P){const R=Y(P);return Lt.encodeByteArray(R,!0)}(P).replace(/\./g,"")},te=function(P){try{return Lt.decodeString(P,!0)}catch(R){console.error("base64Decode failed: ",R)}return null};function Ie(P,R){if(!(R instanceof Object))return R;switch(R.constructor){case Date:return new Date(R.getTime());case Object:void 0===P&&(P={});break;case Array:P=[];break;default:return R}for(const x in R)!R.hasOwnProperty(x)||!Le(x)||(P[x]=Ie(P[x],R[x]));return P}function Le(P){return"__proto__"!==P}function Ke(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const ke=()=>{try{return Ke().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const P=process.env.__FIREBASE_DEFAULTS__;return P?JSON.parse(P):void 0})()||(()=>{if(typeof document>"u")return;let P;try{P=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const R=P&&te(P[1]);return R&&JSON.parse(R)})()}catch(P){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${P}`)}},dt=()=>{var P;return null===(P=ke())||void 0===P?void 0:P.config},Ze=P=>{var R;return null===(R=ke())||void 0===R?void 0:R[`_${P}`]};class Fe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((R,x)=>{this.resolve=R,this.reject=x})}wrapCallback(R){return(x,Q)=>{x?this.reject(x):this.resolve(Q),"function"==typeof R&&(this.promise.catch(()=>{}),1===R.length?R(x):R(x,Q))}}}function Or(P,R){if(P.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const Q=R||"demo-project",q=P.iat||0,ce=P.sub||P.user_id;if(!ce)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const ve=Object.assign({iss:`https://securetoken.google.com/${Q}`,aud:Q,iat:q,exp:q+3600,auth_time:q,sub:ce,user_id:ce,firebase:{sign_in_provider:"custom",identities:{}}},P);return[$e(JSON.stringify({alg:"none",type:"JWT"})),$e(JSON.stringify(ve)),""].join(".")}function Te(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ue(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Te())}function ft(){var P;const R=null===(P=ke())||void 0===P?void 0:P.forceEnvironment;if("node"===R)return!0;if("browser"===R)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function ne(){return typeof window<"u"||Et()}function Et(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function At(){const P="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof P&&void 0!==P.id}function mn(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Gt(){const P=Te();return P.indexOf("MSIE ")>=0||P.indexOf("Trident/")>=0}function Dn(){return!ft()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jn(){try{return"object"==typeof indexedDB}catch{return!1}}function ur(){return new Promise((P,R)=>{try{let x=!0;const Q="validate-browser-context-for-indexeddb-analytics-module",q=self.indexedDB.open(Q);q.onsuccess=()=>{q.result.close(),x||self.indexedDB.deleteDatabase(Q),P(!0)},q.onupgradeneeded=()=>{x=!1},q.onerror=()=>{var ce;R((null===(ce=q.error)||void 0===ce?void 0:ce.message)||"")}}catch(x){R(x)}})}class Be extends Error{constructor(R,x,Q){super(x),this.code=R,this.customData=Q,this.name="FirebaseError",Object.setPrototypeOf(this,Be.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,je.prototype.create)}}class je{constructor(R,x,Q){this.service=R,this.serviceName=x,this.errors=Q}create(R,...x){const Q=x[0]||{},q=`${this.service}/${R}`,ce=this.errors[R],ve=ce?function cr(P,R){return P.replace(vi,(x,Q)=>{const q=R[Q];return null!=q?String(q):`<${Q}?>`})}(ce,Q):"Error";return new Be(q,`${this.serviceName}: ${ve} (${q}).`,Q)}}const vi=/\{\$([^}]+)}/g;function Ai(P,R){return Object.prototype.hasOwnProperty.call(P,R)}function St(P){for(const R in P)if(Object.prototype.hasOwnProperty.call(P,R))return!1;return!0}function hr(P,R){if(P===R)return!0;const x=Object.keys(P),Q=Object.keys(R);for(const q of x){if(!Q.includes(q))return!1;const ce=P[q],ve=R[q];if(dr(ce)&&dr(ve)){if(!hr(ce,ve))return!1}else if(ce!==ve)return!1}for(const q of Q)if(!x.includes(q))return!1;return!0}function dr(P){return null!==P&&"object"==typeof P}function us(P){const R=[];for(const[x,Q]of Object.entries(P))Array.isArray(Q)?Q.forEach(q=>{R.push(encodeURIComponent(x)+"="+encodeURIComponent(q))}):R.push(encodeURIComponent(x)+"="+encodeURIComponent(Q));return R.length?"&"+R.join("&"):""}function _n(P){const R={};return P.replace(/^\?/,"").split("&").forEach(Q=>{if(Q){const[q,ce]=Q.split("=");R[decodeURIComponent(q)]=decodeURIComponent(ce)}}),R}function Lr(P){const R=P.indexOf("?");if(!R)return"";const x=P.indexOf("#",R);return P.substring(R,x>0?x:void 0)}function yn(P,R){const x=new on(P,R);return x.subscribe.bind(x)}class on{constructor(R,x){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=x,this.task.then(()=>{R(this)}).catch(Q=>{this.error(Q)})}next(R){this.forEachObserver(x=>{x.next(R)})}error(R){this.forEachObserver(x=>{x.error(R)}),this.close(R)}complete(){this.forEachObserver(R=>{R.complete()}),this.close()}subscribe(R,x,Q){let q;if(void 0===R&&void 0===x&&void 0===Q)throw new Error("Missing Observer.");q=function cs(P,R){if("object"!=typeof P||null===P)return!1;for(const x of R)if(x in P&&"function"==typeof P[x])return!0;return!1}(R,["next","error","complete"])?R:{next:R,error:x,complete:Q},void 0===q.next&&(q.next=wn),void 0===q.error&&(q.error=wn),void 0===q.complete&&(q.complete=wn);const ce=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?q.error(this.finalError):q.complete()}catch{}}),this.observers.push(q),ce}unsubscribeOne(R){void 0===this.observers||void 0===this.observers[R]||(delete this.observers[R],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(R){if(!this.finalized)for(let x=0;x<this.observers.length;x++)this.sendOne(x,R)}sendOne(R,x){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[R])try{x(this.observers[R])}catch(Q){typeof console<"u"&&console.error&&console.error(Q)}})}close(R){this.finalized||(this.finalized=!0,void 0!==R&&(this.finalError=R),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wn(){}function mr(P){return P&&P._delegate?P._delegate:P}},919:(uo,pn,fe)=>{fe.r(pn),fe.d(pn,{AuthComponent:()=>VI});var v=fe(3953),Re=fe(177),pe=fe(7852);(0,pe.registerVersion)("firebase","10.13.1","app");var Lt=fe(7242),Dt=fe(3236),xn=fe(8141),$e=fe(6745),te=fe(941);class Vt{constructor(){return(r=>{const t=(0,pe.getApps)(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(c=>{n.includes(c)||n.push(c)})}),n})(Xe)}}const Xe="app-check";function we(){}class ke{zone;delegate;constructor(e,t=Lt.T){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const i=this.zone;return this.delegate.schedule(function(c){i.runGuarded(()=>{e.apply(this,[c])})},t,n)}}class Mt{zone;task=null;constructor(e){this.zone=e}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",we,{},we,we)),t.pipe((0,xn.M)({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let zt=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new ke(Zone.current)),this.insideAngular=t.run(()=>new ke(Zone.current,Dt.E)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)(v.KVO(v.SKi))};static \u0275prov=v.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Ue(r){return function ft(r){return function(t){return(t=t.lift(new Mt(r.ngZone))).pipe((0,$e._)(r.outsideAngular),(0,te.Q)(r.insideAngular))}}(function dt(){const r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return r}())(r)}var At=fe(3345);At.A.registerVersion("firebase","10.13.1","app-compat");const Gt=["ngOnDestroy"];class Dn{constructor(e){return e}}const jn=new v.nKC("angularfire2.app.options"),ur=new v.nKC("angularfire2.app.name");function Ii(r,e,t){const i="object"==typeof t&&t||{};i.name=i.name||"string"==typeof t&&t||"[DEFAULT]";const c=At.A.apps.filter(d=>d&&d.name===i.name)[0]||e.runOutsideAngular(()=>At.A.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(c.options)){const d=!!module.hot;os("error",`${c.name} Firebase App already initialized with different options${d?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Dn(c)}const os=(r,...e)=>{(0,v.naY)()&&typeof console<"u"&&console[r](...e)};function cr(r,e,t,n,i){const[,o,c]=globalThis.\u0275AngularfireInstanceCache.find(d=>d[0]===r)||[];if(o)return function vi(r,e){try{return r.toString()===e.toString()}catch{return r===e}}(i,c)||(nn("error",`${e} was already initialized on the ${t} Firebase App with different settings.${lr?" You may need to reload as Firebase is not HMR aware.":""}`),nn("warn",{is:i,was:c})),o;{const d=n();return globalThis.\u0275AngularfireInstanceCache.push([r,d,i]),d}}const lr=typeof module<"u"&&!!module.hot,nn=(r,...e)=>{(0,v.naY)()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[],fe(3200);var as=fe(1413),Gn=fe(7673),Ei=fe(1985),rn=fe(8455),Ai=fe(7786),gn=fe(5558),St=fe(6354),ho=fe(2771),hr=fe(7647);function dr(r,e,t){let n,i=!1;return r&&"object"==typeof r?({bufferSize:n=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=r):n=r??1/0,(0,hr.u)({connector:()=>new ho.m(n,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var Ti=fe(1594),us=fe(8071);function _n(r,e){return(0,us.T)(e)?(0,gn.n)(()=>r,e):(0,gn.n)(()=>r)}var Lr=fe(5964);const yn=new v.nKC("angularfire2.auth.use-emulator"),on=new v.nKC("angularfire2.auth.settings"),Tn=new v.nKC("angularfire2.auth.tenant-id"),cs=new v.nKC("angularfire2.auth.langugage-code"),wn=new v.nKC("angularfire2.auth.use-device-language"),fr=new v.nKC("angularfire.auth.persistence"),Vn=(r,e,t,n,i,o,c,d)=>cr(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{const f=e.runOutsideAngular(()=>r.auth());if(t&&f.useEmulator(...t),n&&(f.tenantId=n),f.languageCode=i,o&&f.useDeviceLanguage(),c)for(const[g,I]of Object.entries(c))f.settings[g]=I;return d&&f.setPersistence(d),f},[t,n,i,o,c,d]);let Nn=(()=>{class r{authState;idToken;user;idTokenResult;credential;constructor(t,n,i,o,c,d,f,g,I,A,S,U){const X=new as.B,re=(0,Gn.of)(void 0).pipe((0,te.Q)(c.outsideAngular),(0,gn.n)(()=>o.runOutsideAngular(()=>Promise.resolve().then(fe.bind(fe,3200)))),(0,St.T)(()=>Ii(t,o,n)),(0,St.T)(Z=>Vn(Z,o,d,g,I,A,f,S)),dr({bufferSize:1,refCount:!1}));if((0,Re.Vy)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Gn.of)(null);else{re.pipe((0,Ti.$)()).subscribe();const Z=re.pipe((0,gn.n)(se=>se.getRedirectResult().then(ye=>ye,()=>null)),Ue,dr({bufferSize:1,refCount:!1})),de=re.pipe((0,gn.n)(se=>new Ei.c(ye=>({unsubscribe:o.runOutsideAngular(()=>se.onAuthStateChanged(Se=>ye.next(Se),Se=>ye.error(Se),()=>ye.complete()))})))),_e=re.pipe((0,gn.n)(se=>new Ei.c(ye=>({unsubscribe:o.runOutsideAngular(()=>se.onIdTokenChanged(Se=>ye.next(Se),Se=>ye.error(Se),()=>ye.complete()))}))));this.authState=Z.pipe(_n(de),(0,$e._)(c.outsideAngular),(0,te.Q)(c.insideAngular)),this.user=Z.pipe(_n(_e),(0,$e._)(c.outsideAngular),(0,te.Q)(c.insideAngular)),this.idToken=this.user.pipe((0,gn.n)(se=>se?(0,rn.H)(se.getIdToken()):(0,Gn.of)(null))),this.idTokenResult=this.user.pipe((0,gn.n)(se=>se?(0,rn.H)(se.getIdTokenResult()):(0,Gn.of)(null))),this.credential=(0,Ai.h)(Z,X,this.authState.pipe((0,Lr.p)(se=>!se))).pipe((0,St.T)(se=>se?.user?se:null),(0,$e._)(c.outsideAngular),(0,te.Q)(c.insideAngular))}return((r,e,t,n={})=>new Proxy(r,{get:(i,o)=>t.runOutsideAngular(()=>{if(r[o])return n?.spy?.get&&n.spy.get(o,r[o]),r[o];if(Gt.indexOf(o)>-1)return()=>{};const c=e.toPromise().then(d=>{const f=d?.[o];return"function"==typeof f?f.bind(d):f?.then?f.then(g=>t.run(()=>g)):t.run(()=>f)});return new Proxy(()=>{},{get:(d,f)=>c[f],apply:(d,f,g)=>c.then(I=>{const A=I?.(...g);return n?.spy?.apply&&n.spy.apply(o,g,A),A})})})}))(this,re,o,{spy:{apply:(Z,de,_e)=>{(Z.startsWith("signIn")||Z.startsWith("createUser"))&&_e.then(se=>X.next(se))}}})}static \u0275fac=function(n){return new(n||r)(v.KVO(jn),v.KVO(ur,8),v.KVO(v.Agw),v.KVO(v.SKi),v.KVO(zt),v.KVO(yn,8),v.KVO(on,8),v.KVO(Tn,8),v.KVO(cs,8),v.KVO(wn,8),v.KVO(fr,8),v.KVO(Vt,8))};static \u0275prov=v.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var Wt=fe(9172),wi=fe(9974),Ft=fe(4360);function Mr(){return(0,wi.N)((r,e)=>{let t,n=!1;r.subscribe((0,Ft._)(e,i=>{const o=t;t=i,n&&e.next([o,i]),n=!0}))})}var P,R,Wn=fe(2816),$n=fe(3294),H=fe(467),Ri=fe(1362),Ut=fe(8041),Me=fe(1076),pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mr={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(V,T,C){C||(C=0);var k=Array(16);if("string"==typeof T)for(var M=0;16>M;++M)k[M]=T.charCodeAt(C++)|T.charCodeAt(C++)<<8|T.charCodeAt(C++)<<16|T.charCodeAt(C++)<<24;else for(M=0;16>M;++M)k[M]=T[C++]|T[C++]<<8|T[C++]<<16|T[C++]<<24;var j=V.g[3],b=(T=V.g[0])+(j^(C=V.g[1])&((M=V.g[2])^j))+k[0]+3614090360&4294967295;b=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=(C=(M=(j=(T=C+(b<<7&4294967295|b>>>25))+((b=j+(M^T&(C^M))+k[1]+3905402710&4294967295)<<12&4294967295|b>>>20))+((b=M+(C^j&(T^C))+k[2]+606105819&4294967295)<<17&4294967295|b>>>15))+((b=C+(T^M&(j^T))+k[3]+3250441966&4294967295)<<22&4294967295|b>>>10))+((b=T+(j^C&(M^j))+k[4]+4118548399&4294967295)<<7&4294967295|b>>>25))+((b=j+(M^T&(C^M))+k[5]+1200080426&4294967295)<<12&4294967295|b>>>20))+((b=M+(C^j&(T^C))+k[6]+2821735955&4294967295)<<17&4294967295|b>>>15))+((b=C+(T^M&(j^T))+k[7]+4249261313&4294967295)<<22&4294967295|b>>>10))+((b=T+(j^C&(M^j))+k[8]+1770035416&4294967295)<<7&4294967295|b>>>25))+((b=j+(M^T&(C^M))+k[9]+2336552879&4294967295)<<12&4294967295|b>>>20))+((b=M+(C^j&(T^C))+k[10]+4294925233&4294967295)<<17&4294967295|b>>>15))+((b=C+(T^M&(j^T))+k[11]+2304563134&4294967295)<<22&4294967295|b>>>10))+((b=T+(j^C&(M^j))+k[12]+1804603682&4294967295)<<7&4294967295|b>>>25))+((b=j+(M^T&(C^M))+k[13]+4254626195&4294967295)<<12&4294967295|b>>>20))+((b=M+(C^j&(T^C))+k[14]+2792965006&4294967295)<<17&4294967295|b>>>15))+((b=C+(T^M&(j^T))+k[15]+1236535329&4294967295)<<22&4294967295|b>>>10))+((b=T+(M^j&(C^M))+k[1]+4129170786&4294967295)<<5&4294967295|b>>>27))+((b=j+(C^M&(T^C))+k[6]+3225465664&4294967295)<<9&4294967295|b>>>23))+((b=M+(T^C&(j^T))+k[11]+643717713&4294967295)<<14&4294967295|b>>>18))+((b=C+(j^T&(M^j))+k[0]+3921069994&4294967295)<<20&4294967295|b>>>12))+((b=T+(M^j&(C^M))+k[5]+3593408605&4294967295)<<5&4294967295|b>>>27))+((b=j+(C^M&(T^C))+k[10]+38016083&4294967295)<<9&4294967295|b>>>23))+((b=M+(T^C&(j^T))+k[15]+3634488961&4294967295)<<14&4294967295|b>>>18))+((b=C+(j^T&(M^j))+k[4]+3889429448&4294967295)<<20&4294967295|b>>>12))+((b=T+(M^j&(C^M))+k[9]+568446438&4294967295)<<5&4294967295|b>>>27))+((b=j+(C^M&(T^C))+k[14]+3275163606&4294967295)<<9&4294967295|b>>>23))+((b=M+(T^C&(j^T))+k[3]+4107603335&4294967295)<<14&4294967295|b>>>18))+((b=C+(j^T&(M^j))+k[8]+1163531501&4294967295)<<20&4294967295|b>>>12))+((b=T+(M^j&(C^M))+k[13]+2850285829&4294967295)<<5&4294967295|b>>>27))+((b=j+(C^M&(T^C))+k[2]+4243563512&4294967295)<<9&4294967295|b>>>23))+((b=M+(T^C&(j^T))+k[7]+1735328473&4294967295)<<14&4294967295|b>>>18))+((b=C+(j^T&(M^j))+k[12]+2368359562&4294967295)<<20&4294967295|b>>>12))+((b=T+(C^M^j)+k[5]+4294588738&4294967295)<<4&4294967295|b>>>28))+((b=j+(T^C^M)+k[8]+2272392833&4294967295)<<11&4294967295|b>>>21))+((b=M+(j^T^C)+k[11]+1839030562&4294967295)<<16&4294967295|b>>>16))+((b=C+(M^j^T)+k[14]+4259657740&4294967295)<<23&4294967295|b>>>9))+((b=T+(C^M^j)+k[1]+2763975236&4294967295)<<4&4294967295|b>>>28))+((b=j+(T^C^M)+k[4]+1272893353&4294967295)<<11&4294967295|b>>>21))+((b=M+(j^T^C)+k[7]+4139469664&4294967295)<<16&4294967295|b>>>16))+((b=C+(M^j^T)+k[10]+3200236656&4294967295)<<23&4294967295|b>>>9))+((b=T+(C^M^j)+k[13]+681279174&4294967295)<<4&4294967295|b>>>28))+((b=j+(T^C^M)+k[0]+3936430074&4294967295)<<11&4294967295|b>>>21))+((b=M+(j^T^C)+k[3]+3572445317&4294967295)<<16&4294967295|b>>>16))+((b=C+(M^j^T)+k[6]+76029189&4294967295)<<23&4294967295|b>>>9))+((b=T+(C^M^j)+k[9]+3654602809&4294967295)<<4&4294967295|b>>>28))+((b=j+(T^C^M)+k[12]+3873151461&4294967295)<<11&4294967295|b>>>21))+((b=M+(j^T^C)+k[15]+530742520&4294967295)<<16&4294967295|b>>>16))+((b=C+(M^j^T)+k[2]+3299628645&4294967295)<<23&4294967295|b>>>9))+((b=T+(M^(C|~j))+k[0]+4096336452&4294967295)<<6&4294967295|b>>>26))+((b=j+(C^(T|~M))+k[7]+1126891415&4294967295)<<10&4294967295|b>>>22))+((b=M+(T^(j|~C))+k[14]+2878612391&4294967295)<<15&4294967295|b>>>17))+((b=C+(j^(M|~T))+k[5]+4237533241&4294967295)<<21&4294967295|b>>>11))+((b=T+(M^(C|~j))+k[12]+1700485571&4294967295)<<6&4294967295|b>>>26))+((b=j+(C^(T|~M))+k[3]+2399980690&4294967295)<<10&4294967295|b>>>22))+((b=M+(T^(j|~C))+k[10]+4293915773&4294967295)<<15&4294967295|b>>>17))+((b=C+(j^(M|~T))+k[1]+2240044497&4294967295)<<21&4294967295|b>>>11))+((b=T+(M^(C|~j))+k[8]+1873313359&4294967295)<<6&4294967295|b>>>26))+((b=j+(C^(T|~M))+k[15]+4264355552&4294967295)<<10&4294967295|b>>>22))+((b=M+(T^(j|~C))+k[6]+2734768916&4294967295)<<15&4294967295|b>>>17))+((b=C+(j^(M|~T))+k[13]+1309151649&4294967295)<<21&4294967295|b>>>11))+((j=(T=C+((b=T+(M^(C|~j))+k[4]+4149444226&4294967295)<<6&4294967295|b>>>26))+((b=j+(C^(T|~M))+k[11]+3174756917&4294967295)<<10&4294967295|b>>>22))^((M=j+((b=M+(T^(j|~C))+k[2]+718787259&4294967295)<<15&4294967295|b>>>17))|~T))+k[9]+3951481745&4294967295,V.g[0]=V.g[0]+T&4294967295,V.g[1]=V.g[1]+(M+(b<<21&4294967295|b>>>11))&4294967295,V.g[2]=V.g[2]+M&4294967295,V.g[3]=V.g[3]+j&4294967295}function c(V,T){this.h=T;for(var C=[],k=!0,M=V.length-1;0<=M;M--){var j=0|V[M];k&&j==T||(C[M]=j,k=!1)}this.g=C}(function e(V,T){function C(){}C.prototype=T.prototype,V.D=T.prototype,V.prototype=new C,V.prototype.constructor=V,V.C=function(k,M,j){for(var b=Array(arguments.length-2),gi=2;gi<arguments.length;gi++)b[gi-2]=arguments[gi];return T.prototype[M].apply(k,b)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(V,T){void 0===T&&(T=V.length);for(var C=T-this.blockSize,k=this.B,M=this.h,j=0;j<T;){if(0==M)for(;j<=C;)i(this,V,j),j+=this.blockSize;if("string"==typeof V){for(;j<T;)if(k[M++]=V.charCodeAt(j++),M==this.blockSize){i(this,k),M=0;break}}else for(;j<T;)if(k[M++]=V[j++],M==this.blockSize){i(this,k),M=0;break}}this.h=M,this.o+=T},n.prototype.v=function(){var V=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);V[0]=128;for(var T=1;T<V.length-8;++T)V[T]=0;var C=8*this.o;for(T=V.length-8;T<V.length;++T)V[T]=255&C,C/=256;for(this.u(V),V=Array(16),T=C=0;4>T;++T)for(var k=0;32>k;k+=8)V[C++]=this.g[T]>>>k&255;return V};var d={};function f(V){return-128<=V&&128>V?function o(V,T){var C=d;return Object.prototype.hasOwnProperty.call(C,V)?C[V]:C[V]=T(V)}(V,function(T){return new c([0|T],0>T?-1:0)}):new c([0|V],0>V?-1:0)}function g(V){if(isNaN(V)||!isFinite(V))return A;if(0>V)return Z(g(-V));for(var T=[],C=1,k=0;V>=C;k++)T[k]=V/C|0,C*=4294967296;return new c(T,0)}var A=f(0),S=f(1),U=f(16777216);function X(V){if(0!=V.h)return!1;for(var T=0;T<V.g.length;T++)if(0!=V.g[T])return!1;return!0}function re(V){return-1==V.h}function Z(V){for(var T=V.g.length,C=[],k=0;k<T;k++)C[k]=~V.g[k];return new c(C,~V.h).add(S)}function de(V,T){return V.add(Z(T))}function _e(V,T){for(;(65535&V[T])!=V[T];)V[T+1]+=V[T]>>>16,V[T]&=65535,T++}function se(V,T){this.g=V,this.h=T}function ye(V,T){if(X(T))throw Error("division by zero");if(X(V))return new se(A,A);if(re(V))return T=ye(Z(V),T),new se(Z(T.g),Z(T.h));if(re(T))return T=ye(V,Z(T)),new se(Z(T.g),T.h);if(30<V.g.length){if(re(V)||re(T))throw Error("slowDivide_ only works with positive integers.");for(var C=S,k=T;0>=k.l(V);)C=Se(C),k=Se(k);var M=Ce(C,1),j=Ce(k,1);for(k=Ce(k,2),C=Ce(C,2);!X(k);){var b=j.add(k);0>=b.l(V)&&(M=M.add(C),j=b),k=Ce(k,1),C=Ce(C,1)}return T=de(V,M.j(T)),new se(M,T)}for(M=A;0<=V.l(T);){for(C=Math.max(1,Math.floor(V.m()/T.m())),k=48>=(k=Math.ceil(Math.log(C)/Math.LN2))?1:Math.pow(2,k-48),b=(j=g(C)).j(T);re(b)||0<b.l(V);)b=(j=g(C-=k)).j(T);X(j)&&(j=S),M=M.add(j),V=de(V,b)}return new se(M,V)}function Se(V){for(var T=V.g.length+1,C=[],k=0;k<T;k++)C[k]=V.i(k)<<1|V.i(k-1)>>>31;return new c(C,V.h)}function Ce(V,T){var C=T>>5;T%=32;for(var k=V.g.length-C,M=[],j=0;j<k;j++)M[j]=0<T?V.i(j+C)>>>T|V.i(j+C+1)<<32-T:V.i(j+C);return new c(M,V.h)}(r=c.prototype).m=function(){if(re(this))return-Z(this).m();for(var V=0,T=1,C=0;C<this.g.length;C++){var k=this.i(C);V+=(0<=k?k:4294967296+k)*T,T*=4294967296}return V},r.toString=function(V){if(2>(V=V||10)||36<V)throw Error("radix out of range: "+V);if(X(this))return"0";if(re(this))return"-"+Z(this).toString(V);for(var T=g(Math.pow(V,6)),C=this,k="";;){var M=ye(C,T).g,j=((0<(C=de(C,M.j(T))).g.length?C.g[0]:C.h)>>>0).toString(V);if(X(C=M))return j+k;for(;6>j.length;)j="0"+j;k=j+k}},r.i=function(V){return 0>V?0:V<this.g.length?this.g[V]:this.h},r.l=function(V){return re(V=de(this,V))?-1:X(V)?0:1},r.abs=function(){return re(this)?Z(this):this},r.add=function(V){for(var T=Math.max(this.g.length,V.g.length),C=[],k=0,M=0;M<=T;M++){var j=k+(65535&this.i(M))+(65535&V.i(M)),b=(j>>>16)+(this.i(M)>>>16)+(V.i(M)>>>16);k=b>>>16,C[M]=(b&=65535)<<16|(j&=65535)}return new c(C,-2147483648&C[C.length-1]?-1:0)},r.j=function(V){if(X(this)||X(V))return A;if(re(this))return re(V)?Z(this).j(Z(V)):Z(Z(this).j(V));if(re(V))return Z(this.j(Z(V)));if(0>this.l(U)&&0>V.l(U))return g(this.m()*V.m());for(var T=this.g.length+V.g.length,C=[],k=0;k<2*T;k++)C[k]=0;for(k=0;k<this.g.length;k++)for(var M=0;M<V.g.length;M++){var j=this.i(k)>>>16,b=65535&this.i(k),gi=V.i(M)>>>16,lc=65535&V.i(M);C[2*k+2*M]+=b*lc,_e(C,2*k+2*M),C[2*k+2*M+1]+=j*lc,_e(C,2*k+2*M+1),C[2*k+2*M+1]+=b*gi,_e(C,2*k+2*M+1),C[2*k+2*M+2]+=j*gi,_e(C,2*k+2*M+2)}for(k=0;k<T;k++)C[k]=C[2*k+1]<<16|C[2*k];for(k=T;k<2*T;k++)C[k]=0;return new c(C,0)},r.A=function(V){return ye(this,V).h},r.and=function(V){for(var T=Math.max(this.g.length,V.g.length),C=[],k=0;k<T;k++)C[k]=this.i(k)&V.i(k);return new c(C,this.h&V.h)},r.or=function(V){for(var T=Math.max(this.g.length,V.g.length),C=[],k=0;k<T;k++)C[k]=this.i(k)|V.i(k);return new c(C,this.h|V.h)},r.xor=function(V){for(var T=Math.max(this.g.length,V.g.length),C=[],k=0;k<T;k++)C[k]=this.i(k)^V.i(k);return new c(C,this.h^V.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,R=mr.Md5=n,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=g,c.fromString=function I(V,T){if(0==V.length)throw Error("number format error: empty string");if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if("-"==V.charAt(0))return Z(I(V.substring(1),T));if(0<=V.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=g(Math.pow(T,8)),k=A,M=0;M<V.length;M+=8){var j=Math.min(8,V.length-M),b=parseInt(V.substring(M,M+j),T);8>j?(j=g(Math.pow(T,j)),k=k.j(j).add(g(b))):k=(k=k.j(C)).add(g(b))}return k},P=mr.Integer=c}).apply(typeof pr<"u"?pr:typeof self<"u"?self:typeof window<"u"?window:{});var q,ce,ve,xe,Ct,et,_t,be,Nt,x=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Q={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(u,p,_){return u==Array.prototype||u==Object.prototype||(u[p]=_.value),u},n=function t(u){u=["object"==typeof globalThis&&globalThis,u,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof x&&x];for(var p=0;p<u.length;++p){var _=u[p];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}(this);!function i(u,p){if(p)e:{var _=n;u=u.split(".");for(var E=0;E<u.length-1;E++){var B=u[E];if(!(B in _))break e;_=_[B]}(p=p(E=_[u=u[u.length-1]]))!=E&&null!=p&&e(_,u,{configurable:!0,writable:!0,value:p})}}("Array.prototype.values",function(u){return u||function(){return function o(u,p){u instanceof String&&(u+="");var _=0,E=!1,B={next:function(){if(!E&&_<u.length){var W=_++;return{value:p(W,u[W]),done:!1}}return E=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}(this,function(p,_){return _})}});var c=c||{},d=this||self;function f(u){var p=typeof u;return"array"==(p="object"!=p?p:u?Array.isArray(u)?"array":p:"null")||"object"==p&&"number"==typeof u.length}function g(u){var p=typeof u;return"object"==p&&null!=u||"function"==p}function I(u,p,_){return u.call.apply(u.bind,arguments)}function A(u,p,_){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,E),u.apply(p,B)}}return function(){return u.apply(p,arguments)}}function S(u,p,_){return(S=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?I:A).apply(null,arguments)}function U(u,p){var _=Array.prototype.slice.call(arguments,1);return function(){var E=_.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function X(u,p){function _(){}_.prototype=p.prototype,u.aa=p.prototype,u.prototype=new _,u.prototype.constructor=u,u.Qb=function(E,B,W){for(var ue=Array(arguments.length-2),st=2;st<arguments.length;st++)ue[st-2]=arguments[st];return p.prototype[B].apply(E,ue)}}function re(u){const p=u.length;if(0<p){const _=Array(p);for(let E=0;E<p;E++)_[E]=u[E];return _}return[]}function Z(u,p){for(let _=1;_<arguments.length;_++){const E=arguments[_];if(f(E)){const B=u.length||0,W=E.length||0;u.length=B+W;for(let ue=0;ue<W;ue++)u[B+ue]=E[ue]}else u.push(E)}}function _e(u){return/^[\s\xa0]*$/.test(u)}function se(){var u=d.navigator;return u&&(u=u.userAgent)?u:""}function ye(u){return ye[" "](u),u}ye[" "]=function(){};var Se=!(-1==se().indexOf("Gecko")||-1!=se().toLowerCase().indexOf("webkit")&&-1==se().indexOf("Edge")||-1!=se().indexOf("Trident")||-1!=se().indexOf("MSIE")||-1!=se().indexOf("Edge"));function Ce(u,p,_){for(const E in u)p.call(_,u[E],E,u)}function T(u){const p={};for(const _ in u)p[_]=u[_];return p}const C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,p){let _,E;for(let B=1;B<arguments.length;B++){for(_ in E=arguments[B],E)u[_]=E[_];for(let W=0;W<C.length;W++)_=C[W],Object.prototype.hasOwnProperty.call(E,_)&&(u[_]=E[_])}}function M(u){var p=1;u=u.split(":");const _=[];for(;0<p&&u.length;)_.push(u.shift()),p--;return u.length&&_.push(u.join(":")),_}function j(u){d.setTimeout(()=>{throw u},0)}function b(){var u=fp;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}var lc=new class de{constructor(p,_){this.i=p,this.j=_,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}(()=>new NI,u=>u.reset());class NI{constructor(){this.next=this.g=this.h=null}set(p,_){this.h=p,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let hc,dc=!1,fp=new class gi{constructor(){this.h=this.g=null}add(p,_){const E=lc.get();E.set(p,_),this.h?this.h.next=E:this.g=E,this.h=E}},ug=()=>{const u=d.Promise.resolve(void 0);hc=()=>{u.then(kI)}};var kI=()=>{for(var u;u=b();){try{u.h.call(u.g)}catch(_){j(_)}var p=lc;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}dc=!1};function ns(){this.s=this.s,this.C=this.C}function Yt(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}ns.prototype.s=!1,ns.prototype.ma=function(){this.s||(this.s=!0,this.N())},ns.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Yt.prototype.h=function(){this.defaultPrevented=!0};var OI=function(){if(!d.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const _=()=>{};d.addEventListener("test",_,p),d.removeEventListener("test",_,p)}catch{}return u}();function fc(u,p){if(Yt.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var _=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(Se){e:{try{ye(p.nodeName);var B=!0;break e}catch{}B=!1}B||(p=null)}}else"mouseover"==_?p=u.fromElement:"mouseout"==_&&(p=u.toElement);this.relatedTarget=p,E?(this.clientX=void 0!==E.clientX?E.clientX:E.pageX,this.clientY=void 0!==E.clientY?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:LI[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&fc.aa.h.call(this)}}X(fc,Yt);var LI={2:"touch",3:"pen",4:"mouse"};fc.prototype.h=function(){fc.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var pc="closure_listenable_"+(1e6*Math.random()|0),MI=0;function FI(u,p,_,E,B){this.listener=u,this.proxy=null,this.src=p,this.type=_,this.capture=!!E,this.ha=B,this.key=++MI,this.da=this.fa=!1}function vh(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Eh(u){this.src=u,this.g={},this.h=0}function pp(u,p){var _=p.type;if(_ in u.g){var W,E=u.g[_],B=Array.prototype.indexOf.call(E,p,void 0);(W=0<=B)&&Array.prototype.splice.call(E,B,1),W&&(vh(p),0==u.g[_].length&&(delete u.g[_],u.h--))}}function mp(u,p,_,E){for(var B=0;B<u.length;++B){var W=u[B];if(!W.da&&W.listener==p&&W.capture==!!_&&W.ha==E)return B}return-1}Eh.prototype.add=function(u,p,_,E,B){var W=u.toString();(u=this.g[W])||(u=this.g[W]=[],this.h++);var ue=mp(u,p,E,B);return-1<ue?(p=u[ue],_||(p.fa=!1)):((p=new FI(p,this.src,W,!!E,B)).fa=_,u.push(p)),p};var gp="closure_lm_"+(1e6*Math.random()|0),_p={};function cg(u,p,_,E,B){if(E&&E.once)return hg(u,p,_,E,B);if(Array.isArray(p)){for(var W=0;W<p.length;W++)cg(u,p[W],_,E,B);return null}return _=Ep(_),u&&u[pc]?u.K(p,_,g(E)?!!E.capture:!!E,B):lg(u,p,_,!1,E,B)}function lg(u,p,_,E,B,W){if(!p)throw Error("Invalid event type");var ue=g(B)?!!B.capture:!!B,st=Ip(u);if(st||(u[gp]=st=new Eh(u)),(_=st.add(p,_,E,ue,W)).proxy)return _;if(E=function UI(){const p=BI;return function u(_){return p.call(u.src,u.listener,_)}}(),_.proxy=E,E.src=u,E.listener=_,u.addEventListener)OI||(B=ue),void 0===B&&(B=!1),u.addEventListener(p.toString(),E,B);else if(u.attachEvent)u.attachEvent(fg(p.toString()),E);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(E)}return _}function hg(u,p,_,E,B){if(Array.isArray(p)){for(var W=0;W<p.length;W++)hg(u,p[W],_,E,B);return null}return _=Ep(_),u&&u[pc]?u.L(p,_,g(E)?!!E.capture:!!E,B):lg(u,p,_,!0,E,B)}function dg(u,p,_,E,B){if(Array.isArray(p))for(var W=0;W<p.length;W++)dg(u,p[W],_,E,B);else E=g(E)?!!E.capture:!!E,_=Ep(_),u&&u[pc]?(u=u.i,(p=String(p).toString())in u.g&&-1<(_=mp(W=u.g[p],_,E,B))&&(vh(W[_]),Array.prototype.splice.call(W,_,1),0==W.length&&(delete u.g[p],u.h--))):u&&(u=Ip(u))&&(p=u.g[p.toString()],u=-1,p&&(u=mp(p,_,E,B)),(_=-1<u?p[u]:null)&&yp(_))}function yp(u){if("number"!=typeof u&&u&&!u.da){var p=u.src;if(p&&p[pc])pp(p.i,u);else{var _=u.type,E=u.proxy;p.removeEventListener?p.removeEventListener(_,E,u.capture):p.detachEvent?p.detachEvent(fg(_),E):p.addListener&&p.removeListener&&p.removeListener(E),(_=Ip(p))?(pp(_,u),0==_.h&&(_.src=null,p[gp]=null)):vh(u)}}}function fg(u){return u in _p?_p[u]:_p[u]="on"+u}function BI(u,p){if(u.da)u=!0;else{p=new fc(p,this);var _=u.listener,E=u.ha||u.src;u.fa&&yp(u),u=_.call(E,p)}return u}function Ip(u){return(u=u[gp])instanceof Eh?u:null}var vp="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ep(u){return"function"==typeof u?u:(u[vp]||(u[vp]=function(p){return u.handleEvent(p)}),u[vp])}function Xt(){ns.call(this),this.i=new Eh(this),this.M=this,this.F=null}function dn(u,p){var _,E=u.F;if(E)for(_=[];E;E=E.F)_.push(E);if(u=u.M,E=p.type||p,"string"==typeof p)p=new Yt(p,u);else if(p instanceof Yt)p.target=p.target||u;else{var B=p;k(p=new Yt(E,u),B)}if(B=!0,_)for(var W=_.length-1;0<=W;W--){var ue=p.g=_[W];B=Ah(ue,E,!0,p)&&B}if(B=Ah(ue=p.g=u,E,!0,p)&&B,B=Ah(ue,E,!1,p)&&B,_)for(W=0;W<_.length;W++)B=Ah(ue=p.g=_[W],E,!1,p)&&B}function Ah(u,p,_,E){if(!(p=u.i.g[String(p)]))return!0;p=p.concat();for(var B=!0,W=0;W<p.length;++W){var ue=p[W];if(ue&&!ue.da&&ue.capture==_){var st=ue.listener,jt=ue.ha||ue.src;ue.fa&&pp(u.i,ue),B=!1!==st.call(jt,E)&&B}}return B&&!E.defaultPrevented}function pg(u,p,_){if("function"==typeof u)_&&(u=S(u,_));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=S(u.handleEvent,u)}return 2147483647<Number(p)?-1:d.setTimeout(u,p||0)}function mg(u){u.g=pg(()=>{u.g=null,u.i&&(u.i=!1,mg(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}X(Xt,ns),Xt.prototype[pc]=!0,Xt.prototype.removeEventListener=function(u,p,_,E){dg(this,u,p,_,E)},Xt.prototype.N=function(){if(Xt.aa.N.call(this),this.i){var p,u=this.i;for(p in u.g){for(var _=u.g[p],E=0;E<_.length;E++)vh(_[E]);delete u.g[p],u.h--}}this.F=null},Xt.prototype.K=function(u,p,_,E){return this.i.add(String(u),p,!1,_,E)},Xt.prototype.L=function(u,p,_,E){return this.i.add(String(u),p,!0,_,E)};class qI extends ns{constructor(p,_){super(),this.m=p,this.l=_,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:mg(this)}N(){super.N(),this.g&&(d.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function mc(u){ns.call(this),this.h=u,this.g={}}X(mc,ns);var gg=[];function _g(u){Ce(u.g,function(p,_){this.g.hasOwnProperty(_)&&yp(p)},u),u.g={}}mc.prototype.N=function(){mc.aa.N.call(this),_g(this)},mc.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ap=d.JSON.stringify,KI=d.JSON.parse,jI=class{stringify(u){return d.JSON.stringify(u,void 0)}parse(u){return d.JSON.parse(u,void 0)}};function Tp(){}function Ig(){}Tp.prototype.h=null;var gc={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function wp(){Yt.call(this,"d")}function Rp(){Yt.call(this,"c")}X(wp,Yt),X(Rp,Yt);var io={},vg=null;function Th(){return vg=vg||new Xt}function Eg(u){Yt.call(this,io.La,u)}function _c(u){const p=Th();dn(p,new Eg(p))}function Ag(u,p){Yt.call(this,io.STAT_EVENT,u),this.stat=p}function fn(u){const p=Th();dn(p,new Ag(p,u))}function Tg(u,p){Yt.call(this,io.Ma,u),this.size=p}function yc(u,p){if("function"!=typeof u)throw Error("Fn must not be null and must be a function");return d.setTimeout(function(){u()},p)}function Ic(){this.g=!0}function Ma(u,p,_,E){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+function $I(u,p){if(!u.g)return p;if(!p)return null;try{var _=JSON.parse(p);if(_)for(u=0;u<_.length;u++)if(Array.isArray(_[u])){var E=_[u];if(!(2>E.length)){var B=E[1];if(Array.isArray(B)&&!(1>B.length)){var W=B[0];if("noop"!=W&&"stop"!=W&&"close"!=W)for(var ue=1;ue<B.length;ue++)B[ue]=""}}}return Ap(_)}catch{return p}}(u,_)+(E?" "+E:"")})}io.La="serverreachability",X(Eg,Yt),io.STAT_EVENT="statevent",X(Ag,Yt),io.Ma="timingevent",X(Tg,Yt),Ic.prototype.xa=function(){this.g=!1},Ic.prototype.info=function(){};var Sp,wh={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},wg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Rh(){}function rs(u,p,_,E){this.j=u,this.i=p,this.l=_,this.R=E||1,this.U=new mc(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Rg}function Rg(){this.i=null,this.g="",this.h=!1}X(Rh,Tp),Rh.prototype.g=function(){return new XMLHttpRequest},Rh.prototype.i=function(){return{}},Sp=new Rh;var Sg={},Pp={};function bp(u,p,_){u.L=1,u.v=Ch(_i(p)),u.m=_,u.P=!0,Pg(u,null)}function Pg(u,p){u.F=Date.now(),Sh(u),u.A=_i(u.v);var _=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),qg(_.i,"t",E),u.C=0,_=u.j.J,u.h=new Rg,u.g=s_(u.j,_?p:null,!u.m),0<u.O&&(u.M=new qI(S(u.Y,u,u.g),u.O)),p=u.U,_=u.g,E=u.ca;var B="readystatechange";Array.isArray(B)||(B&&(gg[0]=B.toString()),B=gg);for(var W=0;W<B.length;W++){var ue=cg(_,B[W],E||p.handleEvent,!1,p.h||p);if(!ue)break;p.g[ue.key]=ue}p=u.H?T(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),_c(),function zI(u,p,_,E,B,W){u.info(function(){if(u.g)if(W)for(var ue="",st=W.split("&"),jt=0;jt<st.length;jt++){var qe=st[jt].split("=");if(1<qe.length){var Zt=qe[0];qe=qe[1];var en=Zt.split("_");ue=2<=en.length&&"type"==en[1]?ue+(Zt+"=")+qe+"&":ue+(Zt+"=redacted&")}}else ue=null;else ue=W;return"XMLHTTP REQ ("+E+") [attempt "+B+"]: "+p+"\n"+_+"\n"+ue})}(u.i,u.u,u.A,u.l,u.R,u.m)}function bg(u){return!!u.g&&"GET"==u.u&&2!=u.L&&u.j.Ca}function HI(u,p){var _=u.C,E=p.indexOf("\n",_);return-1==E?Pp:(_=Number(p.substring(_,E)),isNaN(_)?Sg:(E+=1)+_>p.length?Pp:(p=p.slice(E,E+_),u.C=E+_,p))}function Sh(u){u.S=Date.now()+u.I,Cg(u,u.I)}function Cg(u,p){if(null!=u.B)throw Error("WatchDog timer not null");u.B=yc(S(u.ba,u),p)}function Cp(u){u.B&&(d.clearTimeout(u.B),u.B=null)}function vc(u){0==u.j.G||u.J||t_(u.j,u)}function so(u){Cp(u);var p=u.M;p&&"function"==typeof p.ma&&p.ma(),u.M=null,_g(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function xp(u,p){try{var _=u.j;if(0!=_.G&&(_.g==u||Dp(_.h,u)))if(!u.K&&Dp(_.h,u)&&3==_.G){try{var E=_.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&3==E.length){var B=E;if(0==B[0]){e:if(!_.u){if(_.g){if(!(_.g.F+3e3<u.F))break e;kh(_),Vh(_)}Op(_),fn(18)}}else _.za=B[1],0<_.za-_.T&&37500>B[2]&&_.F&&0==_.v&&!_.C&&(_.C=yc(S(_.Za,_),6e3));if(1>=Vg(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else ao(_,11)}else if((u.K||_.g==u)&&kh(_),!_e(p))for(B=_.Da.g.parse(p),p=0;p<B.length;p++){let qe=B[p];if(_.T=qe[0],qe=qe[1],2==_.G)if("c"==qe[0]){_.K=qe[1],_.ia=qe[2];const Zt=qe[3];null!=Zt&&(_.la=Zt,_.j.info("VER="+_.la));const en=qe[4];null!=en&&(_.Aa=en,_.j.info("SVER="+_.Aa));const Ba=qe[5];null!=Ba&&"number"==typeof Ba&&0<Ba&&(_.L=E=1.5*Ba,_.j.info("backChannelRequestTimeoutMs_="+E)),E=_;const or=u.g;if(or){const Lh=or.g?or.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lh){var W=E.h;W.g||-1==Lh.indexOf("spdy")&&-1==Lh.indexOf("quic")&&-1==Lh.indexOf("h2")||(W.j=W.l,W.g=new Set,W.h&&(Vp(W,W.h),W.h=null))}if(E.D){const Mp=or.g?or.g.getResponseHeader("X-HTTP-Session-Id"):null;Mp&&(E.ya=Mp,ht(E.I,E.D,Mp))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-u.F,_.j.info("Handshake RTT: "+_.R+"ms"));var ue=u;if((E=_).qa=i_(E,E.J?E.ia:null,E.W),ue.K){Ng(E.h,ue);var st=ue,jt=E.L;jt&&(st.I=jt),st.B&&(Cp(st),Sh(st)),E.g=ue}else Zg(E);0<_.i.length&&Nh(_)}else"stop"!=qe[0]&&"close"!=qe[0]||ao(_,7);else 3==_.G&&("stop"==qe[0]||"close"==qe[0]?"stop"==qe[0]?ao(_,7):kp(_):"noop"!=qe[0]&&_.l&&_.l.ta(qe),_.v=0)}_c()}catch{}}rs.prototype.ca=function(u){u=u.target;const p=this.M;p&&3==yi(u)?p.j():this.Y(u)},rs.prototype.Y=function(u){try{if(u==this.g)e:{const en=yi(this.g);var p=this.g.Ba();if(this.g.Z(),!(3>en)&&(3!=en||this.g&&(this.h.h||this.g.oa()||Hg(this.g)))){this.J||4!=en||7==p||_c(),Cp(this);var _=this.g.Z();this.X=_;t:if(bg(this)){var E=Hg(this.g);u="";var B=E.length,W=4==yi(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){so(this),vc(this);var ue="";break t}this.h.i=new d.TextDecoder}for(p=0;p<B;p++)this.h.h=!0,u+=this.h.i.decode(E[p],{stream:!(W&&p==B-1)});E.length=0,this.h.g+=u,this.C=0,ue=this.h.g}else ue=this.g.oa();if(this.o=200==_,function GI(u,p,_,E,B,W,ue){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+B+"]: "+p+"\n"+_+"\n"+W+" "+ue})}(this.i,this.u,this.A,this.l,this.R,en,_),this.o){if(this.T&&!this.K){t:{if(this.g){var st,jt=this.g;if((st=jt.g?jt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_e(st)){var qe=st;break t}}qe=null}if(!(_=qe)){this.o=!1,this.s=3,fn(12),so(this),vc(this);break e}Ma(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xp(this,_)}if(this.P){let or;for(_=!0;!this.J&&this.C<ue.length;){if(or=HI(this,ue),or==Pp){4==en&&(this.s=4,fn(14),_=!1),Ma(this.i,this.l,null,"[Incomplete Response]");break}if(or==Sg){this.s=4,fn(15),Ma(this.i,this.l,ue,"[Invalid Chunk]"),_=!1;break}Ma(this.i,this.l,or,null),xp(this,or)}if(bg(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=en||0!=ue.length||this.h.h||(this.s=1,fn(16),_=!1),this.o=this.o&&_,_){if(0<ue.length&&!this.W){this.W=!0;var Zt=this.j;Zt.g==this&&Zt.ba&&!Zt.M&&(Zt.j.info("Great, no buffering proxy detected. Bytes received: "+ue.length),Lp(Zt),Zt.M=!0,fn(11))}}else Ma(this.i,this.l,ue,"[Invalid Chunked Response]"),so(this),vc(this)}else Ma(this.i,this.l,ue,null),xp(this,ue);4==en&&so(this),this.o&&!this.J&&(4==en?t_(this.j,this):(this.o=!1,Sh(this)))}else(function hv(u){const p={};u=(u.g&&2<=yi(u)&&u.g.getAllResponseHeaders()||"").split("\r\n");for(let E=0;E<u.length;E++){if(_e(u[E]))continue;var _=M(u[E]);const B=_[0];if("string"!=typeof(_=_[1]))continue;_=_.trim();const W=p[B]||[];p[B]=W,W.push(_)}!function V(u,p){for(const _ in u)p.call(void 0,u[_],_,u)}(p,function(E){return E.join(", ")})})(this.g),400==_&&0<ue.indexOf("Unknown SID")?(this.s=3,fn(12)):(this.s=0,fn(13)),so(this),vc(this)}}}catch{}},rs.prototype.cancel=function(){this.J=!0,so(this)},rs.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(function WI(u,p){u.info(function(){return"TIMEOUT: "+p})}(this.i,this.A),2!=this.L&&(_c(),fn(17)),so(this),this.s=2,vc(this)):Cg(this,this.S-u)};var QI=class{constructor(u,p){this.g=u,this.map=p}};function xg(u){this.l=u||10,u=d.PerformanceNavigationTiming?0<(u=d.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(d.chrome&&d.chrome.loadTimes&&d.chrome.loadTimes()&&d.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Dg(u){return!!u.h||!!u.g&&u.g.size>=u.j}function Vg(u){return u.h?1:u.g?u.g.size:0}function Dp(u,p){return u.h?u.h==p:!!u.g&&u.g.has(p)}function Vp(u,p){u.g?u.g.add(p):u.h=p}function Ng(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}function kg(u){if(null!=u.h)return u.i.concat(u.h.D);if(null!=u.g&&0!==u.g.size){let p=u.i;for(const _ of u.g.values())p=p.concat(_.D);return p}return re(u.i)}function Og(u,p){if(u.forEach&&"function"==typeof u.forEach)u.forEach(p,void 0);else if(f(u)||"string"==typeof u)Array.prototype.forEach.call(u,p,void 0);else for(var _=function YI(u){if(u.na&&"function"==typeof u.na)return u.na();if(!u.V||"function"!=typeof u.V){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(f(u)||"string"==typeof u){var p=[];u=u.length;for(var _=0;_<u;_++)p.push(_);return p}p=[],_=0;for(const E in u)p[_++]=E;return p}}}(u),E=function JI(u){if(u.V&&"function"==typeof u.V)return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if("string"==typeof u)return u.split("");if(f(u)){for(var p=[],_=u.length,E=0;E<_;E++)p.push(u[E]);return p}for(E in p=[],_=0,u)p[_++]=u[E];return p}(u),B=E.length,W=0;W<B;W++)p.call(void 0,E[W],_&&_[W],u)}xg.prototype.cancel=function(){if(this.i=kg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const u of this.g.values())u.cancel();this.g.clear()}};var Lg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oo(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof oo){this.h=u.h,Ph(this,u.j),this.o=u.o,this.g=u.g,bh(this,u.s),this.l=u.l;var p=u.i,_=new Tc;_.i=p.i,p.g&&(_.g=new Map(p.g),_.h=p.h),Mg(this,_),this.m=u.m}else u&&(p=String(u).match(Lg))?(this.h=!1,Ph(this,p[1]||"",!0),this.o=Ec(p[2]||""),this.g=Ec(p[3]||"",!0),bh(this,p[4]),this.l=Ec(p[5]||"",!0),Mg(this,p[6]||"",!0),this.m=Ec(p[7]||"")):(this.h=!1,this.i=new Tc(null,this.h))}function _i(u){return new oo(u)}function Ph(u,p,_){u.j=_?Ec(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function bh(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Mg(u,p,_){p instanceof Tc?(u.i=p,function iv(u,p){p&&!u.j&&(is(u),u.i=null,u.g.forEach(function(_,E){var B=E.toLowerCase();E!=B&&(Ug(this,E),qg(this,B,_))},u)),u.j=p}(u.i,u.h)):(_||(p=Ac(p,nv)),u.i=new Tc(p,u.h))}function ht(u,p,_){u.i.set(p,_)}function Ch(u){return ht(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Ec(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ac(u,p,_){return"string"==typeof u?(u=encodeURI(u).replace(p,ZI),_&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function ZI(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}oo.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Ac(p,Fg,!0),":");var _=this.g;return(_||"file"==p)&&(u.push("//"),(p=this.o)&&u.push(Ac(p,Fg,!0),"@"),u.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(_=this.s)&&u.push(":",String(_))),(_=this.l)&&(this.g&&"/"!=_.charAt(0)&&u.push("/"),u.push(Ac(_,"/"==_.charAt(0)?tv:ev,!0))),(_=this.i.toString())&&u.push("?",_),(_=this.m)&&u.push("#",Ac(_,rv)),u.join("")};var Fg=/[#\/\?@]/g,ev=/[#\?:]/g,tv=/[#\?]/g,nv=/[#\?@]/g,rv=/#/g;function Tc(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function is(u){u.g||(u.g=new Map,u.h=0,u.i&&function XI(u,p){if(u){u=u.split("&");for(var _=0;_<u.length;_++){var E=u[_].indexOf("="),B=null;if(0<=E){var W=u[_].substring(0,E);B=u[_].substring(E+1)}else W=u[_];p(W,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}(u.i,function(p,_){u.add(decodeURIComponent(p.replace(/\+/g," ")),_)}))}function Ug(u,p){is(u),p=Fa(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Bg(u,p){return is(u),p=Fa(u,p),u.g.has(p)}function qg(u,p,_){Ug(u,p),0<_.length&&(u.i=null,u.g.set(Fa(u,p),re(_)),u.h+=_.length)}function Fa(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function ss(u,p,_,E,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),E(_)}catch{}}function av(){this.g=new jI}function uv(u,p,_){const E=_||"";try{Og(u,function(B,W){let ue=B;g(B)&&(ue=Ap(B)),p.push(E+W+"="+encodeURIComponent(ue))})}catch(B){throw p.push(E+"type="+encodeURIComponent("_badmap")),B}}function wc(u){this.l=u.Ub||null,this.j=u.eb||!1}function xh(u,p){Xt.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Kg(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}function Rc(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Sc(u)}function Sc(u){u.onreadystatechange&&u.onreadystatechange.call(u)}function jg(u){let p="";return Ce(u,function(_,E){p+=E,p+=":",p+=_,p+="\r\n"}),p}function Np(u,p,_){e:{for(E in _){var E=!1;break e}E=!0}E||(_=jg(_),"string"==typeof u?null!=_&&encodeURIComponent(String(_)):ht(u,p,_))}function vt(u){Xt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=Tc.prototype).add=function(u,p){is(this),this.i=null,u=Fa(this,u);var _=this.g.get(u);return _||this.g.set(u,_=[]),_.push(p),this.h+=1,this},r.forEach=function(u,p){is(this),this.g.forEach(function(_,E){_.forEach(function(B){u.call(p,B,E,this)},this)},this)},r.na=function(){is(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),_=[];for(let E=0;E<p.length;E++){const B=u[E];for(let W=0;W<B.length;W++)_.push(p[E])}return _},r.V=function(u){is(this);let p=[];if("string"==typeof u)Bg(this,u)&&(p=p.concat(this.g.get(Fa(this,u))));else{u=Array.from(this.g.values());for(let _=0;_<u.length;_++)p=p.concat(u[_])}return p},r.set=function(u,p){return is(this),this.i=null,Bg(this,u=Fa(this,u))&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},r.get=function(u,p){return u&&0<(u=this.V(u)).length?String(u[0]):p},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var _=0;_<p.length;_++){var E=p[_];const W=encodeURIComponent(String(E)),ue=this.V(E);for(E=0;E<ue.length;E++){var B=W;""!==ue[E]&&(B+="="+encodeURIComponent(String(ue[E]))),u.push(B)}}return this.i=u.join("&")},X(wc,Tp),wc.prototype.g=function(){return new xh(this.l,this.j)},wc.prototype.i=function(u){return function(){return u}}({}),X(xh,Xt),(r=xh.prototype).open=function(u,p){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Sc(this)},r.send=function(u){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||d).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rc(this)),this.readyState=0},r.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Sc(this)),this.g&&(this.readyState=3,Sc(this),this.g)))if("arraybuffer"===this.responseType)u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof d.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Kg(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Rc(this):Sc(this),3==this.readyState&&Kg(this)}},r.Ra=function(u){this.g&&(this.response=this.responseText=u,Rc(this))},r.Qa=function(u){this.g&&(this.response=u,Rc(this))},r.ga=function(){this.g&&Rc(this)},r.setRequestHeader=function(u,p){this.u.append(u,p)},r.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var _=p.next();!_.done;)u.push((_=_.value)[0]+": "+_[1]),_=p.next();return u.join("\r\n")},Object.defineProperty(xh.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(u){this.m=u?"include":"same-origin"}}),X(vt,Xt);var cv=/^https?$/i,lv=["POST","PUT"];function zg(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Gg(u),Dh(u)}function Gg(u){u.A||(u.A=!0,dn(u,"complete"),dn(u,"error"))}function Wg(u){if(u.h&&typeof c<"u"&&(!u.v[1]||4!=yi(u)||2!=u.Z()))if(u.u&&4==yi(u))pg(u.Ea,0,u);else if(dn(u,"readystatechange"),4==yi(u)){u.h=!1;try{const ue=u.Z();e:switch(ue){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var _;if(!(_=p)){var E;if(E=0===ue){var B=String(u.D).match(Lg)[1]||null;!B&&d.self&&d.self.location&&(B=d.self.location.protocol.slice(0,-1)),E=!cv.test(B?B.toLowerCase():"")}_=E}if(_)dn(u,"complete"),dn(u,"success");else{u.m=6;try{var W=2<yi(u)?u.g.statusText:""}catch{W=""}u.l=W+" ["+u.Z()+"]",Gg(u)}}finally{Dh(u)}}}function Dh(u,p){if(u.g){$g(u);const _=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||dn(u,"ready");try{_.onreadystatechange=E}catch{}}}function $g(u){u.I&&(d.clearTimeout(u.I),u.I=null)}function yi(u){return u.g?u.g.readyState:0}function Hg(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Pc(u,p,_){return _&&_.internalChannelParams&&_.internalChannelParams[u]||p}function Qg(u){this.Aa=0,this.i=[],this.j=new Ic,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Pc("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Pc("baseRetryDelayMs",5e3,u),this.cb=Pc("retryDelaySeedMs",1e4,u),this.Wa=Pc("forwardChannelMaxRetries",2,u),this.wa=Pc("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new xg(u&&u.concurrentRequestLimit),this.Da=new av,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function kp(u){if(Jg(u),3==u.G){var p=u.U++,_=_i(u.I);if(ht(_,"SID",u.K),ht(_,"RID",p),ht(_,"TYPE","terminate"),bc(u,_),(p=new rs(u,u.j,p)).L=2,p.v=Ch(_i(_)),_=!1,d.navigator&&d.navigator.sendBeacon)try{_=d.navigator.sendBeacon(p.v.toString(),"")}catch{}!_&&d.Image&&((new Image).src=p.v,_=!0),_||(p.g=s_(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Sh(p)}r_(u)}function Vh(u){u.g&&(Lp(u),u.g.cancel(),u.g=null)}function Jg(u){Vh(u),u.u&&(d.clearTimeout(u.u),u.u=null),kh(u),u.h.cancel(),u.s&&("number"==typeof u.s&&d.clearTimeout(u.s),u.s=null)}function Nh(u){if(!Dg(u.h)&&!u.s){u.s=!0;var p=u.Ga;hc||ug(),dc||(hc(),dc=!0),fp.add(p,u),u.B=0}}function Yg(u,p){var _;_=p?p.l:u.U++;const E=_i(u.I);ht(E,"SID",u.K),ht(E,"RID",_),ht(E,"AID",u.T),bc(u,E),u.m&&u.o&&Np(E,u.m,u.o),_=new rs(u,u.j,_,u.B+1),null===u.m&&(_.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Xg(u,_,1e3),_.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Vp(u.h,_),bp(_,E,p)}function bc(u,p){u.H&&Ce(u.H,function(_,E){ht(p,E,_)}),u.l&&Og({},function(_,E){ht(p,E,_)})}function Xg(u,p,_){_=Math.min(u.i.length,_);var E=u.l?S(u.l.Na,u.l,u):null;e:{var B=u.i;let W=-1;for(;;){const ue=["count="+_];-1==W?0<_?(W=B[0].g,ue.push("ofs="+W)):W=0:ue.push("ofs="+W);let st=!0;for(let jt=0;jt<_;jt++){let qe=B[jt].g;const Zt=B[jt].map;if(qe-=W,0>qe)W=Math.max(0,B[jt].g-100),st=!1;else try{uv(Zt,ue,"req"+qe+"_")}catch{E&&E(Zt)}}if(st){E=ue.join("&");break e}}}return u=u.i.splice(0,_),p.D=u,E}function Zg(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;hc||ug(),dc||(hc(),dc=!0),fp.add(p,u),u.v=0}}function Op(u){return!(u.g||u.u||3<=u.v||(u.Y++,u.u=yc(S(u.Fa,u),n_(u,u.v)),u.v++,0))}function Lp(u){null!=u.A&&(d.clearTimeout(u.A),u.A=null)}function e_(u){u.g=new rs(u,u.j,"rpc",u.Y),null===u.m&&(u.g.H=u.o),u.g.O=0;var p=_i(u.qa);ht(p,"RID","rpc"),ht(p,"SID",u.K),ht(p,"AID",u.T),ht(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&ht(p,"TO",u.ja),ht(p,"TYPE","xmlhttp"),bc(u,p),u.m&&u.o&&Np(p,u.m,u.o),u.L&&(u.g.I=u.L);var _=u.g;u=u.ia,_.L=1,_.v=Ch(_i(p)),_.m=null,_.P=!0,Pg(_,u)}function kh(u){null!=u.C&&(d.clearTimeout(u.C),u.C=null)}function t_(u,p){var _=null;if(u.g==p){kh(u),Lp(u),u.g=null;var E=2}else{if(!Dp(u.h,p))return;_=p.D,Ng(u.h,p),E=1}if(0!=u.G)if(p.o)if(1==E){_=p.m?p.m.length:0,p=Date.now()-p.F;var B=u.B;dn(E=Th(),new Tg(E,_)),Nh(u)}else Zg(u);else if(3==(B=p.s)||0==B&&0<p.X||!(1==E&&function dv(u,p){return!(Vg(u.h)>=u.h.j-(u.s?1:0)||(u.s?(u.i=p.D.concat(u.i),0):1==u.G||2==u.G||u.B>=(u.Va?0:u.Wa)||(u.s=yc(S(u.Ga,u,p),n_(u,u.B)),u.B++,0)))}(u,p)||2==E&&Op(u)))switch(_&&0<_.length&&(p=u.h,p.i=p.i.concat(_)),B){case 1:ao(u,5);break;case 4:ao(u,10);break;case 3:ao(u,6);break;default:ao(u,2)}}function n_(u,p){let _=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(_*=2),_*p}function ao(u,p){if(u.j.info("Error code "+p),2==p){var _=S(u.fb,u),E=u.Xa;const B=!E;E=new oo(E||"//www.google.com/images/cleardot.gif"),d.location&&"http"==d.location.protocol||Ph(E,"https"),Ch(E),B?function sv(u,p){const _=new Ic;if(d.Image){const E=new Image;E.onload=U(ss,_,"TestLoadImage: loaded",!0,p,E),E.onerror=U(ss,_,"TestLoadImage: error",!1,p,E),E.onabort=U(ss,_,"TestLoadImage: abort",!1,p,E),E.ontimeout=U(ss,_,"TestLoadImage: timeout",!1,p,E),d.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else p(!1)}(E.toString(),_):function ov(u,p){new Ic;const E=new AbortController,B=setTimeout(()=>{E.abort(),ss(0,0,!1,p)},1e4);fetch(u,{signal:E.signal}).then(W=>{clearTimeout(B),ss(0,0,!!W.ok,p)}).catch(()=>{clearTimeout(B),ss(0,0,!1,p)})}(E.toString(),_)}else fn(2);u.G=0,u.l&&u.l.sa(p),r_(u),Jg(u)}function r_(u){if(u.G=0,u.ka=[],u.l){const p=kg(u.h);(0!=p.length||0!=u.i.length)&&(Z(u.ka,p),Z(u.ka,u.i),u.h.i.length=0,re(u.i),u.i.length=0),u.l.ra()}}function i_(u,p,_){var E=_ instanceof oo?_i(_):new oo(_);if(""!=E.g)p&&(E.g=p+"."+E.g),bh(E,E.s);else{var B=d.location;E=B.protocol,p=p?p+"."+B.hostname:B.hostname,B=+B.port;var W=new oo(null);E&&Ph(W,E),p&&(W.g=p),B&&bh(W,B),_&&(W.l=_),E=W}return p=u.ya,(_=u.D)&&p&&ht(E,_,p),ht(E,"VER",u.la),bc(u,E),E}function s_(u,p,_){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return(p=new vt(u.Ca&&!u.pa?new wc({eb:_}):u.pa)).Ha(u.J),p}function o_(){}function Oh(){}function Cn(u,p){Xt.call(this),this.g=new Qg(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!_e(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!_e(p)&&(this.g.D=p,null!==(u=this.h)&&p in u&&p in(u=this.h)&&delete u[p]),this.j=new Ua(this)}function a_(u){wp.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const _ in p){u=_;break e}u=void 0}(this.i=u)&&(u=this.i,p=null!==p&&u in p?p[u]:void 0),this.data=p}else this.data=u}function u_(){Rp.call(this),this.status=1}function Ua(u){this.g=u}(r=vt.prototype).Ha=function(u){this.J=u},r.ea=function(u,p,_,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Sp.g(),this.v=function yg(u){return u.h||(u.h=u.i())}(this.o?this.o:Sp),this.g.onreadystatechange=S(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(W){return void zg(this,W)}if(u=_||"",_=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var B in E)_.set(B,E[B]);else{if("function"!=typeof E.keys||"function"!=typeof E.get)throw Error("Unknown input type for opt_headers: "+String(E));for(const W of E.keys())_.set(W,E.get(W))}E=Array.from(_.keys()).find(W=>"content-type"==W.toLowerCase()),B=d.FormData&&u instanceof d.FormData,!(0<=Array.prototype.indexOf.call(lv,p,void 0))||E||B||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[W,ue]of _)this.g.setRequestHeader(W,ue);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{$g(this),this.u=!0,this.g.send(u),this.u=!1}catch(W){zg(this,W)}},r.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,dn(this,"complete"),dn(this,"abort"),Dh(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Dh(this,!0)),vt.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Wg(this):this.bb())},r.bb=function(){Wg(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<yi(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&0==p.indexOf(u)&&(p=p.substring(u.length)),KI(p)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Qg.prototype).la=8,r.G=1,r.connect=function(u,p,_,E){fn(0),this.W=u,this.H=p||{},_&&void 0!==E&&(this.H.OSID=_,this.H.OAID=E),this.F=this.X,this.I=i_(this,null,this.W),Nh(this)},r.Ga=function(u){if(this.s)if(this.s=null,1==this.G){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const B=new rs(this,this.j,u);let W=this.o;if(this.S&&(W?(W=T(W),k(W,this.S)):W=this.S),null!==this.m||this.O||(B.H=W,W=null),this.P)e:{for(var p=0,_=0;_<this.i.length;_++){var E=this.i[_];if(void 0===(E="__data__"in E.map&&"string"==typeof(E=E.map.__data__)?E.length:void 0))break;if(4096<(p+=E)){p=_;break e}if(4096===p||_===this.i.length-1){p=_+1;break e}}p=1e3}else p=1e3;p=Xg(this,B,p),ht(_=_i(this.I),"RID",u),ht(_,"CVER",22),this.D&&ht(_,"X-HTTP-Session-Id",this.D),bc(this,_),W&&(this.O?p="headers="+encodeURIComponent(String(jg(W)))+"&"+p:this.m&&Np(_,this.m,W)),Vp(this.h,B),this.Ua&&ht(_,"TYPE","init"),this.P?(ht(_,"$req",p),ht(_,"SID","null"),B.T=!0,bp(B,_,null)):bp(B,_,p),this.G=2}}else 3==this.G&&(u?Yg(this,u):0==this.i.length||Dg(this.h)||Yg(this))},r.Fa=function(){if(this.u=null,e_(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=yc(S(this.ab,this),u)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,fn(10),Vh(this),e_(this))},r.Za=function(){null!=this.C&&(this.C=null,Vh(this),Op(this),fn(19))},r.fb=function(u){u?(this.j.info("Successfully pinged google.com"),fn(2)):(this.j.info("Failed to ping google.com"),fn(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=o_.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},Oh.prototype.g=function(u,p){return new Cn(u,p)},X(Cn,Xt),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){kp(this.g)},Cn.prototype.o=function(u){var p=this.g;if("string"==typeof u){var _={};_.__data__=u,u=_}else this.u&&((_={}).__data__=Ap(u),u=_);p.i.push(new QI(p.Ya++,u)),3==p.G&&Nh(p)},Cn.prototype.N=function(){this.g.l=null,delete this.j,kp(this.g),delete this.g,Cn.aa.N.call(this)},X(a_,wp),X(u_,Rp),X(Ua,o_),Ua.prototype.ua=function(){dn(this.g,"a")},Ua.prototype.ta=function(u){dn(this.g,new a_(u))},Ua.prototype.sa=function(u){dn(this.g,new u_)},Ua.prototype.ra=function(){dn(this.g,"b")},Oh.prototype.createWebChannel=Oh.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,Nt=Q.createWebChannelTransport=function(){return new Oh},be=Q.getStatEventTarget=function(){return Th()},_t=Q.Event=io,et=Q.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},wh.NO_ERROR=0,wh.TIMEOUT=8,wh.HTTP_ERROR=6,Ct=Q.ErrorCode=wh,wg.COMPLETE="complete",xe=Q.EventType=wg,Ig.EventType=gc,gc.OPEN="a",gc.CLOSE="b",gc.ERROR="c",gc.MESSAGE="d",Xt.prototype.listen=Xt.prototype.K,ve=Q.WebChannel=Ig,ce=Q.FetchXmlHttpFactory=wc,vt.prototype.listenOnce=vt.prototype.L,vt.prototype.getLastError=vt.prototype.Ka,vt.prototype.getLastErrorCode=vt.prototype.Ba,vt.prototype.getStatus=vt.prototype.Z,vt.prototype.getResponseJson=vt.prototype.Oa,vt.prototype.getResponseText=vt.prototype.oa,vt.prototype.send=vt.prototype.ea,vt.prototype.setWithCredentials=vt.prototype.Ha,q=Q.XhrIo=vt}).apply(typeof x<"u"?x:typeof self<"u"?self:typeof window<"u"?window:{});const kn="@firebase/firestore";class ct{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ct.UNAUTHENTICATED=new ct(null),ct.GOOGLE_CREDENTIALS=new ct("google-credentials-uid"),ct.FIRST_PARTY=new ct("first-party-uid"),ct.MOCK_USER=new ct("mock-user");let Hn="10.13.1";const In=new Ut.Vy("@firebase/firestore");function vn(){return In.logLevel}function ee(r,...e){if(In.logLevel<=Ut.$b.DEBUG){const t=e.map(L);In.debug(`Firestore (${Hn}): ${r}`,...t)}}function He(r,...e){if(In.logLevel<=Ut.$b.ERROR){const t=e.map(L);In.error(`Firestore (${Hn}): ${r}`,...t)}}function K(r,...e){if(In.logLevel<=Ut.$b.WARN){const t=e.map(L);In.warn(`Firestore (${Hn}): ${r}`,...t)}}function L(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function D(r="Unexpected state"){const e=`FIRESTORE (${Hn}) INTERNAL ASSERTION FAILED: `+r;throw He(e),new Error(e)}function G(r,e){r||D()}function J(r,e){return r}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $ extends Me.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Pe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $t{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ct.UNAUTHENTICATED))}shutdown(){}}class Qe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Cc{constructor(e){this.t=e,this.currentUser=ct.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const o=g=>this.i!==i?(i=this.i,t(g)):Promise.resolve();let c=new Pe;this.o=()=>{this.i++,this.currentUser=this.u(),c.resolve(),c=new Pe,e.enqueueRetryable(()=>o(this.currentUser))};const d=()=>{const g=c;e.enqueueRetryable((0,H.A)(function*(){yield g.promise,yield o(n.currentUser)}))},f=g=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=g,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(g=>f(g)),setTimeout(()=>{if(!this.auth){const g=this.t.getImmediate({optional:!0});g?f(g):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),c.resolve(),c=new Pe)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(G("string"==typeof n.accessToken),new $t(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return G(null===e||"string"==typeof e),new ct(e)}}class ls{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ct.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Mh{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new ls(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ct.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class mo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Fh{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=o=>{null!=o.error&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const c=o.token!==this.R;return this.R=o.token,ee("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const i=o=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.A.getImmediate({optional:!0});o?i(o):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G("string"==typeof t.token),this.R=t.token,new mo(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Uh(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class qa{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Uh(40);for(let o=0;o<i.length;++o)n.length<20&&i[o]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[o]%62))}return n}}function Ae(r,e){return r<e?-1:r>e?1:0}function Si(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function Ka(r){return r+"\0"}class nt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new $(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new $(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new $(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return nt.fromMillis(Date.now())}static fromDate(e){return nt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new nt(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ae(this.nanoseconds,e.nanoseconds):Ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class me{constructor(e){this.timestamp=e}static fromTimestamp(e){return new me(e)}static min(){return new me(new nt(0,0))}static max(){return new me(new nt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Qn{constructor(e,t,n){void 0===t?t=0:t>e.length&&D(),void 0===n?n=e.length-t:n>e.length-t&&D(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Qn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qn?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const o=e.get(i),c=t.get(i);if(o<c)return-1;if(o>c)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class De extends Qn{construct(e,t,n){return new De(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new $(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new De(t)}static emptyPath(){return new De([])}}const Bh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Je extends Qn{construct(e,t,n){return new Je(e,t,n)}static isValidIdentifier(e){return Bh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Je.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Je(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const o=()=>{if(0===n.length)throw new $(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let c=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new $(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new $(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=f,i+=2}else"`"===d?(c=!c,i++):"."!==d||c?(n+=d,i++):(o(),i++)}if(o(),c)throw new $(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Je(t)}static emptyPath(){return new Je([])}}class ae{constructor(e){this.path=e}static fromPath(e){return new ae(De.fromString(e))}static fromName(e){return new ae(De.fromString(e).popFirst(5))}static empty(){return new ae(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===De.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return De.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ae(new De(e.slice()))}}class Pi{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function go(r){return r.fields.find(e=>2===e.kind)}function gr(r){return r.fields.filter(e=>2!==e.kind)}Pi.UNKNOWN_ID=-1;class _r{constructor(e,t){this.fieldPath=e,this.kind=t}}class Rn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Rn(0,an.min())}}function ja(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=me.fromTimestamp(1e9===n?new nt(t+1,0):new nt(t,n));return new an(i,ae.empty(),e)}function _o(r){return new an(r.readTime,r.key,-1)}class an{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new an(me.min(),ae.empty(),-1)}static max(){return new an(me.max(),ae.empty(),-1)}}function hs(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=ae.comparator(r.documentKey,e.documentKey),0!==t?t:Ae(r.largestBatchId,e.largestBatchId))}const xc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function yr(r){return ds.apply(this,arguments)}function ds(){return(ds=(0,H.A)(function*(r){if(r.code!==N.FAILED_PRECONDITION||r.message!==xc)throw r;ee("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new F((n,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof F?t:F.resolve(t)}catch(t){return F.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):F.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):F.reject(t)}static resolve(e){return new F((t,n)=>{t(e)})}static reject(e){return new F((t,n)=>{n(e)})}static waitFor(e){return new F((t,n)=>{let i=0,o=0,c=!1;e.forEach(d=>{++i,d.next(()=>{++o,c&&o===i&&t()},f=>n(f))}),c=!0,o===i&&t()})}static or(e){let t=F.resolve(!1);for(const n of e)t=t.next(i=>i?F.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,o)=>{n.push(t.call(this,i,o))}),this.waitFor(n)}static mapArray(e,t){return new F((n,i)=>{const o=e.length,c=new Array(o);let d=0;for(let f=0;f<o;f++){const g=f;t(e[g]).next(I=>{c[g]=I,++d,d===o&&n(c)},I=>i(I))}})}static doWhile(e,t){return new F((n,i)=>{const o=()=>{!0===e()?t().next(()=>{o()},i):n()};o()})}}class bi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Pe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ur(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=Ga(n.target.error);this.V.reject(new Ur(e,i))}}static open(e,t,n,i){try{return new bi(t,e.transaction(i,n))}catch(o){throw new Ur(t,o)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ee("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new za(t)}}class un{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===un.S((0,Me.ZQ)())&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ee("SimpleDb","Removing database:",e),Br(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,Me.zW)())return!1;if(un.v())return!0;const e=(0,Me.ZQ)(),t=un.S(e),n=0<t&&t<10,i=Io(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||o)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,H.A)(function*(){return t.db||(ee("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const o=indexedDB.open(t.name,t.version);o.onsuccess=c=>{n(c.target.result)},o.onblocked=()=>{i(new Ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=c=>{const d=c.target.error;i("VersionError"===d.name?new $(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new $(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new Ur(e,d))},o.onupgradeneeded=c=>{ee("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',c.oldVersion),t.p.O(c.target.result,o.transaction,c.oldVersion,t.version).next(()=>{ee("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var o=this;return(0,H.A)(function*(){const c="readonly"===t;let d=0;for(;;){++d;try{o.db=yield o.M(e);const f=bi.open(o.db,e,c?"readonly":"readwrite",n),g=i(f).next(I=>(f.g(),I)).catch(I=>(f.abort(I),F.reject(I))).toPromise();return g.catch(()=>{}),yield f.m,g}catch(f){const g=f,I="FirebaseError"!==g.name&&d<3;if(ee("SimpleDb","Transaction failed with error:",g.message,"Retrying:",I),o.close(),!I)return Promise.reject(g)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Io(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class jh{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Br(this.B.delete())}}class Ur extends ${constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ir(r){return"IndexedDbTransactionError"===r.name}class za{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ee("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ee("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Br(n)}add(e){return ee("SimpleDb","ADD",this.store.name,e,e),Br(this.store.add(e))}get(e){return Br(this.store.get(e)).next(t=>(void 0===t&&(t=null),ee("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ee("SimpleDb","DELETE",this.store.name,e),Br(this.store.delete(e))}count(){return ee("SimpleDb","COUNT",this.store.name),Br(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const o=i.getAll(n.range);return new F((c,d)=>{o.onerror=f=>{d(f.target.error)},o.onsuccess=f=>{c(f.target.result)}})}{const o=this.cursor(n),c=[];return this.W(o,(d,f)=>{c.push(f)}).next(()=>c)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new F((i,o)=>{n.onerror=c=>{o(c.target.error)},n.onsuccess=c=>{i(c.target.result)}})}j(e,t){ee("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(o,c,d)=>d.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new F((n,i)=>{t.onerror=o=>{const c=Ga(o.target.error);i(c)},t.onsuccess=o=>{const c=o.target.result;c?e(c.primaryKey,c.value).next(d=>{d?c.continue():n()}):n()}})}W(e,t){const n=[];return new F((i,o)=>{e.onerror=c=>{o(c.target.error)},e.onsuccess=c=>{const d=c.target.result;if(!d)return void i();const f=new jh(d),g=t(d.primaryKey,d.value,f);if(g instanceof F){const I=g.catch(A=>(f.done(),F.reject(A)));n.push(I)}f.isDone?i():null===f.K?d.continue():d.continue(f.K)}}).next(()=>F.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Br(r){return new F((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=Ga(n.target.error);t(i)}})}let vo=!1;function Ga(r){const e=un.S((0,Me.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new $("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return vo||(vo=!0,setTimeout(()=>{throw n},0)),n}}return r}class Wa{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;ee("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,H.A)(function*(){t.task=null;try{ee("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){Ir(n)?ee("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield yr(n)}yield t.X(6e4)}))}}class zh{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,H.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,o=!0;return F.doWhile(()=>!0===o&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(c=>{if(null!==c&&!n.has(c))return ee("IndexBackfiller",`Processing collection: ${c}`),this.ne(e,c,i).next(d=>{i-=d,n.add(c)});o=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(o=>{const c=o.changes;return this.localStore.indexManager.updateIndexEntries(e,c).next(()=>this.re(i,o)).next(d=>(ee("IndexBackfiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>c.size)}))}re(e,t){let n=e;return t.changes.forEach((i,o)=>{const c=_o(o);hs(c,n)>0&&(n=c)}),new an(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Bt=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function fs(r){return null==r}function qr(r){return 0===r&&1/r==-1/0}function Ci(r){return"number"==typeof r&&Number.isInteger(r)&&!qr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function ot(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Dc(e)),e=$a(r.get(t),e);return Dc(e)}function $a(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const o=r.charAt(i);switch(o){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=o}}return t}function Dc(r){return r+"\x01\x01"}function Tt(r){const e=r.length;if(G(e>=2),2===e)return G("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),De.emptyPath();const t=e-2,n=[];let i="";for(let o=0;o<e;){const c=r.indexOf("\x01",o);switch((c<0||c>t)&&D(),r.charAt(c+1)){case"\x01":const d=r.substring(o,c);let f;0===i.length?f=d:(i+=d,f=i,i=""),n.push(f);break;case"\x10":i+=r.substring(o,c),i+="\0";break;case"\x11":i+=r.substring(o,c+1);break;default:D()}o=c+2}return new De(n)}const Vc=["userId","batchId"];function xi(r,e){return[r,ot(e)]}function Nc(r,e,t){return[r,ot(e),t]}const Ha={},Gh=["prefixPath","collectionGroup","readTime","documentId"],Qa=["prefixPath","collectionGroup","documentId"],Wh=["collectionGroup","readTime","prefixPath","documentId"],$h=["canonicalId","targetId"],Ja=["targetId","path"],Kr=["path","targetId"],Hh=["collectionId","parent"],Qh=["indexId","uid"],ps=["uid","sequenceNumber"],Up=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ya=["indexId","uid","orderedDocumentKey"],Jn=["userId","collectionPath","documentId"],Di=["userId","collectionPath","largestBatchId"],Vi=["userId","collectionGroup","largestBatchId"],Xa=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],kc=[...Xa,"documentOverlays"],Za=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Oc=Za,vr=[...Oc,"indexConfiguration","indexState","indexEntries"],Jh=vr,Eo=[...vr,"globals"];class Ao extends yo{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function yt(r,e){const t=J(r);return un.F(t._e,e)}function To(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function wt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Lc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class We{constructor(e,t){this.comparator=e,this.root=t||Pt.EMPTY}insert(e,t){return new We(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pt.BLACK,null,null))}remove(e){return new We(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new jr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new jr(this.root,e,this.comparator,!1)}getReverseIterator(){return new jr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new jr(this.root,e,this.comparator,!0)}}class jr{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pt{constructor(e,t,n,i,o){this.key=e,this.value=t,this.color=n??Pt.RED,this.left=i??Pt.EMPTY,this.right=o??Pt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,o){return new Pt(e??this.key,t??this.value,n??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const o=n(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===o?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Pt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Pt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();const e=this.left.check();if(e!==this.right.check())throw D();return e+(this.isRed()?0:1)}}Pt.EMPTY=null,Pt.RED=!0,Pt.BLACK=!1,Pt.EMPTY=new class{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(e,t,n,i,o){return this}insert(e,t,n){return new Pt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ze{constructor(e){this.comparator=e,this.data=new We(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Mc(this.data.getIterator())}getIteratorFrom(e){return new Mc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ze)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(0!==this.comparator(i,o))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ze(this.comparator);return t.data=e,t}}class Mc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Er(r){return r.hasNext()?r.getNext():void 0}class kt{constructor(e){this.fields=e,e.sort(Je.comparator)}static empty(){return new kt([])}unionWith(e){let t=new ze(Je.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new kt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Si(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class wo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class at{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new wo("Invalid base64 string: "+o):o}}(e);return new at(t)}static fromUint8Array(e){const t=function(i){let o="";for(let c=0;c<i.length;++c)o+=String.fromCharCode(i[c]);return o}(e);return new at(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}at.EMPTY_BYTE_STRING=new at("");const Fc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sn(r){if(G(!!r),"string"==typeof r){let e=0;const t=Fc.exec(r);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:rt(r.seconds),nanos:rt(r.nanos)}}function rt(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Pn(r){return"string"==typeof r?at.fromBase64String(r):at.fromUint8Array(r)}function zr(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ni(r){const e=r.mapValue.fields.__previous_value__;return zr(e)?Ni(e):e}function ki(r){const e=Sn(r.mapValue.fields.__local_write_time__.timestampValue);return new nt(e.seconds,e.nanos)}class tu{constructor(e,t,n,i,o,c,d,f,g){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=o,this.forceLongPolling=c,this.autoDetectLongPolling=d,this.longPollingOptions=f,this.useFetchStreams=g}}class Yn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Yn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Yn&&e.projectId===this.projectId&&e.database===this.database}}const On={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},So={nullValue:"NULL_VALUE"};function Ln(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?zr(r)?4:Bc(r)?9007199254740991:ys(r)?10:11:D()}function Mn(r,e){if(r===e)return!0;const t=Ln(r);if(t!==Ln(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return ki(r).isEqual(ki(e));case 3:return function(i,o){if("string"==typeof i.timestampValue&&"string"==typeof o.timestampValue&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const c=Sn(i.timestampValue),d=Sn(o.timestampValue);return c.seconds===d.seconds&&c.nanos===d.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return o=e,Pn(r.bytesValue).isEqual(Pn(o.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,o){return rt(i.geoPointValue.latitude)===rt(o.geoPointValue.latitude)&&rt(i.geoPointValue.longitude)===rt(o.geoPointValue.longitude)}(r,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return rt(i.integerValue)===rt(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const c=rt(i.doubleValue),d=rt(o.doubleValue);return c===d?qr(c)===qr(d):isNaN(c)&&isNaN(d)}return!1}(r,e);case 9:return Si(r.arrayValue.values||[],e.arrayValue.values||[],Mn);case 10:case 11:return function(i,o){const c=i.mapValue.fields||{},d=o.mapValue.fields||{};if(To(c)!==To(d))return!1;for(const f in c)if(c.hasOwnProperty(f)&&(void 0===d[f]||!Mn(c[f],d[f])))return!1;return!0}(r,e);default:return D()}var o}function Gr(r,e){return void 0!==(r.values||[]).find(t=>Mn(t,e))}function En(r,e){if(r===e)return 0;const t=Ln(r),n=Ln(e);if(t!==n)return Ae(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ae(r.booleanValue,e.booleanValue);case 2:return function(o,c){const d=rt(o.integerValue||o.doubleValue),f=rt(c.integerValue||c.doubleValue);return d<f?-1:d>f?1:d===f?0:isNaN(d)?isNaN(f)?0:-1:1}(r,e);case 3:return Po(r.timestampValue,e.timestampValue);case 4:return Po(ki(r),ki(e));case 5:return Ae(r.stringValue,e.stringValue);case 6:return function(o,c){const d=Pn(o),f=Pn(c);return d.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(o,c){const d=o.split("/"),f=c.split("/");for(let g=0;g<d.length&&g<f.length;g++){const I=Ae(d[g],f[g]);if(0!==I)return I}return Ae(d.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(o,c){const d=Ae(rt(o.latitude),rt(c.latitude));return 0!==d?d:Ae(rt(o.longitude),rt(c.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return bo(r.arrayValue,e.arrayValue);case 10:return function(o,c){var d,f,g,I;const U=null===(d=(o.fields||{}).value)||void 0===d?void 0:d.arrayValue,X=null===(f=(c.fields||{}).value)||void 0===f?void 0:f.arrayValue,re=Ae((null===(g=U?.values)||void 0===g?void 0:g.length)||0,(null===(I=X?.values)||void 0===I?void 0:I.length)||0);return 0!==re?re:bo(U,X)}(r.mapValue,e.mapValue);case 11:return function(o,c){if(o===On.mapValue&&c===On.mapValue)return 0;if(o===On.mapValue)return 1;if(c===On.mapValue)return-1;const d=o.fields||{},f=Object.keys(d),g=c.fields||{},I=Object.keys(g);f.sort(),I.sort();for(let A=0;A<f.length&&A<I.length;++A){const S=Ae(f[A],I[A]);if(0!==S)return S;const U=En(d[f[A]],g[I[A]]);if(0!==U)return U}return Ae(f.length,I.length)}(r.mapValue,e.mapValue);default:throw D()}}function Po(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return Ae(r,e);const t=Sn(r),n=Sn(e),i=Ae(t.seconds,n.seconds);return 0!==i?i:Ae(t.nanos,n.nanos)}function bo(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const o=En(t[i],n[i]);if(o)return o}return Ae(t.length,n.length)}function Xn(r){return ms(r)}function ms(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Sn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Pn(r.bytesValue).toBase64():"referenceValue"in r?ae.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const o of t.values||[])i?i=!1:n+=",",n+=ms(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const c of n)o?o=!1:i+=",",i+=`${c}:${ms(t.fields[c])}`;return i+"}"}(r.mapValue):D()}function Wr(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function gs(r){return!!r&&"integerValue"in r}function _s(r){return!!r&&"arrayValue"in r}function Co(r){return!!r&&"nullValue"in r}function Uc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Li(r){return!!r&&"mapValue"in r}function ys(r){var e,t;return"__vector__"===(null===(t=((null===(e=r?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function $r(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return wt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=$r(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=$r(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Bc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const xo={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Yh(r){return"nullValue"in r?So:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Wr(Yn.empty(),ae.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?ys(r)?xo:{mapValue:{}}:D()}function nu(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Wr(Yn.empty(),ae.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?xo:"mapValue"in r?ys(r)?{mapValue:{}}:On:D()}function qc(r,e){const t=En(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Kc(r,e){const t=En(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Rt{constructor(e){this.value=e}static empty(){return new Rt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Li(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=$r(t)}setAll(e){let t=Je.emptyPath(),n={},i=[];e.forEach((c,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,n,i),n={},i=[],t=d.popLast()}c?n[d.lastSegment()]=$r(c):i.push(d.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,i)}delete(e){const t=this.field(e.popLast());Li(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Li(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){wt(t,(i,o)=>e[i]=o);for(const i of n)delete e[i]}clone(){return new Rt($r(this.value))}}function jc(r){const e=[];return wt(r.fields,(t,n)=>{const i=new Je([t]);if(Li(n)){const o=jc(n.mapValue).fields;if(0===o.length)e.push(i);else for(const c of o)e.push(i.child(c))}else e.push(i)}),new kt(e)}class it{constructor(e,t,n,i,o,c,d){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=o,this.data=c,this.documentState=d}static newInvalidDocument(e){return new it(e,0,me.min(),me.min(),me.min(),Rt.empty(),0)}static newFoundDocument(e,t,n,i){return new it(e,1,t,me.min(),n,i,0)}static newNoDocument(e,t){return new it(e,2,t,me.min(),me.min(),Rt.empty(),0)}static newUnknownDocument(e,t){return new it(e,3,t,me.min(),me.min(),Rt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(me.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof it&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new it(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Fn{constructor(e,t){this.position=e,this.inclusive=t}}function zc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const o=e[i],c=r.position[i];if(n=o.field.isKeyField()?ae.comparator(ae.fromName(c.referenceValue),t.key):En(c,t.data.field(o.field)),"desc"===o.dir&&(n*=-1),0!==n)break}return n}function Do(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Mn(r.position[t],e.position[t]))return!1;return!0}class Is{constructor(e,t="asc"){this.field=e,this.dir=t}}function ru(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Gc{}class Ve extends Gc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ou(e,t,n):"array-contains"===t?new Zh(e,n):"in"===t?new Qc(e,n):"not-in"===t?new ed(e,n):"array-contains-any"===t?new td(e,n):new Ve(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Xh(e,n):new Mi(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(En(t,this.value)):null!==t&&Ln(this.value)===Ln(t)&&this.matchesComparison(En(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends Gc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ge(e,t)}matches(e){return Ar(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ar(r){return"and"===r.op}function iu(r){return"or"===r.op}function vs(r){return Wc(r)&&Ar(r)}function Wc(r){for(const e of r.filters)if(e instanceof Ge)return!1;return!0}function Es(r){if(r instanceof Ve)return r.field.canonicalString()+r.op.toString()+Xn(r.value);if(vs(r))return r.filters.map(e=>Es(e)).join(",");{const e=r.filters.map(t=>Es(t)).join(",");return`${r.op}(${e})`}}function $c(r,e){return r instanceof Ve?(n=r,(i=e)instanceof Ve&&n.op===i.op&&n.field.isEqual(i.field)&&Mn(n.value,i.value)):r instanceof Ge?function(n,i){return i instanceof Ge&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((o,c,d)=>o&&$c(c,i.filters[d]),!0)}(r,e):void D();var n,i}function Hc(r,e){const t=r.filters.concat(e);return Ge.create(t,r.op)}function su(r){return r instanceof Ve?`${(t=r).field.canonicalString()} ${t.op} ${Xn(t.value)}`:r instanceof Ge?function(t){return t.op.toString()+" {"+t.getFilters().map(su).join(" ,")+"}"}(r):"Filter";var t}class ou extends Ve{constructor(e,t,n){super(e,t,n),this.key=ae.fromName(n.referenceValue)}matches(e){const t=ae.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xh extends Ve{constructor(e,t){super(e,"in",t),this.keys=au(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mi extends Ve{constructor(e,t){super(e,"not-in",t),this.keys=au(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function au(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>ae.fromName(n.referenceValue))}class Zh extends Ve{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _s(t)&&Gr(t.arrayValue,this.value)}}class Qc extends Ve{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gr(this.value.arrayValue,t)}}class ed extends Ve{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Gr(this.value.arrayValue,t)}}class td extends Ve{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_s(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Gr(this.value.arrayValue,n))}}class nd{constructor(e,t=null,n=[],i=[],o=null,c=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=o,this.startAt=c,this.endAt=d,this.ue=null}}function Jc(r,e=null,t=[],n=[],i=null,o=null,c=null){return new nd(r,e,t,n,i,o,c)}function Fi(r){const e=J(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Es(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(o=n).field.canonicalString()+o.dir;var o}).join(","),fs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Xn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Xn(n)).join(",")),e.ue=t}return e.ue}function Vo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!ru(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!$c(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Do(r.startAt,e.startAt)&&Do(r.endAt,e.endAt)}function Ui(r){return ae.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function No(r,e){return r.filters.filter(t=>t instanceof Ve&&t.field.isEqual(e))}function Yc(r,e,t){let n=So,i=!0;for(const o of No(r,e)){let c=So,d=!0;switch(o.op){case"<":case"<=":c=Yh(o.value);break;case"==":case"in":case">=":c=o.value;break;case">":c=o.value,d=!1;break;case"!=":case"not-in":c=So}qc({value:n,inclusive:i},{value:c,inclusive:d})<0&&(n=c,i=d)}if(null!==t)for(let o=0;o<r.orderBy.length;++o)if(r.orderBy[o].field.isEqual(e)){const c=t.position[o];qc({value:n,inclusive:i},{value:c,inclusive:t.inclusive})<0&&(n=c,i=t.inclusive);break}return{value:n,inclusive:i}}function rd(r,e,t){let n=On,i=!0;for(const o of No(r,e)){let c=On,d=!0;switch(o.op){case">=":case">":c=nu(o.value),d=!1;break;case"==":case"in":case"<=":c=o.value;break;case"<":c=o.value,d=!1;break;case"!=":case"not-in":c=On}Kc({value:n,inclusive:i},{value:c,inclusive:d})>0&&(n=c,i=d)}if(null!==t)for(let o=0;o<r.orderBy.length;++o)if(r.orderBy[o].field.isEqual(e)){const c=t.position[o];Kc({value:n,inclusive:i},{value:c,inclusive:t.inclusive})>0&&(n=c,i=t.inclusive);break}return{value:n,inclusive:i}}class Tr{constructor(e,t=null,n=[],i=[],o=null,c="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=o,this.limitType=c,this.startAt=d,this.endAt=f,this.ce=null,this.le=null,this.he=null}}function id(r,e,t,n,i,o,c,d){return new Tr(r,e,t,n,i,o,c,d)}function As(r){return new Tr(r)}function sd(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Xc(r){return null!==r.collectionGroup}function wr(r){const e=J(r);if(null===e.ce){e.ce=[];const t=new Set;for(const o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let d=new ze(Je.comparator);return c.filters.forEach(f=>{f.getFlattenedFilters().forEach(g=>{g.isInequality()&&(d=d.add(g.field))})}),d})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new Is(o,n))}),t.has(Je.keyField().canonicalString())||e.ce.push(new Is(Je.keyField(),n))}return e.ce}function pt(r){const e=J(r);return e.le||(e.le=function Zc(r,e){if("F"===r.limitType)return Jc(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Is(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Fn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Fn(r.startAt.position,r.startAt.inclusive):null;return Jc(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,wr(r))),e.le}function uu(r,e){const t=r.filters.concat([e]);return new Tr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Oo(r,e,t){return new Tr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Lo(r,e){return Vo(pt(r),pt(e))&&r.limitType===e.limitType}function el(r){return`${Fi(pt(r))}|lt:${r.limitType}`}function Bi(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>su(i)).join(", ")}]`),fs(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(c=i).field.canonicalString()} (${c.dir})`;var c}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Xn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Xn(i)).join(",")),`Target(${n})`}(pt(r))}; limitType=${r.limitType})`}function Hr(r,e){return e.isFoundDocument()&&function(n,i){const o=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):ae.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,e)&&function(n,i){for(const o of wr(n))if(!o.field.isKeyField()&&null===i.data.field(o.field))return!1;return!0}(r,e)&&function(n,i){for(const o of n.filters)if(!o.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(c,d,f){const g=zc(c,d,f);return c.inclusive?g<=0:g<0}(n.startAt,wr(n),i)||n.endAt&&!function(c,d,f){const g=zc(c,d,f);return c.inclusive?g>=0:g>0}(n.endAt,wr(n),i)));var n,i}function Mo(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function tl(r){return(e,t)=>{let n=!1;for(const i of wr(r)){const o=Fo(i,e,t);if(0!==o)return o;n=n||i.field.isKeyField()}return 0}}function Fo(r,e,t){const n=r.field.isKeyField()?ae.comparator(e.key,t.key):function(o,c,d){const f=c.data.field(o),g=d.data.field(o);return null!==f&&null!==g?En(f,g):D()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return D()}}class Un{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,o]of n)if(this.equalsFn(i,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){wt(this.inner,(t,n)=>{for(const[i,o]of n)e(i,o)})}isEmpty(){return Lc(this.inner)}size(){return this.innerSize}}const od=new We(ae.comparator);function Ht(){return od}const ad=new We(ae.comparator);function Rr(...r){let e=ad;for(const t of r)e=e.insert(t.key,t);return e}function ud(r){let e=ad;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function xt(){return Ts()}function nl(){return Ts()}function Ts(){return new Un(r=>r.toString(),(r,e)=>r.isEqual(e))}const ws=new We(ae.comparator),cd=new ze(ae.comparator);function ge(...r){let e=cd;for(const t of r)e=e.add(t);return e}const ld=new ze(Ae);function Rs(){return ld}function cu(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qr(e)?"-0":e}}function Uo(r){return{integerValue:""+r}}function rl(r,e){return Ci(e)?Uo(e):cu(r,e)}class Bo{constructor(){this._=void 0}}function il(r,e,t){return r instanceof Qr?function(i,o){const c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&zr(o)&&(o=Ni(o)),o&&(c.fields.__previous_value__=o),{mapValue:c}}(t,e):r instanceof bn?Ps(r,e):r instanceof Jr?qo(r,e):function(i,o){const c=Ss(i,o),d=Ko(c)+Ko(i.Pe);return gs(c)&&gs(i.Pe)?Uo(d):cu(i.serializer,d)}(r,e)}function hd(r,e,t){return r instanceof bn?Ps(r,e):r instanceof Jr?qo(r,e):t}function Ss(r,e){return r instanceof Yr?gs(n=e)||(o=n)&&"doubleValue"in o?e:{integerValue:0}:null;var n,o}class Qr extends Bo{}class bn extends Bo{constructor(e){super(),this.elements=e}}function Ps(r,e){const t=sl(e);for(const n of r.elements)t.some(i=>Mn(i,n))||t.push(n);return{arrayValue:{values:t}}}class Jr extends Bo{constructor(e){super(),this.elements=e}}function qo(r,e){let t=sl(e);for(const n of r.elements)t=t.filter(i=>!Mn(i,n));return{arrayValue:{values:t}}}class Yr extends Bo{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Ko(r){return rt(r.integerValue||r.doubleValue)}function sl(r){return _s(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Xr{constructor(e,t){this.field=e,this.transform=t}}class dd{constructor(e,t){this.version=e,this.transformResults=t}}class ut{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ut}static exists(e){return new ut(void 0,e)}static updateTime(e){return new ut(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lu(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Zn{}function al(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new qi(r.key,ut.none()):new er(r.key,r.data,ut.none());{const t=r.data,n=Rt.empty();let i=new ze(Je.comparator);for(let o of e.fields)if(!i.has(o)){let c=t.field(o);null===c&&o.length>1&&(o=o.popLast(),c=t.field(o)),null===c?n.delete(o):n.set(o,c),i=i.add(o)}return new tr(r.key,n,new kt(i.toArray()),ut.none())}}function fd(r,e,t){r instanceof er?function(i,o,c){const d=i.value.clone(),f=ll(i.fieldTransforms,o,c.transformResults);d.setAll(f),o.convertToFoundDocument(c.version,d).setHasCommittedMutations()}(r,e,t):r instanceof tr?function(i,o,c){if(!lu(i.precondition,o))return void o.convertToUnknownDocument(c.version);const d=ll(i.fieldTransforms,o,c.transformResults),f=o.data;f.setAll(cl(i)),f.setAll(d),o.convertToFoundDocument(c.version,f).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function bs(r,e,t,n){return r instanceof er?function(o,c,d,f){if(!lu(o.precondition,c))return d;const g=o.value.clone(),I=jo(o.fieldTransforms,f,c);return g.setAll(I),c.convertToFoundDocument(c.version,g).setHasLocalMutations(),null}(r,e,t,n):r instanceof tr?function(o,c,d,f){if(!lu(o.precondition,c))return d;const g=jo(o.fieldTransforms,f,c),I=c.data;return I.setAll(cl(o)),I.setAll(g),c.convertToFoundDocument(c.version,I).setHasLocalMutations(),null===d?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(A=>A.field))}(r,e,t,n):(d=t,lu(r.precondition,c=e)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):d);var c,d}function pd(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),o=Ss(n.transform,i||null);null!=o&&(null===t&&(t=Rt.empty()),t.set(n.field,o))}return t||null}function ul(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Si(n,i,(o,c)=>function ol(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof bn&&i instanceof bn||n instanceof Jr&&i instanceof Jr?Si(n.elements,i.elements,Mn):n instanceof Yr&&i instanceof Yr?Mn(n.Pe,i.Pe):n instanceof Qr&&i instanceof Qr);var n,i}(o,c))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class er extends Zn{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class tr extends Zn{constructor(e,t,n,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function cl(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function ll(r,e,t){const n=new Map;G(r.length===t.length);for(let i=0;i<t.length;i++){const o=r[i],c=o.transform,d=e.data.field(o.field);n.set(o.field,hd(c,d,t[i]))}return n}function jo(r,e,t){const n=new Map;for(const i of r){const o=i.transform,c=t.data.field(i.field);n.set(i.field,il(o,c,e))}return n}class qi extends Zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hu extends Zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class du{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&fd(o,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=bs(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=bs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=nl();return this.mutations.forEach(i=>{const o=e.get(i.key),c=o.overlayedDocument;let d=this.applyToLocalView(c,o.mutatedFields);d=t.has(i.key)?null:d;const f=al(c,d);null!==f&&n.set(i.key,f),c.isValidDocument()||c.convertToNoDocument(me.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&Si(this.mutations,e.mutations,(t,n)=>ul(t,n))&&Si(this.baseMutations,e.baseMutations,(t,n)=>ul(t,n))}}class fu{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){G(e.mutations.length===n.length);let i=function(){return ws}();const o=e.mutations;for(let c=0;c<o.length;c++)i=i.insert(o[c].key,n[c].version);return new fu(e,t,n,i)}}class zo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class md{constructor(e,t){this.count=e,this.unchangedNames=t}}var It,Oe;function dl(r){switch(r){default:return D();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function Go(r){if(void 0===r)return He("GRPC error has no .code"),N.UNKNOWN;switch(r){case It.OK:return N.OK;case It.CANCELLED:return N.CANCELLED;case It.UNKNOWN:return N.UNKNOWN;case It.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case It.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case It.INTERNAL:return N.INTERNAL;case It.UNAVAILABLE:return N.UNAVAILABLE;case It.UNAUTHENTICATED:return N.UNAUTHENTICATED;case It.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case It.NOT_FOUND:return N.NOT_FOUND;case It.ALREADY_EXISTS:return N.ALREADY_EXISTS;case It.PERMISSION_DENIED:return N.PERMISSION_DENIED;case It.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case It.ABORTED:return N.ABORTED;case It.OUT_OF_RANGE:return N.OUT_OF_RANGE;case It.UNIMPLEMENTED:return N.UNIMPLEMENTED;case It.DATA_LOSS:return N.DATA_LOSS;default:return D()}}(Oe=It||(It={}))[Oe.OK=0]="OK",Oe[Oe.CANCELLED=1]="CANCELLED",Oe[Oe.UNKNOWN=2]="UNKNOWN",Oe[Oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Oe[Oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Oe[Oe.NOT_FOUND=5]="NOT_FOUND",Oe[Oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Oe[Oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Oe[Oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Oe[Oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Oe[Oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Oe[Oe.ABORTED=10]="ABORTED",Oe[Oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Oe[Oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Oe[Oe.INTERNAL=13]="INTERNAL",Oe[Oe.UNAVAILABLE=14]="UNAVAILABLE",Oe[Oe.DATA_LOSS=15]="DATA_LOSS";function $o(){return new TextEncoder}const gd=new P([4294967295,4294967295],0);function Ho(r){const e=$o().encode(r),t=new R;return t.update(e),new Uint8Array(t.digest())}function Cs(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new P([t,n],0),new P([i,o],0)]}class xs{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ds(`Invalid padding: ${t}`);if(n<0)throw new Ds(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ds(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ds(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=P.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(P.fromNumber(n)));return 1===i.compare(gd)&&(i=new P([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Ho(e),[n,i]=Cs(t);for(let o=0;o<this.hashCount;o++){const c=this.Ee(n,i,o);if(!this.de(c))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),c=new xs(o,i,t);return n.forEach(d=>c.insert(d)),c}insert(e){if(0===this.Ie)return;const t=Ho(e),[n,i]=Cs(t);for(let o=0;o<this.hashCount;o++){const c=this.Ee(n,i,o);this.Ae(c)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ds extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Zr{constructor(e,t,n,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,nr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Zr(me.min(),i,new We(Ae),Ht(),ge())}}class nr{constructor(e,t,n,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new nr(n,t,ge(),ge(),ge())}}class Bn{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class Qo{constructor(e,t){this.targetId=e,this.me=t}}class fl{constructor(e,t,n=at.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class pl{constructor(){this.fe=0,this.ge=pu(),this.pe=at.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ge(),t=ge(),n=ge();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:D()}}),new nr(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=pu()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class _d{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ht(),this.qe=Jo(),this.Qe=new We(Ae)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:D()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const o=i.target;if(Ui(o))if(0===n){const c=new ae(o.path);this.Ue(t,c,it.newNoDocument(c,me.min()))}else G(1===n);else{const c=this.Ye(t);if(c!==n){const d=this.Ze(e),f=d?this.Xe(d,e,c):1;0!==f&&(this.je(t),this.Qe=this.Qe.insert(t,2===f?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:o=0}=t;let c,d;try{c=Pn(n).toUint8Array()}catch(f){if(f instanceof wo)return K("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{d=new xs(c,i,o)}catch(f){return K(f instanceof Ds?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return 0===d.Ie?null:d}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(o=>{const c=this.Le.tt(),d=`projects/${c.projectId}/databases/${c.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.Ue(t,o,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((o,c)=>{const d=this.Je(c);if(d){if(o.current&&Ui(d.target)){const f=new ae(d.target.path);null!==this.ke.get(f)||this.it(c,f)||this.Ue(c,f,it.newNoDocument(f,e))}o.be&&(t.set(c,o.ve()),o.Ce())}});let n=ge();this.qe.forEach((o,c)=>{let d=!0;c.forEachWhile(f=>{const g=this.Je(f);return!g||"TargetPurposeLimboResolution"===g.purpose||(d=!1,!1)}),d&&(n=n.add(o))}),this.ke.forEach((o,c)=>c.setReadTime(e));const i=new Zr(e,t,this.Qe,this.ke,n);return this.ke=Ht(),this.qe=Jo(),this.Qe=new We(Ae),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new pl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ze(Ae),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||ee("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new pl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Jo(){return new We(ae.comparator)}function pu(){return new We(ae.comparator)}const yd={asc:"ASCENDING",desc:"DESCENDING"},Id={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mu={and:"AND",or:"OR"};class vd{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Vs(r,e){return r.useProto3Json||fs(e)?e:{value:e}}function Ki(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Yo(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function gu(r,e){return Ki(r,e.toTimestamp())}function gt(r){return G(!!r),me.fromTimestamp(function(t){const n=Sn(t);return new nt(n.seconds,n.nanos)}(r))}function ei(r,e){return _u(r,e).canonicalString()}function _u(r,e){const t=(i=r,new De(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function ml(r){const e=De.fromString(r);return G(Al(e)),e}function ti(r,e){return ei(r.databaseId,e.path)}function An(r,e){const t=ml(e);if(t.get(1)!==r.databaseId.projectId)throw new $(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new $(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new ae(yu(t))}function Xo(r,e){return ei(r.databaseId,e)}function gl(r){const e=ml(r);return 4===e.length?De.emptyPath():yu(e)}function Ns(r){return new De(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function yu(r){return G(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function Iu(r,e,t){return{name:ti(r,e),fields:t.value.mapValue.fields}}function _l(r,e,t){const n=An(r,e.name),i=gt(e.updateTime),o=e.createTime?gt(e.createTime):me.min(),c=new Rt({mapValue:{fields:e.fields}}),d=it.newFoundDocument(n,i,o,c);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function ks(r,e){let t;if(e instanceof er)t={update:Iu(r,e.key,e.value)};else if(e instanceof qi)t={delete:ti(r,e.key)};else if(e instanceof tr)t={update:Iu(r,e.key,e.data),updateMask:El(e.fieldMask)};else{if(!(e instanceof hu))return D();t={verify:ti(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(o,c){const d=c.transform;if(d instanceof Qr)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof bn)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Jr)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Yr)return{fieldPath:c.field.canonicalString(),increment:d.Pe};throw D()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(o=e.precondition).updateTime?{updateTime:gu(r,o.updateTime)}:void 0!==o.exists?{exists:o.exists}:D()),t;var o}function Eu(r,e){const t=e.currentDocument?void 0!==(o=e.currentDocument).updateTime?ut.updateTime(gt(o.updateTime)):void 0!==o.exists?ut.exists(o.exists):ut.none():ut.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(c,d){let f=null;"setToServerValue"in d?(G("REQUEST_TIME"===d.setToServerValue),f=new Qr):"appendMissingElements"in d?f=new bn(d.appendMissingElements.values||[]):"removeAllFromArray"in d?f=new Jr(d.removeAllFromArray.values||[]):"increment"in d?f=new Yr(c,d.increment):D();const g=Je.fromServerFormat(d.fieldPath);return new Xr(g,f)}(r,i)):[];var o;if(e.update){const i=An(r,e.update.name),o=new Rt({mapValue:{fields:e.update.fields}});if(e.updateMask){const c=new kt((e.updateMask.fieldPaths||[]).map(I=>Je.fromServerFormat(I)));return new tr(i,o,c,t,n)}return new er(i,o,t,n)}if(e.delete){const i=An(r,e.delete);return new qi(i,t)}if(e.verify){const i=An(r,e.verify);return new hu(i,t)}return D()}function yl(r,e){return{documents:[Xo(r,e.path)]}}function Zo(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Xo(r,i);const o=function(g){if(0!==g.length)return Su(Ge.create(g,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const c=function(g){if(0!==g.length)return g.map(I=>{return{field:Sr((S=I).field),direction:wu(S.dir)};var S})}(e.orderBy);c&&(t.structuredQuery.orderBy=c);const d=Vs(r,e.limit);return null!==d&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt={before:(g=e.startAt).inclusive,values:g.position}),e.endAt&&(t.structuredQuery.endAt=function(g){return{before:!g.inclusive,values:g.position}}(e.endAt)),{_t:t,parent:i};var g}function Il(r){let e=gl(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){G(1===n);const I=t.from[0];I.allDescendants?i=I.collectionId:e=e.child(I.collectionId)}let o=[];t.where&&(o=function(A){const S=Os(A);return S instanceof Ge&&vs(S)?S.getFilters():[S]}(t.where));let c=[];t.orderBy&&(c=t.orderBy.map(S=>{return new Is(ni((X=S).field),function(Z){switch(Z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(X.direction));var X}));let d=null;t.limit&&(d=function(A){let S;return S="object"==typeof A?A.value:A,fs(S)?null:S}(t.limit));let f=null;var A;t.startAt&&(f=new Fn((A=t.startAt).values||[],!!A.before));let g=null;return t.endAt&&(g=function(A){return new Fn(A.values||[],!A.before)}(t.endAt)),id(e,i,c,o,d,"F",f,g)}function Os(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=ni(t.unaryFilter.field);return Ve.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=ni(t.unaryFilter.field);return Ve.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=ni(t.unaryFilter.field);return Ve.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=ni(t.unaryFilter.field);return Ve.create(c,"!=",{nullValue:"NULL_VALUE"});default:return D()}}(r):void 0!==r.fieldFilter?Ve.create(ni((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Ge.create(t.compositeFilter.filters.map(n=>Os(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return D()}}(t.compositeFilter.op))}(r):D();var t}function wu(r){return yd[r]}function vl(r){return Id[r]}function Ru(r){return mu[r]}function Sr(r){return{fieldPath:r.canonicalString()}}function ni(r){return Je.fromServerFormat(r.fieldPath)}function Su(r){return r instanceof Ve?function(t){if("=="===t.op){if(Uc(t.value))return{unaryFilter:{field:Sr(t.field),op:"IS_NAN"}};if(Co(t.value))return{unaryFilter:{field:Sr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Uc(t.value))return{unaryFilter:{field:Sr(t.field),op:"IS_NOT_NAN"}};if(Co(t.value))return{unaryFilter:{field:Sr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sr(t.field),op:vl(t.op),value:t.value}}}(r):r instanceof Ge?function(t){const n=t.getFilters().map(i=>Su(i));return 1===n.length?n[0]:{compositeFilter:{op:Ru(t.op),filters:n}}}(r):D()}function El(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Al(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class qn{constructor(e,t,n,i,o=me.min(),c=me.min(),d=at.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=d,this.expectedCount=f}withSequenceNumber(e){return new qn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new qn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new qn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new qn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ta{constructor(e){this.ct=e}}function Tl(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:na(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:ti(o=r.ct,(c=e).key),fields:c.data.value.mapValue.fields,updateTime:Ki(o,c.version.toTimestamp()),createTime:Ki(o,c.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:rr(e.version)};else{if(!e.isUnknownDocument())return D();n.unknownDocument={path:t.path.toArray(),version:rr(e.version)}}var o,c;return n}function na(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function rr(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ri(r){const e=new nt(r.seconds,r.nanoseconds);return me.fromTimestamp(e)}function ii(r,e){const t=(e.baseMutations||[]).map(o=>Eu(r.ct,o));for(let o=0;o<e.mutations.length-1;++o)o+1<e.mutations.length&&void 0!==e.mutations[o+1].transform&&(e.mutations[o].updateTransforms=e.mutations[o+1].transform.fieldTransforms,e.mutations.splice(o+1,1),++o);const n=e.mutations.map(o=>Eu(r.ct,o)),i=nt.fromMillis(e.localWriteTimeMs);return new du(e.batchId,i,t,n)}function ji(r){const e=ri(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?ri(r.lastLimboFreeSnapshotVersion):me.min();let n;return n=void 0!==r.query.documents?(G(1===(o=r.query).documents.length),pt(As(gl(o.documents[0])))):function(o){return pt(Il(o))}(r.query),new qn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,at.fromBase64String(r.resumeToken));var o}function wl(r,e){const t=rr(e.snapshotVersion),n=rr(e.lastLimboFreeSnapshotVersion);let i;i=Ui(e.target)?yl(r.ct,e.target):Zo(r.ct,e.target)._t;const o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Fi(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function zi(r){const e=Il({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Oo(e,e.limit,"L"):e}function Pu(r,e){return new zo(e.largestBatchId,Eu(r.ct,e.overlayMutation))}function Rl(r,e){const t=e.path.lastSegment();return[r,ot(e.path.popLast()),t]}function Sl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:rr(n.readTime),documentKey:ot(n.documentKey.path),largestBatchId:n.largestBatchId}}class Td{getBundleMetadata(e,t){return Pl(e).get(t).next(n=>{if(n)return{id:(o=n).bundleId,createTime:ri(o.createTime),version:o.version};var o})}saveBundleMetadata(e,t){return Pl(e).put({bundleId:(i=t).id,createTime:rr(gt(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return bl(e).get(t).next(n=>{if(n)return{name:(o=n).name,query:zi(o.bundledQuery),readTime:ri(o.readTime)};var o})}saveNamedQuery(e,t){return bl(e).put({name:(i=t).name,readTime:rr(gt(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Pl(r){return yt(r,"bundles")}function bl(r){return yt(r,"namedQueries")}class ra{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new ra(e,t.uid||"")}getOverlay(e,t){return Ls(e).get(Rl(this.userId,t)).next(n=>n?Pu(this.serializer,n):null)}getOverlays(e,t){const n=xt();return F.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&n.set(i,o)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((o,c)=>{const d=new zo(t,c);i.push(this.ht(e,d))}),F.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(c=>i.add(ot(c.getCollectionPath())));const o=[];return i.forEach(c=>{const d=IDBKeyRange.bound([this.userId,c,n],[this.userId,c,n+1],!1,!0);o.push(Ls(e).j("collectionPathOverlayIndex",d))}),F.waitFor(o)}getOverlaysForCollection(e,t,n){const i=xt(),o=ot(t),c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,Number.POSITIVE_INFINITY],!0);return Ls(e).U("collectionPathOverlayIndex",c).next(d=>{for(const f of d){const g=Pu(this.serializer,f);i.set(g.getKey(),g)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const o=xt();let c;const d=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ls(e).J({index:"collectionGroupOverlayIndex",range:d},(f,g,I)=>{const A=Pu(this.serializer,g);o.size()<i||A.largestBatchId===c?(o.set(A.getKey(),A),c=A.largestBatchId):I.done()}).next(()=>o)}ht(e,t){return Ls(e).put(function(i,o,c){const[d,f,g]=Rl(o,c.mutation.key);return{userId:o,collectionPath:f,documentId:g,collectionGroup:c.mutation.key.getCollectionGroup(),largestBatchId:c.largestBatchId,overlayMutation:ks(i.ct,c.mutation)}}(this.serializer,this.userId,t))}}function Ls(r){return yt(r,"documentOverlays")}class bu{Pt(e){return yt(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t?.value;return n?at.fromUint8Array(n):at.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class si{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(rt(e.integerValue));else if("doubleValue"in e){const n=rt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),qr(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Sn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Pn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Bc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):ys(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):D()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const o=e.fields||{};this.dt(t,53);const c="value",d=(null===(i=null===(n=o[c].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(rt(d)),this.Vt(c,t),this.Tt(o[c],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),ae.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function wd(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Cl(r){const e=64-function(n){let i=0;for(let o=0;o<8;++o){const c=wd(255&n[o]);if(i+=c,8!==c)break}return i}(r);return Math.ceil(e/8)}si.vt=new si;class Rd{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=Cl(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=Cl(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(o){const c=new DataView(new ArrayBuffer(8));return c.setFloat64(0,o,!1),new Uint8Array(c.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Sd{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class xl{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Ms{constructor(){this.jt=new Rd,this.Ht=new Sd(this.jt),this.Jt=new xl(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class oi{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new oi(this.indexId,this.documentKey,this.arrayValue,n)}}function Pr(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Dl(r.arrayValue,e.arrayValue),0!==t?t:(t=Dl(r.directionalValue,e.directionalValue),0!==t?t:ae.comparator(r.documentKey,e.documentKey)))}function Dl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Vl{constructor(e){this.Xt=new ze((t,n)=>Je.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;const t=go(e);if(void 0!==t&&!this.sn(t))return!1;const n=gr(e);let i=new Set,o=0,c=0;for(;o<n.length&&this.sn(n[o]);++o)i=i.add(n[o].fieldPath.canonicalString());if(o===n.length)return!0;if(this.Xt.size>0){const d=this.Xt.getIterator().getNext();if(!i.has(d.field.canonicalString())){const f=n[o];if(!this.on(d,f)||!this._n(this.en[c++],f))return!1}++o}for(;o<n.length;++o)if(c>=this.en.length||!this._n(this.en[c++],n[o]))return!1;return!0}an(){if(this.nn)return null;let e=new ze(Je.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new _r(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new _r(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new _r(n.field,"asc"===n.dir?0:1)));return new Pi(Pi.UNKNOWN_ID,this.collectionId,t,Rn.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ia(r){var e,t;if(G(r instanceof Ve||r instanceof Ge),r instanceof Ve){if(r instanceof Qc){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(o=>Ve.create(r.field,"==",o)))||[];return Ge.create(i,"or")}return r}const n=r.filters.map(i=>ia(i));return Ge.create(n,r.op)}function Cu(r){if(0===r.getFilters().length)return[];const e=sa(ia(r));return G(Nl(e)),xu(e)||Fs(e)?[e]:e.getFilters()}function xu(r){return r instanceof Ve}function Fs(r){return r instanceof Ge&&vs(r)}function Nl(r){return xu(r)||Fs(r)||function(t){if(t instanceof Ge&&iu(t)){for(const n of t.getFilters())if(!xu(n)&&!Fs(n))return!1;return!0}return!1}(r)}function sa(r){if(G(r instanceof Ve||r instanceof Ge),r instanceof Ve)return r;if(1===r.filters.length)return sa(r.filters[0]);const e=r.filters.map(n=>sa(n));let t=Ge.create(e,r.op);return t=ua(t),Nl(t)?t:(G(t instanceof Ge),G(Ar(t)),G(t.filters.length>1),t.filters.reduce((n,i)=>oa(n,i)))}function oa(r,e){let t;return G(r instanceof Ve||r instanceof Ge),G(e instanceof Ve||e instanceof Ge),t=r instanceof Ve?e instanceof Ve?Ge.create([r,e],"and"):aa(r,e):e instanceof Ve?aa(e,r):function(i,o){if(G(i.filters.length>0&&o.filters.length>0),Ar(i)&&Ar(o))return Hc(i,o.getFilters());const c=iu(i)?i:o,d=iu(i)?o:i,f=c.filters.map(g=>oa(g,d));return Ge.create(f,"or")}(r,e),ua(t)}function aa(r,e){if(Ar(e))return Hc(e,r.getFilters());{const t=e.filters.map(n=>oa(r,n));return Ge.create(t,"or")}}function ua(r){if(G(r instanceof Ve||r instanceof Ge),r instanceof Ve)return r;const e=r.getFilters();if(1===e.length)return ua(e[0]);if(Wc(r))return r;const t=e.map(i=>ua(i)),n=[];return t.forEach(i=>{i instanceof Ve?n.push(i):i instanceof Ge&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:Ge.create(n,r.op)}class Bp{constructor(){this.un=new Us}addToCollectionParentIndex(e,t){return this.un.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(an.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(an.min())}updateCollectionGroup(e,t,n){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}}class Us{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ze(De.comparator),o=!i.has(n);return this.index[t]=i.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ze(De.comparator)).toArray()}}const Bs=new Uint8Array(0);class ca{constructor(e,t){this.databaseId=t,this.cn=new Us,this.ln=new Un(n=>Fi(n),(n,i)=>Vo(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const o={collectionId:n,parent:ot(i)};return Du(e).put(o)}return F.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[Ka(t),""],!1,!0);return Du(e).U(i).next(o=>{for(const c of o){if(c.collectionId!==t)break;n.push(Tt(c.parent))}return n})}addFieldIndex(e,t){const n=qs(e),i={indexId:(d=t).indexId,collectionGroup:d.collectionGroup,fields:d.fields.map(f=>[f.fieldPath.canonicalString(),f.kind])};var d;delete i.indexId;const o=n.add(i);if(t.indexState){const c=Gi(e);return o.next(d=>{c.put(Sl(d,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return o.next()}deleteFieldIndex(e,t){const n=qs(e),i=Gi(e),o=ai(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=qs(e),n=ai(e),i=Gi(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return F.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const o=new Vl(n).an();if(null!=o)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){const n=ai(e);let i=!0;const o=new Map;return F.forEach(this.hn(t),c=>this.Pn(e,c).next(d=>{i&&(i=!!d),o.set(c,d)})).next(()=>{if(i){let c=ge();const d=[];return F.forEach(o,(f,g)=>{var se;ee("IndexedDbIndexManager",`Using index ${se=f,`id=${se.indexId}|cg=${se.collectionGroup}|f=${se.fields.map(ye=>`${ye.fieldPath}:${ye.kind}`).join(",")}`} to execute ${Fi(t)}`);const I=function(se,ye){const Se=go(ye);if(void 0===Se)return null;for(const Ce of No(se,Se.fieldPath))switch(Ce.op){case"array-contains-any":return Ce.value.arrayValue.values||[];case"array-contains":return[Ce.value]}return null}(g,f),A=function(se,ye){const Se=new Map;for(const Ce of gr(ye))for(const V of No(se,Ce.fieldPath))switch(V.op){case"==":case"in":Se.set(Ce.fieldPath.canonicalString(),V.value);break;case"not-in":case"!=":return Se.set(Ce.fieldPath.canonicalString(),V.value),Array.from(Se.values())}return null}(g,f),S=function(se,ye){const Se=[];let Ce=!0;for(const V of gr(ye)){const T=0===V.kind?Yc(se,V.fieldPath,se.startAt):rd(se,V.fieldPath,se.startAt);Se.push(T.value),Ce&&(Ce=T.inclusive)}return new Fn(Se,Ce)}(g,f),U=function(se,ye){const Se=[];let Ce=!0;for(const V of gr(ye)){const T=0===V.kind?rd(se,V.fieldPath,se.endAt):Yc(se,V.fieldPath,se.endAt);Se.push(T.value),Ce&&(Ce=T.inclusive)}return new Fn(Se,Ce)}(g,f),X=this.In(f,g,S),re=this.In(f,g,U),Z=this.Tn(f,g,A),de=this.En(f.indexId,I,X,S.inclusive,re,U.inclusive,Z);return F.forEach(de,_e=>n.G(_e,t.limit).next(se=>{se.forEach(ye=>{const Se=ae.fromSegments(ye.documentKey);c.has(Se)||(c=c.add(Se),d.push(Se))})}))}).next(()=>d)}return F.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Cu(Ge.create(e.filters,"and")).map(n=>Jc(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,o,c,d){const f=(null!=t?t.length:1)*Math.max(n.length,o.length),g=f/(null!=t?t.length:1),I=[];for(let A=0;A<f;++A){const S=t?this.dn(t[A/g]):Bs,U=this.An(e,S,n[A%g],i),X=this.Rn(e,S,o[A%g],c),re=d.map(Z=>this.An(e,S,Z,!0));I.push(...this.createRange(U,X,re))}return I}An(e,t,n,i){const o=new oi(e,ae.empty(),t,n);return i?o:o.Zt()}Rn(e,t,n,i){const o=new oi(e,ae.empty(),t,n);return i?o.Zt():o}Pn(e,t){const n=new Vl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(o=>{let c=null;for(const d of o)n.rn(d)&&(!c||d.fields.length>c.fields.length)&&(c=d);return c})}getIndexType(e,t){let n=2;const i=this.hn(t);return F.forEach(i,o=>this.Pn(e,o).next(c=>{c?0!==n&&c.fields.length<function(f){let g=new ze(Je.comparator),I=!1;for(const A of f.filters)for(const S of A.getFlattenedFilters())S.field.isKeyField()||("array-contains"===S.op||"array-contains-any"===S.op?I=!0:g=g.add(S.field));for(const A of f.orderBy)A.field.isKeyField()||(g=g.add(A.field));return g.size+(I?1:0)}(o)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new Ms;for(const i of gr(e)){const o=t.data.field(i.fieldPath);if(null==o)return null;const c=n.Yt(i.kind);si.vt.It(o,c)}return n.zt()}dn(e){const t=new Ms;return si.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new Ms;return si.vt.It(Wr(this.databaseId,t),n.Yt(function(o){const c=gr(o);return 0===c.length?0:c[c.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new Ms);let o=0;for(const c of gr(e)){const d=n[o++];for(const f of i)if(this.fn(t,c.fieldPath)&&_s(d))i=this.gn(i,c,d);else{const g=f.Yt(c.kind);si.vt.It(d,g)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],o=[];for(const c of n.arrayValue.values||[])for(const d of i){const f=new Ms;f.seed(d.zt()),si.vt.It(c,f.Yt(t.kind)),o.push(f)}return o}fn(e,t){return!!e.filters.find(n=>n instanceof Ve&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=qs(e),i=Gi(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(o=>{const c=[];return F.forEach(o,d=>i.get([d.indexId,this.uid]).next(f=>{c.push(function(I,A){const S=A?new Rn(A.sequenceNumber,new an(ri(A.readTime),new ae(Tt(A.documentKey)),A.largestBatchId)):Rn.empty(),U=I.fields.map(([X,re])=>new _r(Je.fromServerFormat(X),re));return new Pi(I.indexId,I.collectionGroup,U,S)}(d,f))})).next(()=>c)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const o=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==o?o:Ae(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=qs(e),o=Gi(e);return this.yn(e).next(c=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>F.forEach(d,f=>o.put(Sl(f.indexId,this.uid,c,n)))))}updateIndexEntries(e,t){const n=new Map;return F.forEach(t,(i,o)=>{const c=n.get(i.collectionGroup);return(c?F.resolve(c):this.getFieldIndexes(e,i.collectionGroup)).next(d=>(n.set(i.collectionGroup,d),F.forEach(d,f=>this.wn(e,i,f).next(g=>{const I=this.Sn(o,f);return g.isEqual(I)?F.resolve():this.bn(e,o,f,g,I)}))))})}Dn(e,t,n,i){return ai(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return ai(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=ai(e);let o=new ze(Pr);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(c,d)=>{o=o.add(new oi(n.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>o)}Sn(e,t){let n=new ze(Pr);const i=this.Vn(t,e);if(null==i)return n;const o=go(t);if(null!=o){const c=e.data.field(o.fieldPath);if(_s(c))for(const d of c.arrayValue.values||[])n=n.add(new oi(t.indexId,e.key,this.dn(d),i))}else n=n.add(new oi(t.indexId,e.key,Bs,i));return n}bn(e,t,n,i,o){ee("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const c=[];return function(f,g,I,A,S){const U=f.getIterator(),X=g.getIterator();let re=Er(U),Z=Er(X);for(;re||Z;){let de=!1,_e=!1;if(re&&Z){const se=I(re,Z);se<0?_e=!0:se>0&&(de=!0)}else null!=re?_e=!0:de=!0;de?(A(Z),Z=Er(X)):_e?(S(re),re=Er(U)):(re=Er(U),Z=Er(X))}}(i,o,Pr,d=>{c.push(this.Dn(e,t,n,d))},d=>{c.push(this.vn(e,t,n,d))}),F.waitFor(c)}yn(e){let t=1;return Gi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,o)=>{o.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((c,d)=>Pr(c,d)).filter((c,d,f)=>!d||0!==Pr(c,f[d-1]));const i=[];i.push(e);for(const c of n){const d=Pr(c,e),f=Pr(c,t);if(0===d)i[0]=e.Zt();else if(d>0&&f<0)i.push(c),i.push(c.Zt());else if(f>0)break}i.push(t);const o=[];for(let c=0;c<i.length;c+=2){if(this.Cn(i[c],i[c+1]))return[];o.push(IDBKeyRange.bound([i[c].indexId,this.uid,i[c].arrayValue,i[c].directionalValue,Bs,[]],[i[c+1].indexId,this.uid,i[c+1].arrayValue,i[c+1].directionalValue,Bs,[]]))}return o}Cn(e,t){return Pr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(kl)}getMinOffset(e,t){return F.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||D())).next(kl)}}function Du(r){return yt(r,"collectionParents")}function ai(r){return yt(r,"indexEntries")}function qs(r){return yt(r,"indexConfiguration")}function Gi(r){return yt(r,"indexState")}function kl(r){G(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;hs(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new an(e.readTime,e.documentKey,t)}const Ol={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ot{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ot(e,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Vu(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),o=[],c=IDBKeyRange.only(t.batchId);let d=0;const f=n.J({range:c},(I,A,S)=>(d++,S.delete()));o.push(f.next(()=>{G(1===d)}));const g=[];for(const I of t.mutations){const A=Nc(e,I.key.path,t.batchId);o.push(i.delete(A)),g.push(I.key)}return F.waitFor(o).next(()=>g)}function la(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw D();e=r.noDocument}return JSON.stringify(e).length}Ot.DEFAULT_COLLECTION_PERCENTILE=10,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ot.DEFAULT=new Ot(41943040,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ot.DISABLED=new Ot(-1,0,0);class Nu{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){G(""!==e.uid);const o=e.isAuthenticated()?e.uid:"";return new Nu(o,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Qt(e).J({index:"userMutationsIndex",range:n},(i,o,c)=>{t=!1,c.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const o=Wi(e),c=Qt(e);return c.add({}).next(d=>{G("number"==typeof d);const f=new du(d,t,n,i),g=function(U,X,re){const Z=re.baseMutations.map(_e=>ks(U.ct,_e)),de=re.mutations.map(_e=>ks(U.ct,_e));return{userId:X,batchId:re.batchId,localWriteTimeMs:re.localWriteTime.toMillis(),baseMutations:Z,mutations:de}}(this.serializer,this.userId,f),I=[];let A=new ze((S,U)=>Ae(S.canonicalString(),U.canonicalString()));for(const S of i){const U=Nc(this.userId,S.key.path,d);A=A.add(S.key.path.popLast()),I.push(c.put(g)),I.push(o.put(U,Ha))}return A.forEach(S=>{I.push(this.indexManager.addToCollectionParentIndex(e,S))}),e.addOnCommittedListener(()=>{this.Fn[d]=f.keys()}),F.waitFor(I).next(()=>f)})}lookupMutationBatch(e,t){return Qt(e).get(t).next(n=>n?(G(n.userId===this.userId),ii(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?F.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let o=null;return Qt(e).J({index:"userMutationsIndex",range:i},(c,d,f)=>{d.userId===this.userId&&(G(d.batchId>=n),o=ii(this.serializer,d)),f.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Qt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,o,c)=>{n=o.batchId,c.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Qt(e).U("userMutationsIndex",t).next(n=>n.map(i=>ii(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=xi(this.userId,t.path),i=IDBKeyRange.lowerBound(n),o=[];return Wi(e).J({range:i},(c,d,f)=>{const[g,I,A]=c,S=Tt(I);if(g===this.userId&&t.path.isEqual(S))return Qt(e).get(A).next(U=>{if(!U)throw D();G(U.userId===this.userId),o.push(ii(this.serializer,U))});f.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ze(Ae);const i=[];return t.forEach(o=>{const c=xi(this.userId,o.path),d=IDBKeyRange.lowerBound(c),f=Wi(e).J({range:d},(g,I,A)=>{const[S,U,X]=g,re=Tt(U);S===this.userId&&o.path.isEqual(re)?n=n.add(X):A.done()});i.push(f)}),F.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,o=xi(this.userId,n),c=IDBKeyRange.lowerBound(o);let d=new ze(Ae);return Wi(e).J({range:c},(f,g,I)=>{const[A,S,U]=f,X=Tt(S);A===this.userId&&n.isPrefixOf(X)?X.length===i&&(d=d.add(U)):I.done()}).next(()=>this.xn(e,d))}xn(e,t){const n=[],i=[];return t.forEach(o=>{i.push(Qt(e).get(o).next(c=>{if(null===c)throw D();G(c.userId===this.userId),n.push(ii(this.serializer,c))}))}),F.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Vu(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),F.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return F.resolve();const n=IDBKeyRange.lowerBound(function(c){return[c]}(this.userId)),i=[];return Wi(e).J({range:n},(o,c,d)=>{if(o[0]===this.userId){const f=Tt(o[1]);i.push(f)}else d.done()}).next(()=>{G(0===i.length)})})}containsKey(e,t){return Ll(e,this.userId,t)}Nn(e){return Ml(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ll(r,e,t){const n=xi(e,t.path),i=n[1],o=IDBKeyRange.lowerBound(n);let c=!1;return Wi(r).J({range:o,H:!0},(d,f,g)=>{const[I,A,S]=d;I===e&&A===i&&(c=!0),g.done()}).next(()=>c)}function Qt(r){return yt(r,"mutations")}function Wi(r){return yt(r,"documentMutations")}function Ml(r){return yt(r,"mutationQueues")}class ir{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ir(0)}static kn(){return new ir(-1)}}class Pd{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new ir(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>me.fromTimestamp(new nt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>br(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(G(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const o=[];return br(e).J((c,d)=>{const f=ji(d);f.sequenceNumber<=t&&null===n.get(f.targetId)&&(i++,o.push(this.removeTargetData(e,f)))}).next(()=>F.waitFor(o)).next(()=>i)}forEachTarget(e,t){return br(e).J((n,i)=>{const o=ji(i);t(o)})}qn(e){return Fl(e).get("targetGlobalKey").next(t=>(G(null!==t),t))}Qn(e,t){return Fl(e).put("targetGlobalKey",t)}Kn(e,t){return br(e).put(wl(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Fi(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let o=null;return br(e).J({range:i,index:"queryTargetsIndex"},(c,d,f)=>{const g=ji(d);Vo(t,g.target)&&(o=g,f.done())}).next(()=>o)}addMatchingKeys(e,t,n){const i=[],o=Cr(e);return t.forEach(c=>{const d=ot(c.path);i.push(o.put({targetId:n,path:d})),i.push(this.referenceDelegate.addReference(e,n,c))}),F.waitFor(i)}removeMatchingKeys(e,t,n){const i=Cr(e);return F.forEach(t,o=>{const c=ot(o.path);return F.waitFor([i.delete([n,c]),this.referenceDelegate.removeReference(e,n,o)])})}removeMatchingKeysForTargetId(e,t){const n=Cr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Cr(e);let o=ge();return i.J({range:n,H:!0},(c,d,f)=>{const g=Tt(c[1]),I=new ae(g);o=o.add(I)}).next(()=>o)}containsKey(e,t){const n=ot(t.path),i=IDBKeyRange.bound([n],[Ka(n)],!1,!0);let o=0;return Cr(e).J({index:"documentTargetsIndex",H:!0,range:i},([c,d],f,g)=>{0!==c&&(o++,g.done())}).next(()=>o>0)}ot(e,t){return br(e).get(t).next(n=>n?ji(n):null)}}function br(r){return yt(r,"targets")}function Fl(r){return yt(r,"targetGlobal")}function Cr(r){return yt(r,"targetDocuments")}function ha([r,e],[t,n]){const i=Ae(r,t);return 0===i?Ae(e,n):i}class bd{constructor(e){this.Un=e,this.buffer=new ze(ha),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();ha(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ul{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;ee("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,H.A)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){Ir(n)?ee("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield yr(n)}yield t.Hn(3e5)}))}}class ku{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return F.resolve(Bt.oe);const n=new bd(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(Ol)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ol):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,o,c,d,f,g;const I=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(ee("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),i=this.params.maximumSequenceNumbersToCollect):i=A,c=Date.now(),this.nthSequenceNumber(e,i))).next(A=>(n=A,d=Date.now(),this.removeTargets(e,n,t))).next(A=>(o=A,f=Date.now(),this.removeOrphanedDocuments(e,n))).next(A=>(g=Date.now(),vn()<=Ut.$b.DEBUG&&ee("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${c-I}ms\n\tDetermined least recently used ${i} in `+(d-c)+`ms\n\tRemoved ${o} targets in `+(f-d)+`ms\n\tRemoved ${A} documents in `+(g-f)+`ms\nTotal Duration: ${g-I}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:A})))}}class Cd{constructor(e,t){this.db=e,this.garbageCollector=function Bl(r,e){return new ku(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return da(e,n)}removeReference(e,t,n){return da(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return da(e,t)}nr(e,t){return function(i,o){let c=!1;return Ml(i).Y(d=>Ll(i,d,o).next(f=>(f&&(c=!0),F.resolve(!f)))).next(()=>c)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.tr(e,(c,d)=>{if(d<=t){const f=this.nr(e,c).next(g=>{if(!g)return o++,n.getEntry(e,c).next(()=>(n.removeEntry(c,me.min()),Cr(e).delete([0,ot(c.path)])))});i.push(f)}}).next(()=>F.waitFor(i)).next(()=>n.apply(e)).next(()=>o)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return da(e,t)}tr(e,t){const n=Cr(e);let i,o=Bt.oe;return n.J({index:"documentTargetsIndex"},([c,d],{path:f,sequenceNumber:g})=>{0===c?(o!==Bt.oe&&t(new ae(Tt(i)),o),o=g,i=f):o=Bt.oe}).next(()=>{o!==Bt.oe&&t(new ae(Tt(i)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function da(r,e){return Cr(r).put((i=r.currentSequenceNumber,{targetId:0,path:ot(e.path),sequenceNumber:i}));var i}class ql{constructor(){this.changes=new Un(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?F.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xd{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ui(e).put(n)}removeEntry(e,t,n){return ui(e).delete(function(o,c){const d=o.path.toArray();return[d.slice(0,d.length-2),d[d.length-2],na(c),d[d.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=it.newInvalidDocument(t);return ui(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ci(t))},(i,o)=>{n=this.ir(t,o)}).next(()=>n)}sr(e,t){let n={size:0,document:it.newInvalidDocument(t)};return ui(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ci(t))},(i,o)=>{n={document:this.ir(t,o),size:la(o)}}).next(()=>n)}getEntries(e,t){let n=Ht();return this._r(e,t,(i,o)=>{const c=this.ir(i,o);n=n.insert(i,c)}).next(()=>n)}ar(e,t){let n=Ht(),i=new We(ae.comparator);return this._r(e,t,(o,c)=>{const d=this.ir(o,c);n=n.insert(o,d),i=i.insert(o,la(c))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return F.resolve();let i=new ze(jl);t.forEach(f=>i=i.add(f));const o=IDBKeyRange.bound(ci(i.first()),ci(i.last())),c=i.getIterator();let d=c.getNext();return ui(e).J({index:"documentKeyIndex",range:o},(f,g,I)=>{const A=ae.fromSegments([...g.prefixPath,g.collectionGroup,g.documentId]);for(;d&&jl(d,A)<0;)n(d,null),d=c.getNext();d&&d.isEqual(A)&&(n(d,g),d=c.hasNext()?c.getNext():null),d?I.$(ci(d)):I.done()}).next(()=>{for(;d;)n(d,null),d=c.hasNext()?c.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,o){const c=t.path,d=[c.popLast().toArray(),c.lastSegment(),na(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],f=[c.popLast().toArray(),c.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ui(e).U(IDBKeyRange.bound(d,f,!0)).next(g=>{o?.incrementDocumentReadCount(g.length);let I=Ht();for(const A of g){const S=this.ir(ae.fromSegments(A.prefixPath.concat(A.collectionGroup,A.documentId)),A);S.isFoundDocument()&&(Hr(t,S)||i.has(S.key))&&(I=I.insert(S.key,S))}return I})}getAllFromCollectionGroup(e,t,n,i){let o=Ht();const c=fa(t,n),d=fa(t,an.max());return ui(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(c,d,!0)},(f,g,I)=>{const A=this.ir(ae.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);o=o.insert(A.key,A),o.size===i&&I.done()}).next(()=>o)}newChangeBuffer(e){return new Lu(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Kl(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return Kl(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function Ad(r,e){let t;if(e.document)t=_l(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=ae.fromSegments(e.noDocument.path),i=ri(e.noDocument.readTime);t=it.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return D();{const n=ae.fromSegments(e.unknownDocument.path),i=ri(e.unknownDocument.version);t=it.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const o=new nt(i[0],i[1]);return me.fromTimestamp(o)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(me.min()))return n}return it.newInvalidDocument(e)}}function Ou(r){return new xd(r)}class Lu extends ql{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Un(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ze((o,c)=>Ae(o.canonicalString(),c.canonicalString()));return this.changes.forEach((o,c)=>{const d=this.lr.get(o);if(t.push(this.cr.removeEntry(e,o,d.readTime)),c.isValidDocument()){const f=Tl(this.cr.serializer,c);i=i.add(o.path.popLast());const g=la(f);n+=g-d.size,t.push(this.cr.addEntry(e,o,f))}else if(n-=d.size,this.trackRemovals){const f=Tl(this.cr.serializer,c.convertToNoDocument(me.min()));t.push(this.cr.addEntry(e,o,f))}}),i.forEach(o=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,o))}),t.push(this.cr.updateMetadata(e,n)),F.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((o,c)=>{this.lr.set(o,{size:c,readTime:n.get(o).readTime})}),n))}}function Kl(r){return yt(r,"remoteDocumentGlobal")}function ui(r){return yt(r,"remoteDocumentsV14")}function ci(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function fa(r,e){const t=e.documentKey.path.toArray();return[r,na(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let o=0;o<t.length-2&&o<n.length-2;++o)if(i=Ae(t[o],n[o]),i)return i;return i=Ae(t.length,n.length),i||(i=Ae(t[t.length-2],n[n.length-2]),i||Ae(t[t.length-1],n[n.length-1]))}class Dd{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ks{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&bs(n.mutation,i,kt.empty(),nt.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ge()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ge()){const i=xt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(o=>{let c=Rr();return o.forEach((d,f)=>{c=c.insert(d,f.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){const n=xt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ge()))}populateOverlays(e,t,n){const i=[];return n.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((c,d)=>{t.set(c,d)})})}computeViews(e,t,n,i){let o=Ht();const c=Ts(),d=Ts();return t.forEach((f,g)=>{const I=n.get(g.key);i.has(g.key)&&(void 0===I||I.mutation instanceof tr)?o=o.insert(g.key,g):void 0!==I?(c.set(g.key,I.mutation.getFieldMask()),bs(I.mutation,g,I.mutation.getFieldMask(),nt.now())):c.set(g.key,kt.empty())}),this.recalculateAndSaveOverlays(e,o).next(f=>(f.forEach((g,I)=>c.set(g,I)),t.forEach((g,I)=>{var A;return d.set(g,new Dd(I,null!==(A=c.get(g))&&void 0!==A?A:null))}),d))}recalculateAndSaveOverlays(e,t){const n=Ts();let i=new We((c,d)=>c-d),o=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(const d of c)d.keys().forEach(f=>{const g=t.get(f);if(null===g)return;let I=n.get(f)||kt.empty();I=d.applyToLocalView(g,I),n.set(f,I);const A=(i.get(d.batchId)||ge()).add(f);i=i.insert(d.batchId,A)})}).next(()=>{const c=[],d=i.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),g=f.key,I=f.value,A=nl();I.forEach(S=>{if(!o.has(S)){const U=al(t.get(S),n.get(S));null!==U&&A.set(S,U),o=o.add(S)}}),c.push(this.documentOverlayCache.saveOverlays(e,g,A))}return F.waitFor(c)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return ae.isDocumentKey((c=t).path)&&null===c.collectionGroup&&0===c.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Xc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var c}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(o=>{const c=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-o.size):F.resolve(xt());let d=-1,f=o;return c.next(g=>F.forEach(g,(I,A)=>(d<A.largestBatchId&&(d=A.largestBatchId),o.get(I)?F.resolve():this.remoteDocumentCache.getEntry(e,I).next(S=>{f=f.insert(I,S)}))).next(()=>this.populateOverlays(e,g,o)).next(()=>this.computeViews(e,f,g,ge())).next(I=>({batchId:d,changes:ud(I)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ae(t)).next(n=>{let i=Rr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const o=t.collectionGroup;let c=Rr();return this.indexManager.getCollectionParents(e,o).next(d=>F.forEach(d,f=>{const g=(A=t,S=f.child(o),new Tr(S,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt));var A,S;return this.getDocumentsMatchingCollectionQuery(e,g,n,i).next(I=>{I.forEach((A,S)=>{c=c.insert(A,S)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,n,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(c=>(o=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,i))).next(c=>{o.forEach((f,g)=>{const I=g.getKey();null===c.get(I)&&(c=c.insert(I,it.newInvalidDocument(I)))});let d=Rr();return c.forEach((f,g)=>{const I=o.get(f);void 0!==I&&bs(I.mutation,g,kt.empty(),nt.now()),Hr(t,g)&&(d=d.insert(f,g))}),d})}}class Vd{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return F.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:gt(i.createTime)}),F.resolve();var i}getNamedQuery(e,t){return F.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:zi(i.bundledQuery),readTime:gt(i.readTime)}),F.resolve();var i}}class Nd{constructor(){this.overlays=new We(ae.comparator),this.Ir=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){const n=xt();return F.forEach(t,i=>this.getOverlay(e,i).next(o=>{null!==o&&n.set(i,o)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,o)=>{this.ht(e,t,o)}),F.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Ir.delete(n)),F.resolve()}getOverlaysForCollection(e,t,n){const i=xt(),o=t.length+1,c=new ae(t.child("")),d=this.overlays.getIteratorFrom(c);for(;d.hasNext();){const f=d.getNext().value,g=f.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===o&&f.largestBatchId>n&&i.set(f.getKey(),f)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let o=new We((g,I)=>g-I);const c=this.overlays.getIterator();for(;c.hasNext();){const g=c.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>n){let I=o.get(g.largestBatchId);null===I&&(I=xt(),o=o.insert(g.largestBatchId,I)),I.set(g.getKey(),g)}}const d=xt(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((g,I)=>d.set(g,I)),!(d.size()>=i)););return F.resolve(d)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const c=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(n.key,new zo(t,n));let o=this.Ir.get(t);void 0===o&&(o=ge(),this.Ir.set(t,o)),this.Ir.set(t,o.add(n.key))}}class kd{constructor(){this.sessionToken=at.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}}class pa{constructor(){this.Tr=new ze(bt.Er),this.dr=new ze(bt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new bt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new bt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new ae(new De([])),n=new bt(t,e),i=new bt(t,e+1),o=[];return this.dr.forEachInRange([n,i],c=>{this.Vr(c),o.push(c.key)}),o}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ae(new De([])),n=new bt(t,e),i=new bt(t,e+1);let o=ge();return this.dr.forEachInRange([n,i],c=>{o=o.add(c.key)}),o}containsKey(e){const t=new bt(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class bt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ae.comparator(e.key,t.key)||Ae(e.wr,t.wr)}static Ar(e,t){return Ae(e.wr,t.wr)||ae.comparator(e.key,t.key)}}class Od{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ze(bt.Er)}checkEmpty(e){return F.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const o=this.Sr;this.Sr++;const c=new du(o,t,n,i);this.mutationQueue.push(c);for(const d of i)this.br=this.br.add(new bt(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return F.resolve(c)}lookupMutationBatch(e,t){return F.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),o=i<0?0:i;return F.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new bt(t,0),i=new bt(t,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([n,i],c=>{const d=this.Dr(c.wr);o.push(d)}),F.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ze(Ae);return t.forEach(i=>{const o=new bt(i,0),c=new bt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([o,c],d=>{n=n.add(d.wr)})}),F.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let o=n;ae.isDocumentKey(o)||(o=o.child(""));const c=new bt(new ae(o),0);let d=new ze(Ae);return this.br.forEachWhile(f=>{const g=f.key.path;return!!n.isPrefixOf(g)&&(g.length===i&&(d=d.add(f.wr)),!0)},c),F.resolve(this.Cr(d))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){G(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return F.forEach(t.mutations,i=>{const o=new bt(i.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new bt(t,0),i=this.br.firstAfterOrEqual(n);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return F.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ld{constructor(e){this.Mr=e,this.docs=new We(ae.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),o=i?i.size:0,c=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:c}),this.size+=c-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return F.resolve(n?n.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let n=Ht();return t.forEach(i=>{const o=this.docs.get(i);n=n.insert(i,o?o.document.mutableCopy():it.newInvalidDocument(i))}),F.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let o=Ht();const c=t.path,d=new ae(c.child("")),f=this.docs.getIteratorFrom(d);for(;f.hasNext();){const{key:g,value:{document:I}}=f.getNext();if(!c.isPrefixOf(g.path))break;g.path.length>c.length+1||hs(_o(I),n)<=0||(i.has(I.key)||Hr(t,I))&&(o=o.insert(I.key,I.mutableCopy()))}return F.resolve(o)}getAllFromCollectionGroup(e,t,n,i){D()}Or(e,t){return F.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Md(this)}getSize(e){return F.resolve(this.size)}}class Md extends ql{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),F.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class js{constructor(e){this.persistence=e,this.Nr=new Un(t=>Fi(t),Vo),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.Lr=0,this.Br=new pa,this.targetCount=0,this.kr=ir.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),F.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ir(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.Kn(t),F.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,n){let i=0;const o=[];return this.Nr.forEach((c,d)=>{d.sequenceNumber<=t&&null===n.get(d.targetId)&&(this.Nr.delete(c),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),F.waitFor(o).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return F.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),F.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(c=>{o.push(i.markPotentiallyOrphaned(e,c))}),F.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),F.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return F.resolve(n)}containsKey(e,t){return F.resolve(this.Br.containsKey(t))}}class Mu{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Bt(0),this.Kr=!1,this.Kr=!0,this.$r=new kd,this.referenceDelegate=e(this),this.Ur=new js(this),this.indexManager=new Bp,this.remoteDocumentCache=new Ld(n=>this.referenceDelegate.Wr(n)),this.serializer=new ta(t),this.Gr=new Vd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Nd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Od(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){ee("MemoryPersistence","Starting transaction:",e);const i=new zl(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(o=>this.referenceDelegate.jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Hr(e,t){return F.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class zl extends yo{constructor(e){super(),this.currentSequenceNumber=e}}class ma{constructor(e){this.persistence=e,this.Jr=new pa,this.Yr=null}static Zr(e){return new ma(e)}get Xr(){if(this.Yr)return this.Yr;throw D()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),F.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),F.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.Xr.add(o.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.Xr,n=>{const i=ae.fromPath(n);return this.ei(e,i).next(o=>{o||t.removeEntry(i,me.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return F.or([()=>F.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Fd{constructor(e){this.serializer=e}O(e,t,n,i){const o=new bi("createOrUpgrade",t);var f;n<1&&i>=1&&(e.createObjectStore("owner"),(f=e).createObjectStore("mutationQueues",{keyPath:"userId"}),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vc,{unique:!0}),f.createObjectStore("documentMutations"),Gl(e),function(f){f.createObjectStore("remoteDocuments")}(e));let c=F.resolve();return n<3&&i>=3&&(0!==n&&(function(f){f.deleteObjectStore("targetDocuments"),f.deleteObjectStore("targets"),f.deleteObjectStore("targetGlobal")}(e),Gl(e)),c=c.next(()=>function(f){const g=f.store("targetGlobal"),I={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:me.min().toTimestamp(),targetCount:0};return g.put("targetGlobalKey",I)}(o))),n<4&&i>=4&&(0!==n&&(c=c.next(()=>function(f,g){return g.store("mutations").U().next(I=>{f.deleteObjectStore("mutations"),f.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vc,{unique:!0});const A=g.store("mutations"),S=I.map(U=>A.put(U));return F.waitFor(S)})}(e,o))),c=c.next(()=>{!function(f){f.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(c=c.next(()=>this.ni(o))),n<6&&i>=6&&(c=c.next(()=>(function(f){f.createObjectStore("remoteDocumentGlobal")}(e),this.ri(o)))),n<7&&i>=7&&(c=c.next(()=>this.ii(o))),n<8&&i>=8&&(c=c.next(()=>this.si(e,o))),n<9&&i>=9&&(c=c.next(()=>{!function(f){f.objectStoreNames.contains("remoteDocumentChanges")&&f.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(c=c.next(()=>this.oi(o))),n<11&&i>=11&&(c=c.next(()=>{(function(f){f.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(f){f.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(c=c.next(()=>{!function(f){const g=f.createObjectStore("documentOverlays",{keyPath:Jn});g.createIndex("collectionPathOverlayIndex",Di,{unique:!1}),g.createIndex("collectionGroupOverlayIndex",Vi,{unique:!1})}(e)})),n<13&&i>=13&&(c=c.next(()=>function(f){const g=f.createObjectStore("remoteDocumentsV14",{keyPath:Gh});g.createIndex("documentKeyIndex",Qa),g.createIndex("collectionGroupIndex",Wh)}(e)).next(()=>this._i(e,o)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(c=c.next(()=>this.ai(e,o))),n<15&&i>=15&&(c=c.next(()=>function(f){f.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),f.createObjectStore("indexState",{keyPath:Qh}).createIndex("sequenceNumberIndex",ps,{unique:!1}),f.createObjectStore("indexEntries",{keyPath:Up}).createIndex("documentKeyIndex",Ya,{unique:!1})}(e))),n<16&&i>=16&&(c=c.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(c=c.next(()=>{!function(f){f.createObjectStore("globals",{keyPath:"name"})}(e)})),c}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=la(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>F.forEach(i,o=>{const c=IDBKeyRange.bound([o.userId,-1],[o.userId,o.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",c).next(d=>F.forEach(d,f=>{G(f.userId===o.userId);const g=ii(this.serializer,f);return Vu(e,o.userId,g).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const o=[];return n.J((c,d)=>{const f=new De(c),g=[0,ot(f)];o.push(t.get(g).next(I=>I?F.resolve():t.put({targetId:0,path:ot(f),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>F.waitFor(o))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Hh});const n=t.store("collectionParents"),i=new Us,o=c=>{if(i.add(c)){const d=c.lastSegment(),f=c.popLast();return n.put({collectionId:d,parent:ot(f)})}};return t.store("remoteDocuments").J({H:!0},(c,d)=>{const f=new De(c);return o(f.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([c,d,f],g)=>{const I=Tt(d);return o(I.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const o=ji(i),c=wl(this.serializer,o);return t.put(c)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((o,c)=>{const d=t.store("remoteDocumentsV14"),f=(A=c,A.document?new ae(De.fromString(A.document.name).popFirst(5)):A.noDocument?ae.fromSegments(A.noDocument.path):A.unknownDocument?ae.fromSegments(A.unknownDocument.path):D()).path.toArray(),g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:c.readTime||[0,0],unknownDocument:c.unknownDocument,noDocument:c.noDocument,document:c.document,hasCommittedMutations:!!c.hasCommittedMutations};var A;i.push(d.put(g))}).next(()=>F.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=Ou(this.serializer),o=new Mu(ma.Zr,this.serializer.ct);return n.U().next(c=>{const d=new Map;return c.forEach(f=>{var g;let I=null!==(g=d.get(f.userId))&&void 0!==g?g:ge();ii(this.serializer,f).keys().forEach(A=>I=I.add(A)),d.set(f.userId,I)}),F.forEach(d,(f,g)=>{const I=new ct(g),A=ra.lt(this.serializer,I),S=o.getIndexManager(I),U=Nu.lt(I,this.serializer,S,o.referenceDelegate);return new Ks(i,U,A,S).recalculateAndSaveOverlaysForDocumentKeys(new Ao(t,Bt.oe),f).next()})})}}function Gl(r){r.createObjectStore("targetDocuments",{keyPath:Ja}).createIndex("documentTargetsIndex",Kr,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",$h,{unique:!0}),r.createObjectStore("targetGlobal")}const _a="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class zs{constructor(e,t,n,i,o,c,d,f,g,I,A=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=o,this.window=c,this.document=d,this.ci=g,this.li=I,this.hi=A,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=S=>Promise.resolve(),!zs.D())throw new $(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cd(this,i),this.Ai=t+"main",this.serializer=new ta(f),this.Ri=new un(this.Ai,this.hi,new Fd(this.serializer)),this.$r=new bu,this.Ur=new Pd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ou(this.serializer),this.Gr=new Td,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===I&&He("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new $(N.FAILED_PRECONDITION,_a);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Bt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,H.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,H.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,H.A)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Gs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ir(e))return ee("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ee("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return li(e).get("owner").next(t=>F.resolve(this.vi(t)))}Ci(e){return Gs(e).delete(this.clientId)}Fi(){var e=this;return(0,H.A)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=yt(n,"clientMetadata");return i.U().next(o=>{const c=e.xi(o,18e5),d=o.filter(f=>-1===c.indexOf(f));return F.forEach(d,f=>i.delete(f.clientId)).next(()=>d)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?F.resolve(!0):li(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new $(N.FAILED_PRECONDITION,_a);return!1}}return!(!this.networkEnabled||!this.inForeground)||Gs(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&ee("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,H.A)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new Ao(t,Bt.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Gs(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Nu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ca(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ra.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){ee("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",o=17===(f=this.hi)?Eo:16===f?Jh:15===f?vr:14===f?Oc:13===f?Za:12===f?kc:11===f?Xa:void D();var f;let c;return this.Ri.runTransaction(e,i,o,d=>(c=new Ao(d,this.Qr?this.Qr.next():Bt.oe),"readwrite-primary"===t?this.wi(c).next(f=>!!f||this.Si(c)).next(f=>{if(!f)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new $(N.FAILED_PRECONDITION,xc);return n(c)}).next(f=>this.Di(c).next(()=>f)):this.Ki(c).next(()=>n(c)))).then(d=>(c.raiseOnCommittedEvent(),d))}Ki(e){return li(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new $(N.FAILED_PRECONDITION,_a)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return li(e).put("owner",t)}static D(){return un.D()}bi(e){const t=li(e);return t.get("owner").next(n=>this.vi(n)?(ee("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):F.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(He(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,Me.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return ee("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return He("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function li(r){return yt(r,"owner")}function Gs(r){return yt(r,"clientMetadata")}function Fu(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Ws{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=ge(),i=ge();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new Ws(e,t.fromCache,n,i)}}class Ud{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Jt{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,Me.nr)()?8:Io((0,Me.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const o={result:null};return this.Yi(e,t).next(c=>{o.result=c}).next(()=>{if(!o.result)return this.Zi(e,t,i,n).next(c=>{o.result=c})}).next(()=>{if(o.result)return;const c=new Ud;return this.Xi(e,t,c).next(d=>{if(o.result=d,this.zi)return this.es(e,t,c,d.size)})}).next(()=>o.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(vn()<=Ut.$b.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",Bi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),F.resolve()):(vn()<=Ut.$b.DEBUG&&ee("QueryEngine","Query:",Bi(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(vn()<=Ut.$b.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",Bi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,pt(t))):F.resolve())}Yi(e,t){if(sd(t))return F.resolve(null);let n=pt(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Oo(t,null,"F"),n=pt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const c=ge(...o);return this.Ji.getDocuments(e,c).next(d=>this.indexManager.getMinOffset(e,n).next(f=>{const g=this.ts(t,d);return this.ns(t,g,c,f.readTime)?this.Yi(e,Oo(t,null,"F")):this.rs(e,g,t,f)}))})))}Zi(e,t,n,i){return sd(t)||i.isEqual(me.min())?F.resolve(null):this.Ji.getDocuments(e,n).next(o=>{const c=this.ts(t,o);return this.ns(t,c,n,i)?F.resolve(null):(vn()<=Ut.$b.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Bi(t)),this.rs(e,c,t,ja(i,-1)).next(d=>d))})}ts(e,t){let n=new ze(tl(e));return t.forEach((i,o)=>{Hr(e,o)&&(n=n.add(o))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const o="F"===e.limitType?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Xi(e,t,n){return vn()<=Ut.$b.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",Bi(t)),this.Ji.getDocumentsMatchingQuery(e,t,an.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(o=>(t.forEach(c=>{o=o.insert(c.key,c)}),o))}}class $s{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new We(Ae),this._s=new Un(o=>Fi(o),Vo),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ks(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Uu(r,e,t,n){return new $s(r,e,t,n)}function Wl(r,e){return Hs.apply(this,arguments)}function Hs(){return(Hs=(0,H.A)(function*(r,e){const t=J(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(o=>(i=o,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(o=>{const c=[],d=[];let f=ge();for(const g of i){c.push(g.batchId);for(const I of g.mutations)f=f.add(I.key)}for(const g of o){d.push(g.batchId);for(const I of g.mutations)f=f.add(I.key)}return t.localDocuments.getDocuments(n,f).next(g=>({hs:g,removedBatchIds:c,addedBatchIds:d}))})})})).apply(this,arguments)}function $l(r){const e=J(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Ql(r,e,t){let n=ge(),i=ge();return t.forEach(o=>n=n.add(o)),e.getEntries(r,n).next(o=>{let c=Ht();return t.forEach((d,f)=>{const g=o.get(d);f.isFoundDocument()!==g.isFoundDocument()&&(i=i.add(d)),f.isNoDocument()&&f.version.isEqual(me.min())?(e.removeEntry(d,f.readTime),c=c.insert(d,f)):!g.isValidDocument()||f.version.compareTo(g.version)>0||0===f.version.compareTo(g.version)&&g.hasPendingWrites?(e.addEntry(f),c=c.insert(d,f)):ee("LocalStore","Ignoring outdated watch update for ",d,". Current version:",g.version," Watch version:",f.version)}),{Ps:c,Is:i}})}function xr(r,e){const t=J(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function hi(r,e){const t=J(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(o=>o?(i=o,F.resolve(i)):t.Ur.allocateTargetId(n).next(c=>(i=new qn(e,c,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function $i(r,e,t){return qu.apply(this,arguments)}function qu(){return(qu=(0,H.A)(function*(r,e,t){const n=J(r),i=n.os.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",o,c=>n.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!Ir(c))throw c;ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${c}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function ya(r,e,t){const n=J(r);let i=me.min(),o=ge();return n.persistence.runTransaction("Execute query","readwrite",c=>function(f,g,I){const A=J(f),S=A._s.get(I);return void 0!==S?F.resolve(A.os.get(S)):A.Ur.getTargetData(g,I)}(n,c,pt(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(c,d.targetId).next(f=>{o=f})}).next(()=>n.ss.getDocumentsMatchingQuery(c,e,t?i:me.min(),t?o:ge())).next(d=>(Ia(n,Mo(e),d),{documents:d,Ts:o})))}function Ku(r,e){const t=J(r),n=J(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",o=>n.ot(o,e).next(c=>c?c.target:null))}function qt(r,e){const t=J(r),n=t.us.get(e)||me.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,ja(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Ia(t,e,i),i))}function Ia(r,e,t){let n=r.us.get(e)||me.min();t.forEach((i,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.us.set(e,n)}function zu(){return(zu=(0,H.A)(function*(r,e,t,n){const i=J(r);let o=ge(),c=Ht();for(const g of t){const I=e.Es(g.metadata.name);g.document&&(o=o.add(I));const A=e.ds(g);A.setReadTime(e.As(g.metadata.readTime)),c=c.insert(I,A)}const d=i.cs.newChangeBuffer({trackRemovals:!0}),f=yield hi(i,(I=n,pt(As(De.fromString(`__bundle__/docs/${I}`)))));var I;return i.persistence.runTransaction("Apply bundle documents","readwrite",g=>Ql(g,d,c).next(I=>(d.apply(g),I)).next(I=>i.Ur.removeMatchingKeysForTargetId(g,f.targetId).next(()=>i.Ur.addMatchingKeys(g,o,f.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(g,I.Ps,I.Is)).next(()=>I.Ps)))})).apply(this,arguments)}function sr(r,e){return di.apply(this,arguments)}function di(){return(di=(0,H.A)(function*(r,e,t=ge()){const n=yield hi(r,pt(zi(e.bundledQuery))),i=J(r);return i.persistence.runTransaction("Save named query","readwrite",o=>{const c=gt(e.readTime);if(n.snapshotVersion.compareTo(c)>=0)return i.Gr.saveNamedQuery(o,e);const d=n.withResumeToken(at.EMPTY_BYTE_STRING,c);return i.os=i.os.insert(d.targetId,d),i.Ur.updateTargetData(o,d).next(()=>i.Ur.removeMatchingKeysForTargetId(o,n.targetId)).next(()=>i.Ur.addMatchingKeys(o,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(o,e))})})).apply(this,arguments)}function Gu(r,e){return`firestore_clients_${r}_${e}`}function Wu(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function $u(r,e){return`firestore_targets_${r}_${e}`}class Hi{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let o,c="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return c&&i.error&&(c="string"==typeof i.error.message&&"string"==typeof i.error.code,c&&(o=new $(i.error.code,i.error.message))),c?new Hi(e,t,i.state,o):(He("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Qs{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,o="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return o&&n.error&&(o="string"==typeof n.error.message&&"string"==typeof n.error.code,o&&(i=new $(n.error.code,n.error.message))),o?new Qs(e,n.state,i):(He("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class va{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,o=Rs();for(let c=0;i&&c<n.activeTargetIds.length;++c)i=Ci(n.activeTargetIds[c]),o=o.add(n.activeTargetIds[c]);return i?new va(e,o):(He("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hu{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Hu(t.clientId,t.onlineState):(He("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Qu{constructor(){this.activeTargetIds=Rs()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class l{constructor(e,t,n,i,o){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new We(Ae),this.started=!1,this.bs=[];const c=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Ds=Gu(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new Qu),this.Cs=new RegExp(`^firestore_clients_${c}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${c}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${c}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(f){return`firestore_bundle_loaded_v2_${f}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,H.A)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const o=e.getItem(Gu(e.persistenceKey,i));if(o){const c=va.Rs(i,o);c&&(e.Ss=e.Ss.insert(c.clientId,c))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem($u(this.persistenceKey,e));if(n){const i=Qs.Rs(e,n);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($u(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ee("SharedClientState","READ",e,t),t}setItem(e,t){ee("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ee("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(ee("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void He("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,H.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(c){let d=Bt.oe;if(null!=c)try{const f=JSON.parse(c);G("number"==typeof f),d=f}catch(f){He("SharedClientState","Failed to read sequence number from WebStorage",f)}return d}(n.newValue);i!==Bt.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(o=>t.syncEngine.eo(o)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new Hi(this.currentUser,e,t,n),o=Wu(this.persistenceKey,this.currentUser,e);this.setItem(o,i.Vs())}Qs(e){const t=Wu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=$u(this.persistenceKey,e),o=new Qs(e,t,n);this.setItem(i,o.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return va.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return Hi.Rs(new ct(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return Qs.Rs(i,t)}Ls(e){return Hu.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,H.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);ee("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),o=this.ks(n),c=[],d=[];return o.forEach(f=>{i.has(f)||c.push(f)}),i.forEach(f=>{o.has(f)||d.push(f)}),this.syncEngine.io(c,d).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Rs();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class s{constructor(){this.so=new Qu,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Qu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class a{_o(e){}shutdown(){}}class h{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let m=null;function y(){return null===m?m=268435456+Math.round(2147483648*Math.random()):m++,"0x"+m.toString(16)}const w={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class O{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const z="WebChannelConnection";class oe extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${o}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${o}`}get Fo(){return!1}Mo(t,n,i,o,c){const d=y(),f=this.xo(t,n.toUriEncodedString());ee("RestConnection",`Sending RPC '${t}' ${d}:`,f,i);const g={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(g,o,c),this.No(t,f,g,i).then(I=>(ee("RestConnection",`Received RPC '${t}' ${d}: `,I),I),I=>{throw K("RestConnection",`RPC '${t}' ${d} failed with error: `,I,"url: ",f,"request:",i),I})}Lo(t,n,i,o,c,d){return this.Mo(t,n,i,o,c)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Hn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((o,c)=>t[c]=o),i&&i.headers.forEach((o,c)=>t[c]=o)}xo(t,n){return`${this.Do}/v1/${n}:${w[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const o=y();return new Promise((c,d)=>{const f=new q;f.setWithCredentials(!0),f.listenOnce(xe.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case Ct.NO_ERROR:const I=f.getResponseJson();ee(z,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(I)),c(I);break;case Ct.TIMEOUT:ee(z,`RPC '${e}' ${o} timed out`),d(new $(N.DEADLINE_EXCEEDED,"Request time out"));break;case Ct.HTTP_ERROR:const A=f.getStatus();if(ee(z,`RPC '${e}' ${o} failed with status:`,A,"response text:",f.getResponseText()),A>0){let S=f.getResponseJson();Array.isArray(S)&&(S=S[0]);const U=S?.error;if(U&&U.status&&U.message){const X=function(Z){const de=Z.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(de)>=0?de:N.UNKNOWN}(U.status);d(new $(X,U.message))}else d(new $(N.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new $(N.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{ee(z,`RPC '${e}' ${o} completed.`)}});const g=JSON.stringify(i);ee(z,`RPC '${e}' ${o} sending request:`,i),f.send(t,"POST",g,n,15)})}Bo(e,t,n){const i=y(),o=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=Nt(),d=be(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;void 0!==g&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.xmlHttpFactory=new ce({})),this.Oo(f.initMessageHeaders,t,n),f.encodeInitMessageHeaders=!0;const I=o.join("");ee(z,`Creating RPC '${e}' stream ${i}: ${I}`,f);const A=c.createWebChannel(I,f);let S=!1,U=!1;const X=new O({Io:Z=>{U?ee(z,`Not sending because RPC '${e}' stream ${i} is closed:`,Z):(S||(ee(z,`Opening RPC '${e}' stream ${i} transport.`),A.open(),S=!0),ee(z,`RPC '${e}' stream ${i} sending:`,Z),A.send(Z))},To:()=>A.close()}),re=(Z,de,_e)=>{Z.listen(de,se=>{try{_e(se)}catch(ye){setTimeout(()=>{throw ye},0)}})};return re(A,ve.EventType.OPEN,()=>{U||(ee(z,`RPC '${e}' stream ${i} transport opened.`),X.yo())}),re(A,ve.EventType.CLOSE,()=>{U||(U=!0,ee(z,`RPC '${e}' stream ${i} transport closed`),X.So())}),re(A,ve.EventType.ERROR,Z=>{U||(U=!0,K(z,`RPC '${e}' stream ${i} transport errored:`,Z),X.So(new $(N.UNAVAILABLE,"The operation could not be completed")))}),re(A,ve.EventType.MESSAGE,Z=>{var de;if(!U){const _e=Z.data[0];G(!!_e);const ye=_e.error||(null===(de=_e[0])||void 0===de?void 0:de.error);if(ye){ee(z,`RPC '${e}' stream ${i} received error:`,ye);const Se=ye.status;let Ce=function(C){const k=It[C];if(void 0!==k)return Go(k)}(Se),V=ye.message;void 0===Ce&&(Ce=N.INTERNAL,V="Unknown error status: "+Se+" with message "+ye.message),U=!0,X.So(new $(Ce,V)),A.close()}else ee(z,`RPC '${e}' stream ${i} received:`,_e),X.bo(_e)}}),re(d,_t.STAT_EVENT,Z=>{Z.stat===et.PROXY?ee(z,`RPC '${e}' stream ${i} detected buffering proxy`):Z.stat===et.NOPROXY&&ee(z,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{X.wo()},0),X}}function he(){return typeof window<"u"?window:null}function le(){return typeof document<"u"?document:null}function Ye(r){return new vd(r,!0)}class cn{constructor(e,t,n=1e3,i=1.5,o=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&ee("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Js{constructor(e,t,n,i,o,c,d,f){this.ui=e,this.Ho=n,this.Jo=i,this.connection=o,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new cn(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,H.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,H.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,H.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===N.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new $(N.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,H.A)(function*(){e.state=0,e.start()}))}I_(e){return ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Jl extends Js{constructor(e,t,n,i,o,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,c),this.serializer=o}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function vu(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(g=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===g?1:"REMOVE"===g?2:"CURRENT"===g?3:"RESET"===g?4:D(),i=e.targetChange.targetIds||[],o=function(g,I){return g.useProto3Json?(G(void 0===I||"string"==typeof I),at.fromBase64String(I||"")):(G(void 0===I||I instanceof Buffer||I instanceof Uint8Array),at.fromUint8Array(I||new Uint8Array))}(r,e.targetChange.resumeToken),c=e.targetChange.cause,d=c&&function(g){const I=void 0===g.code?N.UNKNOWN:Go(g.code);return new $(I,g.message||"")}(c);t=new fl(n,i,o,d||null)}else if("documentChange"in e){const n=e.documentChange,i=An(r,n.document.name),o=gt(n.document.updateTime),c=n.document.createTime?gt(n.document.createTime):me.min(),d=new Rt({mapValue:{fields:n.document.fields}}),f=it.newFoundDocument(i,o,c,d);t=new Bn(n.targetIds||[],n.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const n=e.documentDelete,i=An(r,n.document),o=n.readTime?gt(n.readTime):me.min(),c=it.newNoDocument(i,o);t=new Bn([],n.removedTargetIds||[],c.key,c)}else if("documentRemove"in e){const n=e.documentRemove,i=An(r,n.document);t=new Bn([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return D();{const n=e.filter,{count:i=0,unchangedNames:o}=n,c=new md(i,o);t=new Qo(n.targetId,c)}}var g;return t}(this.serializer,e),n=function(o){if(!("targetChange"in o))return me.min();const c=o.targetChange;return c.targetIds&&c.targetIds.length?me.min():c.readTime?gt(c.readTime):me.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Ns(this.serializer),t.addTarget=function(o,c){let d;const f=c.target;if(d=Ui(f)?{documents:yl(o,f)}:{query:Zo(o,f)._t},d.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){d.resumeToken=Yo(o,c.resumeToken);const g=Vs(o,c.expectedCount);null!==g&&(d.expectedCount=g)}else if(c.snapshotVersion.compareTo(me.min())>0){d.readTime=Ki(o,c.snapshotVersion.toTimestamp());const g=Vs(o,c.expectedCount);null!==g&&(d.expectedCount=g)}return d}(this.serializer,e);const n=function Tu(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Ns(this.serializer),t.removeTarget=e,this.a_(t)}}class Ju extends Js{constructor(e,t,n,i,o,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,c),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function Au(r,e){return r&&r.length>0?(G(void 0!==e),r.map(t=>function(i,o){let c=gt(i.updateTime?i.updateTime:o);return c.isEqual(me.min())&&(c=gt(o)),new dd(c,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=gt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Ns(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>ks(this.serializer,n))};this.a_(t)}}class Yl extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new $(N.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Mo(e,_u(t,n),i,o,c)).catch(o=>{throw"FirebaseError"===o.name?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new $(N.UNKNOWN,o.toString())})}Lo(e,t,n,i,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,d])=>this.connection.Lo(e,_u(t,n),i,c,d,o)).catch(c=>{throw"FirebaseError"===c.name?(c.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new $(N.UNKNOWN,c.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Xl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(He(t),this.D_=!1):ee("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class Yu{constructor(e,t,n,i,o){var c=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(d=>{n.enqueueAndForget((0,H.A)(function*(){var f;Ji(c)&&(ee("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,H.A)(function*(I){const A=J(I);A.L_.add(4),yield Dr(A),A.q_.set("Unknown"),A.L_.delete(4),yield Qi(A)}),function g(I){return f.apply(this,arguments)})(c))}))}),this.q_=new Xl(n,i)}}function Qi(r){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,H.A)(function*(r){if(Ji(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function Dr(r){return Aa.apply(this,arguments)}function Aa(){return(Aa=(0,H.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Ta(r,e){const t=J(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),qd(t)?Bd(t):Ra(t).r_()&&Xu(t,e))}function Vr(r,e){const t=J(r),n=Ra(t);t.N_.delete(e),n.r_()&&qp(t,e),0===t.N_.size&&(n.r_()?n.o_():Ji(t)&&t.q_.set("Unknown"))}function Xu(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ra(r).A_(e)}function qp(r,e){r.Q_.xe(e),Ra(r).R_(e)}function Bd(r){r.Q_=new _d({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),Ra(r).start(),r.q_.v_()}function qd(r){return Ji(r)&&!Ra(r).n_()&&r.N_.size>0}function Ji(r){return 0===J(r).L_.size}function Kp(r){r.Q_=void 0}function c_(r){return Kd.apply(this,arguments)}function Kd(){return(Kd=(0,H.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function l_(r){return jd.apply(this,arguments)}function jd(){return(jd=(0,H.A)(function*(r){r.N_.forEach((e,t)=>{Xu(r,e)})})).apply(this,arguments)}function h_(r,e){return zd.apply(this,arguments)}function zd(){return(zd=(0,H.A)(function*(r,e){Kp(r),qd(r)?(r.q_.M_(e),Bd(r)):r.q_.set("Unknown")})).apply(this,arguments)}function d_(r,e,t){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,H.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof fl&&2===e.state&&e.cause)try{yield(n=(0,H.A)(function*(o,c){const d=c.cause;for(const f of c.targetIds)o.N_.has(f)&&(yield o.remoteSyncer.rejectListen(f,d),o.N_.delete(f),o.Q_.removeTarget(f))}),function i(o,c){return n.apply(this,arguments)})(r,e)}catch(n){ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Zl(r,n)}else if(e instanceof Bn?r.Q_.Ke(e):e instanceof Qo?r.Q_.He(e):r.Q_.We(e),!t.isEqual(me.min()))try{const n=yield $l(r.localStore);t.compareTo(n)>=0&&(yield function(o,c){const d=o.Q_.rt(c);return d.targetChanges.forEach((f,g)=>{if(f.resumeToken.approximateByteSize()>0){const I=o.N_.get(g);I&&o.N_.set(g,I.withResumeToken(f.resumeToken,c))}}),d.targetMismatches.forEach((f,g)=>{const I=o.N_.get(f);if(!I)return;o.N_.set(f,I.withResumeToken(at.EMPTY_BYTE_STRING,I.snapshotVersion)),qp(o,f);const A=new qn(I.target,f,g,I.sequenceNumber);Xu(o,A)}),o.remoteSyncer.applyRemoteEvent(d)}(r,t))}catch(n){ee("RemoteStore","Failed to raise snapshot:",n),yield Zl(r,n)}var n}),Gd.apply(this,arguments)}function Zl(r,e,t){return Wd.apply(this,arguments)}function Wd(){return(Wd=(0,H.A)(function*(r,e,t){if(!Ir(e))throw e;r.L_.add(1),yield Dr(r),r.q_.set("Offline"),t||(t=()=>$l(r.localStore)),r.asyncQueue.enqueueRetryable((0,H.A)(function*(){ee("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Qi(r)}))})).apply(this,arguments)}function jp(r,e){return e().catch(t=>Zl(r,t,e))}function wa(r){return $d.apply(this,arguments)}function $d(){return($d=(0,H.A)(function*(r){const e=J(r),t=Yi(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;f_(e);)try{const i=yield xr(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,p_(e,i)}catch(i){yield Zl(e,i)}zp(e)&&Gp(e)})).apply(this,arguments)}function f_(r){return Ji(r)&&r.O_.length<10}function p_(r,e){r.O_.push(e);const t=Yi(r);t.r_()&&t.V_&&t.m_(e.mutations)}function zp(r){return Ji(r)&&!Yi(r).n_()&&r.O_.length>0}function Gp(r){Yi(r).start()}function m_(r){return Hd.apply(this,arguments)}function Hd(){return(Hd=(0,H.A)(function*(r){Yi(r).p_()})).apply(this,arguments)}function g_(r){return Qd.apply(this,arguments)}function Qd(){return(Qd=(0,H.A)(function*(r){const e=Yi(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function __(r,e,t){return Jd.apply(this,arguments)}function Jd(){return(Jd=(0,H.A)(function*(r,e,t){const n=r.O_.shift(),i=fu.from(n,e,t);yield jp(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield wa(r)})).apply(this,arguments)}function y_(r,e){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,H.A)(function*(r,e){var t;e&&Yi(r).V_&&(yield(t=(0,H.A)(function*(i,o){if(dl(d=o.code)&&d!==N.ABORTED){const c=i.O_.shift();Yi(i).s_(),yield jp(i,()=>i.remoteSyncer.rejectFailedWrite(c.batchId,o)),yield wa(i)}var d}),function n(i,o){return t.apply(this,arguments)})(r,e)),zp(r)&&Gp(r)}),Yd.apply(this,arguments)}function Wp(r,e){return Xd.apply(this,arguments)}function Xd(){return(Xd=(0,H.A)(function*(r,e){const t=J(r);t.asyncQueue.verifyOperationInProgress(),ee("RemoteStore","RemoteStore received new credentials");const n=Ji(t);t.L_.add(3),yield Dr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Qi(t)})).apply(this,arguments)}function Zd(r,e){return ef.apply(this,arguments)}function ef(){return(ef=(0,H.A)(function*(r,e){const t=J(r);e?(t.L_.delete(2),yield Qi(t)):e||(t.L_.add(2),yield Dr(t),t.q_.set("Unknown"))})).apply(this,arguments)}function Ra(r){return r.K_||(r.K_=function(t,n,i){const o=J(t);return o.w_(),new Jl(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Eo:c_.bind(null,r),Ro:l_.bind(null,r),mo:h_.bind(null,r),d_:d_.bind(null,r)}),r.B_.push(function(){var e=(0,H.A)(function*(t){t?(r.K_.s_(),qd(r)?Bd(r):r.q_.set("Unknown")):(yield r.K_.stop(),Kp(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Yi(r){return r.U_||(r.U_=function(t,n,i){const o=J(t);return o.w_(),new Ju(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:m_.bind(null,r),mo:y_.bind(null,r),f_:g_.bind(null,r),g_:__.bind(null,r)}),r.B_.push(function(){var e=(0,H.A)(function*(t){t?(r.U_.s_(),yield wa(r)):(yield r.U_.stop(),r.O_.length>0&&(ee("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class tf{constructor(e,t,n,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=o,this.deferred=new Pe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,o){const c=Date.now()+n,d=new tf(e,t,c,i,o);return d.start(n),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sa(r,e){if(He("AsyncQueue",`${e}: ${r}`),Ir(r))return new $(N.UNAVAILABLE,`${e}: ${r}`);throw r}class Pa{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ae.comparator(t.key,n.key):(t,n)=>ae.comparator(t.key,n.key),this.keyedMap=Rr(),this.sortedSet=new We(this.comparator)}static emptySet(e){return new Pa(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Pa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=n.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Pa;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class $p{constructor(){this.W_=new We(ae.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):D():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ba{constructor(e,t,n,i,o,c,d,f,g){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=o,this.fromCache=c,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=g}static fromInitialDocuments(e,t,n,i,o){const c=[];return t.forEach(d=>{c.push({type:0,doc:d})}),new ba(e,t,Pa.emptySet(t),c,n,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class I_{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class v_{constructor(){this.queries=Hp(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=J(t),o=i.queries;i.queries=Hp(),o.forEach((c,d)=>{for(const f of d.j_)f.onError(n)})}(this,new $(N.ABORTED,"Firestore shutting down"))}}function Hp(){return new Un(r=>el(r),Lo)}function nf(r,e){return rf.apply(this,arguments)}function rf(){return(rf=(0,H.A)(function*(r,e){const t=J(r);let n=3;const i=e.query;let o=t.queries.get(i);o?!o.H_()&&e.J_()&&(n=2):(o=new I_,n=e.J_()?0:1);try{switch(n){case 0:o.z_=yield t.onListen(i,!0);break;case 1:o.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(c){const d=Sa(c,`Initialization of query '${Bi(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,o),o.j_.push(e),e.Z_(t.onlineState),o.z_&&e.X_(o.z_)&&af(t)})).apply(this,arguments)}function sf(r,e){return of.apply(this,arguments)}function of(){return(of=(0,H.A)(function*(r,e){const t=J(r),n=e.query;let i=3;const o=t.queries.get(n);if(o){const c=o.j_.indexOf(e);c>=0&&(o.j_.splice(c,1),0===o.j_.length?i=e.J_()?0:1:!o.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function E_(r,e){const t=J(r);let n=!1;for(const i of e){const c=t.queries.get(i.query);if(c){for(const d of c.j_)d.X_(i)&&(n=!0);c.z_=i}}n&&af(t)}function A_(r,e,t){const n=J(r),i=n.queries.get(e);if(i)for(const o of i.j_)o.onError(t);n.queries.delete(e)}function af(r){r.Y_.forEach(e=>{e.next()})}var uf,Qp;(Qp=uf||(uf={})).ea="default",Qp.Cache="cache";class cf{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new ba(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==uf.Cache}}class T_{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class Jp{constructor(e){this.serializer=e}Es(e){return An(this.serializer,e)}ds(e){return e.metadata.exists?_l(this.serializer,e.document,!1):it.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return gt(e)}}class w_{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Yp(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=De.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new Jp(this.serializer);for(const i of e)if(i.metadata.queries){const o=n.Es(i.metadata.name);for(const c of i.metadata.queries){const d=(t.get(c)||ge()).add(o);t.set(c,d)}}return t}complete(){var e=this;return(0,H.A)(function*(){const t=yield function ju(r,e,t,n){return zu.apply(this,arguments)}(e.localStore,new Jp(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield sr(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function Yp(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Xp{constructor(e){this.key=e}}class Zp{constructor(e){this.key=e}}class em{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ge(),this.mutatedKeys=ge(),this.Aa=tl(e),this.Ra=new Pa(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new $p,i=t?t.Ra:this.Ra;let o=t?t.mutatedKeys:this.mutatedKeys,c=i,d=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,g="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((I,A)=>{const S=i.get(I),U=Hr(this.query,A)?A:null,X=!!S&&this.mutatedKeys.has(S.key),re=!!U&&(U.hasLocalMutations||this.mutatedKeys.has(U.key)&&U.hasCommittedMutations);let Z=!1;S&&U?S.data.isEqual(U.data)?X!==re&&(n.track({type:3,doc:U}),Z=!0):this.ga(S,U)||(n.track({type:2,doc:U}),Z=!0,(f&&this.Aa(U,f)>0||g&&this.Aa(U,g)<0)&&(d=!0)):!S&&U?(n.track({type:0,doc:U}),Z=!0):S&&!U&&(n.track({type:1,doc:S}),Z=!0,(f||g)&&(d=!0)),Z&&(U?(c=c.add(U),o=re?o.add(I):o.delete(I)):(c=c.delete(I),o=o.delete(I)))}),null!==this.query.limit)for(;c.size>this.query.limit;){const I="F"===this.query.limitType?c.last():c.first();c=c.delete(I.key),o=o.delete(I.key),n.track({type:1,doc:I})}return{Ra:c,fa:n,ns:d,mutatedKeys:o}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const o=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const c=e.fa.G_();c.sort((I,A)=>function(U,X){const re=Z=>{switch(Z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return re(U)-re(X)}(I.type,A.type)||this.Aa(I.doc,A.doc)),this.pa(n),i=null!=i&&i;const d=t&&!i?this.ya():[],f=0===this.da.size&&this.current&&!i?1:0,g=f!==this.Ea;return this.Ea=f,0!==c.length||g?{snapshot:new ba(this.query,e.Ra,o,c,e.mutatedKeys,0===f,g,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:d}:{wa:d}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new $p,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ge(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Zp(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Xp(n))}),t}ba(e){this.Ta=e.Ts,this.da=ge();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ba.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class R_{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class S_{constructor(e){this.key=e,this.va=!1}}class P_{constructor(e,t,n,i,o,c){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=c,this.Ca={},this.Fa=new Un(d=>el(d),Lo),this.Ma=new Map,this.xa=new Set,this.Oa=new We(ae.comparator),this.Na=new Map,this.La=new pa,this.Ba={},this.ka=new Map,this.qa=ir.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function b_(r,e){return lf.apply(this,arguments)}function lf(){return(lf=(0,H.A)(function*(r,e,t=!0){const n=eh(r);let i;const o=n.Fa.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Da()):i=yield tm(n,e,t,!0),i})).apply(this,arguments)}function C_(r,e){return hf.apply(this,arguments)}function hf(){return(hf=(0,H.A)(function*(r,e){const t=eh(r);yield tm(t,e,!0,!1)})).apply(this,arguments)}function tm(r,e,t,n){return df.apply(this,arguments)}function df(){return(df=(0,H.A)(function*(r,e,t,n){const i=yield hi(r.localStore,pt(e)),o=i.targetId,c=t?r.sharedClientState.addLocalQueryTarget(o):"not-current";let d;return n&&(d=yield ff(r,e,o,"current"===c,i.resumeToken)),r.isPrimaryClient&&t&&Ta(r.remoteStore,i),d})).apply(this,arguments)}function ff(r,e,t,n,i){return pf.apply(this,arguments)}function pf(){return pf=(0,H.A)(function*(r,e,t,n,i){r.Ka=(A,S,U)=>{return(X=(0,H.A)(function*(Z,de,_e,se){let ye=de.view.ma(_e);ye.ns&&(ye=yield ya(Z.localStore,de.query,!1).then(({documents:T})=>de.view.ma(T,ye)));const Se=se&&se.targetChanges.get(de.targetId),Ce=se&&null!=se.targetMismatches.get(de.targetId),V=de.view.applyChanges(ye,Z.isPrimaryClient,Se,Ce);return Rf(Z,de.targetId,V.wa),V.snapshot}),function re(Z,de,_e,se){return X.apply(this,arguments)})(r,A,S,U);var X};const o=yield ya(r.localStore,e,!0),c=new em(e,o.Ts),d=c.ma(o.documents),f=nr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),g=c.applyChanges(d,r.isPrimaryClient,f);Rf(r,t,g.wa);const I=new R_(e,t,c);return r.Fa.set(e,I),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),g.snapshot}),pf.apply(this,arguments)}function x_(r,e,t){return mf.apply(this,arguments)}function mf(){return(mf=(0,H.A)(function*(r,e,t){const n=J(r),i=n.Fa.get(e),o=n.Ma.get(i.targetId);if(o.length>1)return n.Ma.set(i.targetId,o.filter(c=>!Lo(c,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield $i(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Vr(n.remoteStore,i.targetId),Ca(n,i.targetId)}).catch(yr))):(Ca(n,i.targetId),yield $i(n.localStore,i.targetId,!0))})).apply(this,arguments)}function D_(r,e){return gf.apply(this,arguments)}function gf(){return(gf=(0,H.A)(function*(r,e){const t=J(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Vr(t.remoteStore,n.targetId))})).apply(this,arguments)}function _f(){return(_f=(0,H.A)(function*(r,e,t){const n=Lf(r);try{const i=yield function(c,d){const f=J(c),g=nt.now(),I=d.reduce((U,X)=>U.add(X.key),ge());let A,S;return f.persistence.runTransaction("Locally write mutations","readwrite",U=>{let X=Ht(),re=ge();return f.cs.getEntries(U,I).next(Z=>{X=Z,X.forEach((de,_e)=>{_e.isValidDocument()||(re=re.add(de))})}).next(()=>f.localDocuments.getOverlayedDocuments(U,X)).next(Z=>{A=Z;const de=[];for(const _e of d){const se=pd(_e,A.get(_e.key).overlayedDocument);null!=se&&de.push(new tr(_e.key,se,jc(se.value.mapValue),ut.exists(!0)))}return f.mutationQueue.addMutationBatch(U,g,de,d)}).next(Z=>{S=Z;const de=Z.applyToLocalDocumentSet(A,re);return f.documentOverlayCache.saveOverlays(U,Z.batchId,de)})}).then(()=>({batchId:S.batchId,changes:ud(A)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(c,d,f){let g=c.Ba[c.currentUser.toKey()];g||(g=new We(Ae)),g=g.insert(d,f),c.Ba[c.currentUser.toKey()]=g}(n,i.batchId,t),yield fi(n,i.changes),yield wa(n.remoteStore)}catch(i){const o=Sa(i,"Failed to persist write");t.reject(o)}})).apply(this,arguments)}function nm(r,e){return yf.apply(this,arguments)}function yf(){return(yf=(0,H.A)(function*(r,e){const t=J(r);try{const n=yield function Hl(r,e){const t=J(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const c=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const d=[];e.targetChanges.forEach((I,A)=>{const S=i.get(A);if(!S)return;d.push(t.Ur.removeMatchingKeys(o,I.removedDocuments,A).next(()=>t.Ur.addMatchingKeys(o,I.addedDocuments,A)));let U=S.withSequenceNumber(o.currentSequenceNumber);var re,Z,de;null!==e.targetMismatches.get(A)?U=U.withResumeToken(at.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):I.resumeToken.approximateByteSize()>0&&(U=U.withResumeToken(I.resumeToken,n)),i=i.insert(A,U),Z=U,de=I,(0===(re=S).resumeToken.approximateByteSize()||Z.snapshotVersion.toMicroseconds()-re.snapshotVersion.toMicroseconds()>=3e8||de.addedDocuments.size+de.modifiedDocuments.size+de.removedDocuments.size>0)&&d.push(t.Ur.updateTargetData(o,U))});let f=Ht(),g=ge();if(e.documentUpdates.forEach(I=>{e.resolvedLimboDocuments.has(I)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(o,I))}),d.push(Ql(o,c,e.documentUpdates).next(I=>{f=I.Ps,g=I.Is})),!n.isEqual(me.min())){const I=t.Ur.getLastRemoteSnapshotVersion(o).next(A=>t.Ur.setTargetsMetadata(o,o.currentSequenceNumber,n));d.push(I)}return F.waitFor(d).next(()=>c.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,f,g)).next(()=>f)}).then(o=>(t.os=i,o))}(t.localStore,e);e.targetChanges.forEach((i,o)=>{const c=t.Na.get(o);c&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?c.va=!0:i.modifiedDocuments.size>0?G(c.va):i.removedDocuments.size>0&&(G(c.va),c.va=!1))}),yield fi(t,n,e)}catch(n){yield yr(n)}})).apply(this,arguments)}function rm(r,e,t){const n=J(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((o,c)=>{const d=c.view.Z_(e);d.snapshot&&i.push(d.snapshot)}),function(c,d){const f=J(c);f.onlineState=d;let g=!1;f.queries.forEach((I,A)=>{for(const S of A.j_)S.Z_(d)&&(g=!0)}),g&&af(f)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function N_(r,e,t){return If.apply(this,arguments)}function If(){return(If=(0,H.A)(function*(r,e,t){const n=J(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),o=i&&i.key;if(o){let c=new We(ae.comparator);c=c.insert(o,it.newNoDocument(o,me.min()));const d=ge().add(o),f=new Zr(me.min(),new Map,new We(Ae),c,d);yield nm(n,f),n.Oa=n.Oa.remove(o),n.Na.delete(e),Sf(n)}else yield $i(n.localStore,e,!1).then(()=>Ca(n,e,t)).catch(yr)})).apply(this,arguments)}function k_(r,e){return vf.apply(this,arguments)}function vf(){return(vf=(0,H.A)(function*(r,e){const t=J(r),n=e.batch.batchId;try{const i=yield function Bu(r,e){const t=J(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),o=t.cs.newChangeBuffer({trackRemovals:!0});return function(d,f,g,I){const A=g.batch,S=A.keys();let U=F.resolve();return S.forEach(X=>{U=U.next(()=>I.getEntry(f,X)).next(re=>{const Z=g.docVersions.get(X);G(null!==Z),re.version.compareTo(Z)<0&&(A.applyToRemoteDocument(re,g),re.isValidDocument()&&(re.setReadTime(g.commitVersion),I.addEntry(re)))})}),U.next(()=>d.mutationQueue.removeMutationBatch(f,A))}(t,n,e,o).next(()=>o.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(d){let f=ge();for(let g=0;g<d.mutationResults.length;++g)d.mutationResults[g].transformResults.length>0&&(f=f.add(d.batch.mutations[g].key));return f}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);wf(t,n,null),Tf(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield fi(t,i)}catch(i){yield yr(i)}})).apply(this,arguments)}function O_(r,e,t){return Ef.apply(this,arguments)}function Ef(){return(Ef=(0,H.A)(function*(r,e,t){const n=J(r);try{const i=yield function(c,d){const f=J(c);return f.persistence.runTransaction("Reject batch","readwrite-primary",g=>{let I;return f.mutationQueue.lookupMutationBatch(g,d).next(A=>(G(null!==A),I=A.keys(),f.mutationQueue.removeMutationBatch(g,A))).next(()=>f.mutationQueue.performConsistencyCheck(g)).next(()=>f.documentOverlayCache.removeOverlaysForBatchId(g,I,d)).next(()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,I)).next(()=>f.localDocuments.getDocuments(g,I))})}(n.localStore,e);wf(n,e,t),Tf(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield fi(n,i)}catch(i){yield yr(i)}})).apply(this,arguments)}function Af(){return(Af=(0,H.A)(function*(r,e){const t=J(r);Ji(t.remoteStore)||ee("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(c){const d=J(c);return d.persistence.runTransaction("Get highest unacknowledged batch id","readonly",f=>d.mutationQueue.getHighestUnacknowledgedBatchId(f))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=Sa(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function Tf(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function wf(r,e,t){const n=J(r);let i=n.Ba[n.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function Ca(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||im(r,n)})}function im(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Vr(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Sf(r))}function Rf(r,e,t){for(const n of t)n instanceof Xp?(r.La.addReference(n.key,e),M_(r,n)):n instanceof Zp?(ee("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||im(r,n.key)):D()}function M_(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(ee("SyncEngine","New document in limbo: "+t),r.xa.add(n),Sf(r))}function Sf(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new ae(De.fromString(e)),n=r.qa.next();r.Na.set(n,new S_(t)),r.Oa=r.Oa.insert(t,n),Ta(r.remoteStore,new qn(pt(As(t.path)),n,"TargetPurposeLimboResolution",Bt.oe))}}function fi(r,e,t){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,H.A)(function*(r,e,t){const n=J(r),i=[],o=[],c=[];var d;n.Fa.isEmpty()||(n.Fa.forEach((d,f)=>{c.push(n.Ka(f,e,t).then(g=>{var I;if((g||t)&&n.isPrimaryClient){const A=g?!g.fromCache:null===(I=t?.targetChanges.get(f.targetId))||void 0===I?void 0:I.current;n.sharedClientState.updateQueryState(f.targetId,A?"current":"not-current")}if(g){i.push(g);const A=Ws.Wi(f.targetId,g);o.push(A)}}))}),yield Promise.all(c),n.Ca.d_(i),yield(d=(0,H.A)(function*(g,I){const A=J(g);try{yield A.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>F.forEach(I,U=>F.forEach(U.$i,X=>A.persistence.referenceDelegate.addReference(S,U.targetId,X)).next(()=>F.forEach(U.Ui,X=>A.persistence.referenceDelegate.removeReference(S,U.targetId,X)))))}catch(S){if(!Ir(S))throw S;ee("LocalStore","Failed to update sequence numbers: "+S)}for(const S of I){const U=S.targetId;if(!S.fromCache){const X=A.os.get(U),Z=X.withLastLimboFreeSnapshotVersion(X.snapshotVersion);A.os=A.os.insert(U,Z)}}}),function f(g,I){return d.apply(this,arguments)})(n.localStore,o))}),Pf.apply(this,arguments)}function F_(r,e){return bf.apply(this,arguments)}function bf(){return(bf=(0,H.A)(function*(r,e){const t=J(r);if(!t.currentUser.isEqual(e)){ee("SyncEngine","User change. New user:",e.toKey());const n=yield Wl(t.localStore,e);t.currentUser=e,(o=t).ka.forEach(d=>{d.forEach(f=>{f.reject(new $(N.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield fi(t,n.hs)}var o})).apply(this,arguments)}function U_(r,e){const t=J(r),n=t.Na.get(e);if(n&&n.va)return ge().add(n.key);{let i=ge();const o=t.Ma.get(e);if(!o)return i;for(const c of o){const d=t.Fa.get(c);i=i.unionWith(d.view.Va)}return i}}function B_(r,e){return Cf.apply(this,arguments)}function Cf(){return(Cf=(0,H.A)(function*(r,e){const t=J(r),n=yield ya(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Rf(t,e.targetId,i.wa),i})).apply(this,arguments)}function q_(r,e){return xf.apply(this,arguments)}function xf(){return(xf=(0,H.A)(function*(r,e){const t=J(r);return qt(t.localStore,e).then(n=>fi(t,n))})).apply(this,arguments)}function K_(r,e,t,n){return Df.apply(this,arguments)}function Df(){return(Df=(0,H.A)(function*(r,e,t,n){const i=J(r),o=yield function(d,f){const g=J(d),I=J(g.mutationQueue);return g.persistence.runTransaction("Lookup mutation documents","readonly",A=>I.Mn(A,f).next(S=>S?g.localDocuments.getDocuments(A,S):F.resolve(null)))}(i.localStore,e);var f;null!==o?("pending"===t?yield wa(i.remoteStore):"acknowledged"===t||"rejected"===t?(wf(i,e,n||null),Tf(i,e),f=e,J(J(i.localStore).mutationQueue).On(f)):D(),yield fi(i,o)):ee("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Vf(){return(Vf=(0,H.A)(function*(r,e){const t=J(r);if(eh(t),Lf(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield sm(t,n.toArray());t.Qa=!0,yield Zd(t.remoteStore,!0);for(const o of i)Ta(t.remoteStore,o)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((o,c)=>{t.sharedClientState.isLocalQueryTarget(c)?n.push(c):i=i.then(()=>(Ca(t,c),$i(t.localStore,c,!0))),Vr(t.remoteStore,c)}),yield i,yield sm(t,n),function(c){const d=J(c);d.Na.forEach((f,g)=>{Vr(d.remoteStore,g)}),d.La.pr(),d.Na=new Map,d.Oa=new We(ae.comparator)}(t),t.Qa=!1,yield Zd(t.remoteStore,!1)}})).apply(this,arguments)}function sm(r,e,t){return Nf.apply(this,arguments)}function Nf(){return(Nf=(0,H.A)(function*(r,e,t){const n=J(r),i=[],o=[];for(const c of e){let d;const f=n.Ma.get(c);if(f&&0!==f.length){d=yield hi(n.localStore,pt(f[0]));for(const g of f){const I=n.Fa.get(g),A=yield B_(n,I);A.snapshot&&o.push(A.snapshot)}}else{const g=yield Ku(n.localStore,c);d=yield hi(n.localStore,g),yield ff(n,om(g),c,!1,d.resumeToken)}i.push(d)}return n.Ca.d_(o),i})).apply(this,arguments)}function om(r){return id(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function z_(r){return t=J(r).localStore,J(J(t).persistence).Qi();var t}function G_(r,e,t,n){return kf.apply(this,arguments)}function kf(){return(kf=(0,H.A)(function*(r,e,t,n){const i=J(r);if(i.Qa)return void ee("SyncEngine","Ignoring unexpected query state notification.");const o=i.Ma.get(e);if(o&&o.length>0)switch(t){case"current":case"not-current":{const c=yield qt(i.localStore,Mo(o[0])),d=Zr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,at.EMPTY_BYTE_STRING);yield fi(i,c,d);break}case"rejected":yield $i(i.localStore,e,!0),Ca(i,e,n);break;default:D()}})).apply(this,arguments)}function W_(r,e,t){return Of.apply(this,arguments)}function Of(){return(Of=(0,H.A)(function*(r,e,t){const n=eh(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){ee("SyncEngine","Adding an already active target "+i);continue}const o=yield Ku(n.localStore,i),c=yield hi(n.localStore,o);yield ff(n,om(o),c.targetId,!1,c.resumeToken),Ta(n.remoteStore,c)}for(const i of t)n.Ma.has(i)&&(yield $i(n.localStore,i,!1).then(()=>{Vr(n.remoteStore,i),Ca(n,i)}).catch(yr))}})).apply(this,arguments)}function eh(r){const e=J(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=nm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=U_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=N_.bind(null,e),e.Ca.d_=E_.bind(null,e.eventManager),e.Ca.$a=A_.bind(null,e.eventManager),e}function Lf(r){const e=J(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=k_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=O_.bind(null,e),e}class xa{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,H.A)(function*(){t.serializer=Ye(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Uu(this.persistence,new Jt,e.initialUser,this.serializer)}createPersistence(e){return new Mu(ma.Zr,this.serializer)}createSharedClientState(e){return new s}terminate(){var e=this;return(0,H.A)(function*(){var t,n;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(n=e.indexBackfillerScheduler)||void 0===n||n.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Mf extends xa{constructor(e,t,n){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,H.A)(function*(){yield t().call(n,e),yield n.Wa.initialize(n,e),yield Lf(n.Wa.syncEngine),yield wa(n.Wa.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Uu(this.persistence,new Jt,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Ul(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new zh(t,this.persistence);return new Wa(e.asyncQueue,n)}createPersistence(e){const t=Fu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new zs(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,he(),le(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new s}}class am extends Mf{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,H.A)(function*(){yield t().call(n,e);const i=n.Wa.syncEngine;n.sharedClientState instanceof l&&(n.sharedClientState.syncEngine={no:K_.bind(null,i),ro:G_.bind(null,i),io:W_.bind(null,i),Qi:z_.bind(null,i),eo:q_.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var o=(0,H.A)(function*(c){yield function j_(r,e){return Vf.apply(this,arguments)}(n.Wa.syncEngine,c),n.gcScheduler&&(c&&!n.gcScheduler.started?n.gcScheduler.start():c||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(c&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():c||n.indexBackfillerScheduler.stop())});return function(c){return o.apply(this,arguments)}}())})()}createSharedClientState(e){const t=he();if(!l.D(t))throw new $(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Fu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new l(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Da{initialize(e,t){var n=this;return(0,H.A)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>rm(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=F_.bind(null,n.syncEngine),yield Zd(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new v_}createDatastore(e){const t=Ye(e.databaseInfo.databaseId),n=new oe(e.databaseInfo);return new Yl(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,o=e.asyncQueue,c=t=>rm(this.syncEngine,t,0),d=h.D()?new h:new a,new Yu(n,i,o,c,d);var n,i,o,c,d}createSyncEngine(e,t){return function(i,o,c,d,f,g,I){const A=new P_(i,o,c,d,f,g);return I&&(A.Qa=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,H.A)(function*(){var t,n,i;yield(i=(0,H.A)(function*(c){const d=J(c);ee("RemoteStore","RemoteStore shutting down."),d.L_.add(5),yield Dr(d),d.k_.shutdown(),d.q_.set("Unknown")}),function o(c){return i.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate(),null===(n=e.eventManager)||void 0===n||n.terminate()})()}}function um(r,e=10240){let t=0;return{read:()=>(0,H.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,H.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class th{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Q_{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Pe,this.buffer=new Uint8Array,this.Ha=new TextDecoder("utf-8"),this.Ja().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.ja.cancel()}getMetadata(){var e=this;return(0,H.A)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,H.A)(function*(){return yield e.getMetadata(),e.Ja()})()}Ja(){var e=this;return(0,H.A)(function*(){const t=yield e.Ya();if(null===t)return null;const n=e.Ha.decode(t),i=Number(n);isNaN(i)&&e.Za(`length string (${n}) is not valid number`);const o=yield e.Xa(i);return new T_(JSON.parse(o),t.length+i)})()}eu(){return this.buffer.findIndex(e=>123===e)}Ya(){var e=this;return(0,H.A)(function*(){for(;e.eu()<0&&!(yield e.tu()););if(0===e.buffer.length)return null;const t=e.eu();t<0&&e.Za("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}Xa(e){var t=this;return(0,H.A)(function*(){for(;t.buffer.length<e;)(yield t.tu())&&t.Za("Reached the end of bundle when more is expected.");const n=t.Ha.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){var e=this;return(0,H.A)(function*(){const t=yield e.ja.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class J_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,H.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new $(N.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,H.A)(function*(c,d){const f=J(c),g={documents:d.map(U=>ti(f.serializer,U))},I=yield f.Lo("BatchGetDocuments",f.serializer.databaseId,De.emptyPath(),g,d.length),A=new Map;I.forEach(U=>{const X=function Ed(r,e){return"found"in e?function(n,i){G(!!i.found);const o=An(n,i.found.name),c=gt(i.found.updateTime),d=i.found.createTime?gt(i.found.createTime):me.min(),f=new Rt({mapValue:{fields:i.found.fields}});return it.newFoundDocument(o,c,d,f)}(r,e):"missing"in e?function(n,i){G(!!i.missing),G(!!i.readTime);const o=An(n,i.missing),c=gt(i.readTime);return it.newNoDocument(o,c)}(r,e):D()}(f.serializer,U);A.set(X.key.toString(),X)});const S=[];return d.forEach(U=>{const X=A.get(U.toString());G(!!X),S.push(X)}),S}),function o(c,d){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new qi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,H.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const o=ae.fromPath(i);e.mutations.push(new hu(o,e.precondition(o)))}),yield(n=(0,H.A)(function*(o,c){const d=J(o),f={writes:c.map(g=>ks(d.serializer,g))};yield d.Mo("Commit",d.serializer.databaseId,De.emptyPath(),f)}),function i(o,c){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw D();t=me.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new $(N.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(me.min())?ut.exists(!1):ut.updateTime(t):ut.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(me.min()))throw new $(N.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(t)}return ut.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Y_{constructor(e,t,n,i,o){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=o,this.nu=n.maxAttempts,this.t_=new cn(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){var e=this;this.t_.Go((0,H.A)(function*(){const t=new J_(e.datastore),n=e.su(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(o=>{e.ou(o)}))}).catch(i=>{e.ou(i)})}))}su(e){try{const t=this.updateFunction(e);return!fs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!dl(t)}return!1}}class X_{constructor(e,t,n,i){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ct.UNAUTHENTICATED,this.clientId=qa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var c=(0,H.A)(function*(d){ee("FirestoreClient","Received user=",d.uid),yield o.authCredentialListener(d),o.user=d});return function(d){return c.apply(this,arguments)}}()),this.appCheckCredentials.start(n,c=>(ee("FirestoreClient","Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new $(N.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Pe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,H.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=Sa(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function nh(r,e){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,H.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),ee("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,H.A)(function*(o){n.isEqual(o)||(yield Wl(e.localStore,o),n=o)});return function(o){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Ff.apply(this,arguments)}function Uf(r,e){return Bf.apply(this,arguments)}function Bf(){return(Bf=(0,H.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield qf(r);ee("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Wp(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Wp(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function cm(r){return"FirebaseError"===r.name?r.code===N.FAILED_PRECONDITION||r.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}function qf(r){return Kf.apply(this,arguments)}function Kf(){return(Kf=(0,H.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){ee("FirestoreClient","Using user provided OfflineComponentProvider");try{yield nh(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!cm(t))throw t;K("Error using user provided cache. Falling back to memory cache: "+t),yield nh(r,new xa)}}else ee("FirestoreClient","Using default OfflineComponentProvider"),yield nh(r,new xa);return r._offlineComponents})).apply(this,arguments)}function rh(r){return jf.apply(this,arguments)}function jf(){return(jf=(0,H.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(ee("FirestoreClient","Using user provided OnlineComponentProvider"),yield Uf(r,r._uninitializedComponentsProvider._online)):(ee("FirestoreClient","Using default OnlineComponentProvider"),yield Uf(r,new Da))),r._onlineComponents})).apply(this,arguments)}function lm(r){return qf(r).then(e=>e.persistence)}function Va(r){return qf(r).then(e=>e.localStore)}function hm(r){return rh(r).then(e=>e.remoteStore)}function zf(r){return rh(r).then(e=>e.syncEngine)}function Na(r){return Gf.apply(this,arguments)}function Gf(){return(Gf=(0,H.A)(function*(r){const e=yield rh(r),t=e.eventManager;return t.onListen=b_.bind(null,e.syncEngine),t.onUnlisten=x_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=C_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=D_.bind(null,e.syncEngine),t})).apply(this,arguments)}function fm(r,e,t={}){const n=new Pe;return r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return function(o,c,d,f,g){const I=new th({next:S=>{c.enqueueAndForget(()=>sf(o,A));const U=S.docs.has(d);!U&&S.fromCache?g.reject(new $(N.UNAVAILABLE,"Failed to get document because the client is offline.")):U&&S.fromCache&&f&&"server"===f.source?g.reject(new $(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(S)},error:S=>g.reject(S)}),A=new cf(As(d.path),I,{includeMetadataChanges:!0,_a:!0});return nf(o,A)}(yield Na(r),r.asyncQueue,e,t,n)})),n.promise}function pm(r,e,t={}){const n=new Pe;return r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return function(o,c,d,f,g){const I=new th({next:S=>{c.enqueueAndForget(()=>sf(o,A)),S.fromCache&&"server"===f.source?g.reject(new $(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):g.resolve(S)},error:S=>g.reject(S)}),A=new cf(d,I,{includeMetadataChanges:!0,_a:!0});return nf(o,A)}(yield Na(r),r.asyncQueue,e,t,n)})),n.promise}function mm(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const gm=new Map;function Wf(r,e,t){if(!t)throw new $(N.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function _m(r,e,t,n){if(!0===e&&!0===n)throw new $(N.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function ym(r){if(!ae.isDocumentKey(r))throw new $(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Im(r){if(ae.isDocumentKey(r))throw new $(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function ih(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":D()}function Ne(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new $(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ih(r);throw new $(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function vm(r,e){if(e<=0)throw new $(N.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Em{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new $(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_m("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=mm(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(o){if(void 0!==o.timeoutSeconds){if(isNaN(o.timeoutSeconds))throw new $(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new $(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new $(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Zu{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Em({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new $(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Em(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new Fr;switch(n.type){case"firstParty":return new Mh(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new $(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=gm.get(t);n&&(ee("ComponentProvider","Removing Datastore"),gm.delete(t),n.terminate())}(this),Promise.resolve()}}class Kt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Kt(this.firestore,e,this._query)}}class lt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lt(this.firestore,e,this._key)}}class Nr extends Kt{constructor(e,t,n){super(e,t,As(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new lt(this.firestore,null,new ae(e))}withConverter(e){return new Nr(this.firestore,e,this._path)}}function Tm(r,e,...t){if(r=(0,Me.Ku)(r),Wf("collection","path",e),r instanceof Zu){const n=De.fromString(e,...t);return Im(n),new Nr(r,null,n)}{if(!(r instanceof lt||r instanceof Nr))throw new $(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(De.fromString(e,...t));return Im(n),new Nr(r.firestore,null,n)}}function sh(r,e,...t){if(r=(0,Me.Ku)(r),1===arguments.length&&(e=qa.newId()),Wf("doc","path",e),r instanceof Zu){const n=De.fromString(e,...t);return ym(n),new lt(r,null,new ae(n))}{if(!(r instanceof lt||r instanceof Nr))throw new $(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(De.fromString(e,...t));return ym(n),new lt(r.firestore,r instanceof Nr?r.converter:null,new ae(n))}}function wm(r,e){return r=(0,Me.Ku)(r),e=(0,Me.Ku)(e),(r instanceof lt||r instanceof Nr)&&(e instanceof lt||e instanceof Nr)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function $f(r,e){return r=(0,Me.Ku)(r),e=(0,Me.Ku)(e),r instanceof Kt&&e instanceof Kt&&r.firestore===e.firestore&&Lo(r._query,e._query)&&r.converter===e.converter}class hy{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new cn(this,"async_queue_retry"),this.Eu=()=>{const t=le();t&&ee("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};const e=le();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const t=le();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const t=new Pe;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){var e=this;return(0,H.A)(function*(){if(0!==e.uu.length){try{yield e.uu[0](),e.uu.shift(),e.t_.reset()}catch(t){if(!Ir(t))throw t;ee("AsyncQueue","Operation failed with retryable error: "+t)}e.uu.length>0&&e.t_.Go(()=>e.Ru())}})()}Au(e){const t=this.au.then(()=>(this.Pu=!0,e().catch(n=>{throw this.hu=n,this.Pu=!1,He("INTERNAL UNHANDLED ERROR: ",function(c){let d=c.message||"";return c.stack&&(d=c.stack.includes(c.message)?c.stack:c.message+"\n"+c.stack),d}(n)),n}).then(n=>(this.Pu=!1,n))));return this.au=t,t}enqueueAfterDelay(e,t,n){this.du(),this.Tu.indexOf(e)>-1&&(t=0);const i=tf.createAndSchedule(this,e,t,n,o=>this.Vu(o));return this.lu.push(i),i}du(){this.hu&&D()}verifyOperationInProgress(){}mu(){var e=this;return(0,H.A)(function*(){let t;do{t=e.au,yield t}while(t!==e.au)})()}fu(e){for(const t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.lu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const t=this.lu.indexOf(e);this.lu.splice(t,1)}}function Hf(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const o of["next","error","complete"])if(o in i&&"function"==typeof i[o])return!0;return!1}(r)}class dy{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class tt extends Zu{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new hy,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Rm(this),this._firestoreClient.terminate()}}function mt(r){return r._firestoreClient||Rm(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Rm(r){var e,t,n;const i=r._freezeSettings(),o=(f=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new tu(r._databaseId,f,r._persistenceKey,(I=i).host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,mm(I.experimentalLongPollingOptions),I.useFetchStreams));var f,I;r._firestoreClient=new X_(r._authCredentials,r._appCheckCredentials,r._queue,o),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Sm(r,e,t){const n=new Pe;return r.asyncQueue.enqueue((0,H.A)(function*(){try{yield nh(r,t),yield Uf(r,e),n.resolve()}catch(i){const o=i;if(!cm(o))throw o;K("Error enabling indexeddb cache. Falling back to memory cache: "+o),n.reject(o)}})).then(()=>n.promise)}function Pm(r){if(r._initialized||r._terminated)throw new $(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class kr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kr(at.fromBase64String(e))}catch(t){throw new $(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new kr(at.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pi{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ys{constructor(e){this._methodName=e}}class oh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new $(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new $(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ae(this._lat,e._lat)||Ae(this._long,e._long)}}class ah{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}(this._values,e._values)}}const Ty=/^__.*__$/;class wy{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new tr(e,this.data,this.fieldMask,t,this.fieldTransforms):new er(e,this.data,t,this.fieldTransforms)}}class bm{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new tr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}class uh{constructor(e,t,n,i,o,c){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===o&&this.yu(),this.fieldTransforms=o||[],this.fieldMask=c||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new uh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.vu(e),i}Cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return hh(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(0===e.length)throw this.Mu("Document fields must not be empty");if(Cm(this.wu)&&Ty.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class Ry{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ye(e)}Nu(e,t,n,i=!1){return new uh({wu:e,methodName:t,Ou:n,path:Je.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xs(r){const e=r._freezeSettings(),t=Ye(r._databaseId);return new Ry(r._databaseId,!!e.ignoreUndefinedProperties,t)}function ch(r,e,t,n,i,o={}){const c=r.Nu(o.merge||o.mergeFields?2:0,e,t,i);tp("Data must be an object, but it was:",c,n);const d=Vm(n,c);let f,g;if(o.merge)f=new kt(c.fieldMask),g=c.fieldTransforms;else if(o.mergeFields){const I=[];for(const A of o.mergeFields){const S=nc(e,A,t);if(!c.contains(S))throw new $(N.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);km(I,S)||I.push(S)}f=new kt(I),g=c.fieldTransforms.filter(A=>f.covers(A.field))}else f=null,g=c.fieldTransforms;return new wy(new Rt(d),f,g)}class tc extends Ys{_toFieldTransform(e){if(2!==e.wu)throw e.Mu(1===e.wu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof tc}}function xm(r,e,t){return new uh({wu:3,Ou:e.settings.Ou,methodName:r._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Qf extends Ys{_toFieldTransform(e){return new Xr(e.path,new Qr)}isEqual(e){return e instanceof Qf}}class Jf extends Ys{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=xm(this,e,!0),n=this.Lu.map(o=>Zs(o,t)),i=new bn(n);return new Xr(e.path,i)}isEqual(e){return e instanceof Jf&&(0,Me.bD)(this.Lu,e.Lu)}}class Yf extends Ys{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=xm(this,e,!0),n=this.Lu.map(o=>Zs(o,t)),i=new Jr(n);return new Xr(e.path,i)}isEqual(e){return e instanceof Yf&&(0,Me.bD)(this.Lu,e.Lu)}}class Xf extends Ys{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=new Yr(e.serializer,rl(e.serializer,this.Bu));return new Xr(e.path,t)}isEqual(e){return e instanceof Xf&&this.Bu===e.Bu}}function Zf(r,e,t,n){const i=r.Nu(1,e,t);tp("Data must be an object, but it was:",i,n);const o=[],c=Rt.empty();wt(n,(f,g)=>{const I=lh(e,f,t);g=(0,Me.Ku)(g);const A=i.Cu(I);if(g instanceof tc)o.push(I);else{const S=Zs(g,A);null!=S&&(o.push(I),c.set(I,S))}});const d=new kt(o);return new bm(c,d,i.fieldTransforms)}function ep(r,e,t,n,i,o){const c=r.Nu(1,e,t),d=[nc(e,n,t)],f=[i];if(o.length%2!=0)throw new $(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let S=0;S<o.length;S+=2)d.push(nc(e,o[S])),f.push(o[S+1]);const g=[],I=Rt.empty();for(let S=d.length-1;S>=0;--S)if(!km(g,d[S])){const U=d[S];let X=f[S];X=(0,Me.Ku)(X);const re=c.Cu(U);if(X instanceof tc)g.push(U);else{const Z=Zs(X,re);null!=Z&&(g.push(U),I.set(U,Z))}}const A=new kt(g);return new bm(I,A,c.fieldTransforms)}function Dm(r,e,t,n=!1){return Zs(t,r.Nu(n?4:3,e))}function Zs(r,e){if(Nm(r=(0,Me.Ku)(r)))return tp("Unsupported field value:",e,r),Vm(r,e);if(r instanceof Ys)return function(n,i){if(!Cm(i.wu))throw i.Mu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Du&&4!==e.wu)throw e.Mu("Nested arrays are not supported");return function(n,i){const o=[];let c=0;for(const d of n){let f=Zs(d,i.Fu(c));null==f&&(f={nullValue:"NULL_VALUE"}),o.push(f),c++}return{arrayValue:{values:o}}}(r,e)}return function(n,i){if(null===(n=(0,Me.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return rl(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const o=nt.fromDate(n);return{timestampValue:Ki(i.serializer,o)}}if(n instanceof nt){const o=new nt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ki(i.serializer,o)}}if(n instanceof oh)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof kr)return{bytesValue:Yo(i.serializer,n._byteString)};if(n instanceof lt){const o=i.databaseId,c=n.firestore._databaseId;if(!c.isEqual(o))throw i.Mu(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ei(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof ah)return d=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(f=>{if("number"!=typeof f)throw d.Mu("VectorValues must only contain numeric values.");return cu(d.serializer,f)})}}}}};var d;throw i.Mu(`Unsupported field value: ${ih(n)}`)}(r,e)}function Vm(r,e){const t={};return Lc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wt(r,(n,i)=>{const o=Zs(i,e.bu(n));null!=o&&(t[n]=o)}),{mapValue:{fields:t}}}function Nm(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof nt||r instanceof oh||r instanceof kr||r instanceof lt||r instanceof Ys||r instanceof ah)}function tp(r,e,t){if(!Nm(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=ih(t);throw e.Mu("an object"===n?r+" a custom object":r+" "+n)}var i}function nc(r,e,t){if((e=(0,Me.Ku)(e))instanceof pi)return e._internalPath;if("string"==typeof e)return lh(r,e);throw hh("Field path arguments must be of type string or ",r,!1,void 0,t)}const Sy=new RegExp("[~\\*/\\[\\]]");function lh(r,e,t){if(e.search(Sy)>=0)throw hh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new pi(...e.split("."))._internalPath}catch{throw hh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function hh(r,e,t,n,i){const o=n&&!n.isEmpty(),c=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(o||c)&&(f+=" (found",o&&(f+=` in field ${n}`),c&&(f+=` in document ${i}`),f+=")"),new $(N.INVALID_ARGUMENT,d+r+f)}function km(r,e){return r.some(t=>t.isEqual(e))}class rc{constructor(e,t,n,i,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new lt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Py(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(dh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Py extends rc{data(){return super.data()}}function dh(r,e){return"string"==typeof e?lh(r,e):e instanceof pi?e._internalPath:e._delegate._internalPath}function Om(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new $(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class np{}class ic extends np{}function Xi(r,e,...t){let n=[];e instanceof np&&n.push(e),n=n.concat(t),function(o){const c=o.filter(f=>f instanceof ka).length,d=o.filter(f=>f instanceof sc).length;if(c>1||c>0&&d>0)throw new $(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class sc extends ic{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sc(e,t,n)}_apply(e){const t=this._parse(e);return Um(e._query,t),new Kt(e.firestore,e.converter,uu(e._query,t))}_parse(e){const t=Xs(e.firestore);return function(o,c,d,f,g,I,A){let S;if(g.isKeyField()){if("array-contains"===I||"array-contains-any"===I)throw new $(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${I}' queries on documentId().`);if("in"===I||"not-in"===I){Fm(A,I);const U=[];for(const X of A)U.push(Mm(f,o,X));S={arrayValue:{values:U}}}else S=Mm(f,o,A)}else"in"!==I&&"not-in"!==I&&"array-contains-any"!==I||Fm(A,I),S=Dm(d,"where",A,"in"===I||"not-in"===I);return Ve.create(g,I,S)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class ka extends np{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ka(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:Ge.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,o){let c=i;const d=o.getFlattenedFilters();for(const f of d)Um(c,f),c=uu(c,f)}(e._query,t),new Kt(e.firestore,e.converter,uu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class rp extends ic{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new rp(e,t)}_apply(e){const t=function(i,o,c){if(null!==i.startAt)throw new $(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new $(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Is(o,c)}(e._query,this._field,this._direction);return new Kt(e.firestore,e.converter,function(i,o){const c=i.explicitOrderBy.concat([o]);return new Tr(i.path,i.collectionGroup,c,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class fh extends ic{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new fh(e,t,n)}_apply(e){return new Kt(e.firestore,e.converter,Oo(e._query,this._limit,this._limitType))}}class ph extends ic{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ph(e,t,n)}_apply(e){const t=Lm(e,this.type,this._docOrFields,this._inclusive);return new Kt(e.firestore,e.converter,(o=t,new Tr((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)));var i,o}}class mh extends ic{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new mh(e,t,n)}_apply(e){const t=Lm(e,this.type,this._docOrFields,this._inclusive);return new Kt(e.firestore,e.converter,(o=t,new Tr((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)));var i,o}}function Lm(r,e,t,n){if(t[0]=(0,Me.Ku)(t[0]),t[0]instanceof rc)return function(o,c,d,f,g){if(!f)throw new $(N.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${d}().`);const I=[];for(const A of wr(o))if(A.field.isKeyField())I.push(Wr(c,f.key));else{const S=f.data.field(A.field);if(zr(S))throw new $(N.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===S){const U=A.field.canonicalString();throw new $(N.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${U}' (used as the orderBy) does not exist.`)}I.push(S)}return new Fn(I,g)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=Xs(r.firestore);return function(c,d,f,g,I,A){const S=c.explicitOrderBy;if(I.length>S.length)throw new $(N.INVALID_ARGUMENT,`Too many arguments provided to ${g}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const U=[];for(let X=0;X<I.length;X++){const re=I[X];if(S[X].field.isKeyField()){if("string"!=typeof re)throw new $(N.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${g}(), but got a ${typeof re}`);if(!Xc(c)&&-1!==re.indexOf("/"))throw new $(N.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${g}() must be a plain document ID, but '${re}' contains a slash.`);const Z=c.path.child(De.fromString(re));if(!ae.isDocumentKey(Z))throw new $(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${g}() must result in a valid document path, but '${Z}' is not because it contains an odd number of segments.`);const de=new ae(Z);U.push(Wr(d,de))}else{const Z=Dm(f,g,re);U.push(Z)}}return new Fn(U,A)}(r._query,r.firestore._databaseId,i,e,t,n)}}function Mm(r,e,t){if("string"==typeof(t=(0,Me.Ku)(t))){if(""===t)throw new $(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xc(e)&&-1!==t.indexOf("/"))throw new $(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(De.fromString(t));if(!ae.isDocumentKey(n))throw new $(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Wr(r,new ae(n))}if(t instanceof lt)return Wr(r,t._key);throw new $(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ih(t)}.`)}function Fm(r,e){if(!Array.isArray(r)||0===r.length)throw new $(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Um(r,e){const t=function(i,o){for(const c of i)for(const d of c.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new $(N.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class ip{convertValue(e,t="none"){switch(Ln(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw D()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return wt(e,(i,o)=>{n[i]=this.convertValue(o,t)}),n}convertVectorValue(e){var t,n,i;const o=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(c=>rt(c.doubleValue));return new ah(o)}convertGeoPoint(e){return new oh(rt(e.latitude),rt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ni(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ki(e));default:return null}}convertTimestamp(e){const t=Sn(e);return new nt(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=De.fromString(e);G(Al(n));const i=new Yn(n.get(1),n.get(3)),o=new ae(n.popFirst(5));return i.isEqual(t)||He(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function gh(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class Ly extends ip{constructor(e){super(),this.firestore=e}convertBytes(e){return new kr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lt(this.firestore,null,t)}}class eo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mi extends rc{constructor(e,t,n,i,o,c){super(e,t,n,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new oc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(dh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class oc extends mi{data(e={}){return super.data(e)}}class Zi{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new eo(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new oc(this._firestore,this._userDataWriter,n.key,n,new eo(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map(d=>({type:"added",doc:new oc(i._firestore,i._userDataWriter,d.doc.key,d.doc,new eo(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:c++}))}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(d=>o||3!==d.type).map(d=>{const f=new oc(i._firestore,i._userDataWriter,d.doc.key,d.doc,new eo(i._snapshot.mutatedKeys.has(d.doc.key),i._snapshot.fromCache),i.query.converter);let g=-1,I=-1;return 0!==d.type&&(g=c.indexOf(d.doc.key),c=c.delete(d.doc.key)),1!==d.type&&(c=c.add(d.doc),I=c.indexOf(d.doc.key)),{type:Fy(d.type),doc:f,oldIndex:g,newIndex:I}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Fy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function qm(r,e){return r instanceof mi&&e instanceof mi?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Zi&&e instanceof Zi&&r._firestore===e._firestore&&$f(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class es extends ip{constructor(e){super(),this.firestore=e}convertBytes(e){return new kr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lt(this.firestore,null,t)}}function Km(r,e,t){r=Ne(r,lt);const n=Ne(r.firestore,tt),i=gh(r.converter,e,t);return Oa(n,[ch(Xs(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,ut.none())])}function jm(r,e,t,...n){r=Ne(r,lt);const i=Ne(r.firestore,tt),o=Xs(i);let c;return c="string"==typeof(e=(0,Me.Ku)(e))||e instanceof pi?ep(o,"updateDoc",r._key,e,t,n):Zf(o,"updateDoc",r._key,e),Oa(i,[c.toMutation(r._key,ut.exists(!0))])}function zm(r,...e){var t,n,i;r=(0,Me.Ku)(r);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof e[c]||Hf(e[c])||(o=e[c],c++);const d={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Hf(e[c])){const A=e[c];e[c]=null===(t=A.next)||void 0===t?void 0:t.bind(A),e[c+1]=null===(n=A.error)||void 0===n?void 0:n.bind(A),e[c+2]=null===(i=A.complete)||void 0===i?void 0:i.bind(A)}let f,g,I;if(r instanceof lt)g=Ne(r.firestore,tt),I=As(r._key.path),f={next:A=>{e[c]&&e[c](sp(g,r,A))},error:e[c+1],complete:e[c+2]};else{const A=Ne(r,Kt);g=Ne(A.firestore,tt),I=A._query;const S=new es(g);f={next:U=>{e[c]&&e[c](new Zi(g,S,A,U))},error:e[c+1],complete:e[c+2]},Om(r._query)}return function(S,U,X,re){const Z=new th(re),de=new cf(U,Z,X);return S.asyncQueue.enqueueAndForget((0,H.A)(function*(){return nf(yield Na(S),de)})),()=>{Z.za(),S.asyncQueue.enqueueAndForget((0,H.A)(function*(){return sf(yield Na(S),de)}))}}(mt(g),I,d,f)}function Oa(r,e){return function(n,i){const o=new Pe;return n.asyncQueue.enqueueAndForget((0,H.A)(function*(){return function V_(r,e,t){return _f.apply(this,arguments)}(yield zf(n),i,o)})),o.promise}(mt(r),e)}function sp(r,e,t){const n=t.docs.get(e._key),i=new es(r);return new mi(r,i,e._key,n,new eo(t.hasPendingWrites,t.fromCache),e.converter)}const nI={maxAttempts:5};class Gm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xs(e)}set(e,t,n){this._verifyNotCommitted();const i=ts(e,this._firestore),o=gh(i.converter,t,n),c=ch(this._dataReader,"WriteBatch.set",i._key,o,null!==i.converter,n);return this._mutations.push(c.toMutation(i._key,ut.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const o=ts(e,this._firestore);let c;return c="string"==typeof(t=(0,Me.Ku)(t))||t instanceof pi?ep(this._dataReader,"WriteBatch.update",o._key,t,n,i):Zf(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(c.toMutation(o._key,ut.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ts(e,this._firestore);return this._mutations=this._mutations.concat(new qi(t._key,ut.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ts(r,e){if((r=(0,Me.Ku)(r)).firestore!==e)throw new $(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class rI extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=Xs(t)}get(t){const n=ts(t,this._firestore),i=new Ly(this._firestore);return this._transaction.lookup([n._key]).then(o=>{if(!o||1!==o.length)return D();const c=o[0];if(c.isFoundDocument())return new rc(this._firestore,i,c.key,c,n.converter);if(c.isNoDocument())return new rc(this._firestore,i,n._key,null,n.converter);throw D()})}set(t,n,i){const o=ts(t,this._firestore),c=gh(o.converter,n,i),d=ch(this._dataReader,"Transaction.set",o._key,c,null!==o.converter,i);return this._transaction.set(o._key,d),this}update(t,n,i,...o){const c=ts(t,this._firestore);let d;return d="string"==typeof(n=(0,Me.Ku)(n))||n instanceof pi?ep(this._dataReader,"Transaction.update",c._key,n,i,o):Zf(this._dataReader,"Transaction.update",c._key,n),this._transaction.update(c._key,d),this}delete(t){const n=ts(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ts(e,this._firestore),n=new es(this._firestore);return super.get(e).then(i=>new mi(this._firestore,n,t._key,i._document,new eo(!1,!1),t.converter))}}function ap(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new $("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function Qm(){if(typeof Uint8Array>"u")throw new $("unimplemented","Uint8Arrays are not available in this environment.")}function Jm(){if(!function Ro(){return typeof atob<"u"}())throw new $("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Hn=pe.SDK_VERSION,(0,pe._registerComponent)(new Ri.uA("firestore",(n,{instanceIdentifier:i,options:o})=>{const c=n.getProvider("app").getImmediate(),d=new tt(new Cc(n.getProvider("auth-internal")),new Fh(n.getProvider("app-check-internal")),function(g,I){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new $(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yn(g.options.projectId,I)}(c,i),c);return o=Object.assign({useFetchStreams:t},o),d._setSettings(o),d},"PUBLIC").setMultipleInstances(!0)),(0,pe.registerVersion)(kn,"4.7.1",e),(0,pe.registerVersion)(kn,"4.7.1","esm2017")}();class ac{constructor(e){this._delegate=e}static fromBase64String(e){return Jm(),new ac(kr.fromBase64String(e))}static fromUint8Array(e){return Qm(),new ac(kr.fromUint8Array(e))}toBase64(){return Jm(),this._delegate.toBase64()}toUint8Array(){return Qm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function up(r){return function fI(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class pI{enableIndexedDbPersistence(e,t){return function py(r,e){Pm(r=Ne(r,tt));const t=mt(r);if(t._uninitializedComponentsProvider)throw new $(N.FAILED_PRECONDITION,"SDK cache is already specified.");K("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=r._freezeSettings(),i=new Da;return Sm(t,i,new Mf(i,n.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function my(r){Pm(r=Ne(r,tt));const e=mt(r);if(e._uninitializedComponentsProvider)throw new $(N.FAILED_PRECONDITION,"SDK cache is already specified.");K("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings(),n=new Da;return Sm(e,n,new am(n,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function gy(r){if(r._initialized&&!r._terminated)throw new $(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pe;return r._queue.enqueueAndForgetEvenWhileRestricted((0,H.A)(function*(){try{yield(t=(0,H.A)(function*(i){if(!un.D())return Promise.resolve();const o=i+"main";yield un.delete(o)}),function n(i){return t.apply(this,arguments)})(Fu(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Ym{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Yn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&K("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function Am(r,e,t,n={}){var i;const o=(r=Ne(r,Zu))._getSettings(),c=`${e}:${t}`;if("firestore.googleapis.com"!==o.host&&o.host!==c&&K("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},o),{host:c,ssl:!1})),n.mockUserToken){let d,f;if("string"==typeof n.mockUserToken)d=n.mockUserToken,f=ct.MOCK_USER;else{d=(0,Me.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new $(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ct(g)}r._authCredentials=new Qe(new $t(d,f))}}(this._delegate,e,t,n)}enableNetwork(){return function yy(r){return function Z_(r){return r.asyncQueue.enqueue((0,H.A)(function*(){const e=yield lm(r),t=yield hm(r);return e.setNetworkEnabled(!0),function(i){const o=J(i);return o.L_.delete(0),Qi(o)}(t)}))}(mt(r=Ne(r,tt)))}(this._delegate)}disableNetwork(){return function Iy(r){return function ey(r){return r.asyncQueue.enqueue((0,H.A)(function*(){const e=yield lm(r),t=yield hm(r);return e.setNetworkEnabled(!1),(n=(0,H.A)(function*(o){const c=J(o);c.L_.add(0),yield Dr(c),c.q_.set("Offline")}),function i(o){return n.apply(this,arguments)})(t);var n}))}(mt(r=Ne(r,tt)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,_m("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function _y(r){return function(t){const n=new Pe;return t.asyncQueue.enqueueAndForget((0,H.A)(function*(){return function L_(r,e){return Af.apply(this,arguments)}(yield zf(t),n)})),n.promise}(mt(r=Ne(r,tt)))}(this._delegate)}onSnapshotsInSync(e){return function $y(r,e){return function iy(r,e){const t=new th(e);return r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return i=yield Na(r),o=t,J(i).Y_.add(o),void o.next();var i,o})),()=>{t.za(),r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return i=yield Na(r),o=t,void J(i).Y_.delete(o);var i,o}))}}(mt(r=Ne(r,tt)),Hf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new $("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new La(this,Tm(this._delegate,e))}catch(t){throw ln(t,"collection()","Firestore.collection()")}}doc(e){try{return new Kn(this,sh(this._delegate,e))}catch(t){throw ln(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new hn(this,function ly(r,e){if(r=Ne(r,Zu),Wf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new $(N.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Kt(r,null,(n=e,new Tr(De.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw ln(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function iI(r,e,t){r=Ne(r,tt);const n=Object.assign(Object.assign({},nI),t);return function(o){if(o.maxAttempts<1)throw new $(N.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(o,c,d){const f=new Pe;return o.asyncQueue.enqueueAndForget((0,H.A)(function*(){const g=yield function dm(r){return rh(r).then(e=>e.datastore)}(o);new Y_(o.asyncQueue,g,d,c,f).ru()})),f.promise}(mt(r),i=>e(new rI(r,i)),n)}(this._delegate,t=>e(new Xm(this,t)))}batch(){return mt(this._delegate),new Zm(new Gm(this._delegate,e=>Oa(this._delegate,e)))}loadBundle(e){return function vy(r,e){const t=mt(r=Ne(r,tt)),n=new dy;return function sy(r,e,t,n){const i=function(c,d){let f;return f="string"==typeof c?$o().encode(c):c,I=function(I,A){if(I instanceof Uint8Array)return um(I,A);if(I instanceof ArrayBuffer)return um(new Uint8Array(I),A);if(I instanceof ReadableStream)return I.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(f),new Q_(I,d);var I}(t,Ye(e));r.asyncQueue.enqueueAndForget((0,H.A)(function*(){!function $_(r,e,t){const n=J(r);var i;(i=(0,H.A)(function*(c,d,f){try{const g=yield d.getMetadata();if(yield function(X,re){const Z=J(X),de=gt(re.createTime);return Z.persistence.runTransaction("hasNewerBundle","readonly",_e=>Z.Gr.getBundleMetadata(_e,re.id)).then(_e=>!!_e&&_e.createTime.compareTo(de)>=0)}(c.localStore,g))return yield d.close(),f._completeWith({taskState:"Success",documentsLoaded:(X=g).totalDocuments,bytesLoaded:X.totalBytes,totalDocuments:X.totalDocuments,totalBytes:X.totalBytes}),Promise.resolve(new Set);f._updateProgress(Yp(g));const I=new w_(g,c.localStore,d.serializer);let A=yield d.Ua();for(;A;){const U=yield I.la(A);U&&f._updateProgress(U),A=yield d.Ua()}const S=yield I.complete();return yield fi(c,S.Ia,void 0),yield function(X,re){const Z=J(X);return Z.persistence.runTransaction("Save bundle","readwrite",de=>Z.Gr.saveBundleMetadata(de,re))}(c.localStore,g),f._completeWith(S.progress),Promise.resolve(S.Pa)}catch(g){return K("SyncEngine",`Loading bundle failed with ${g}`),f._failWith(g),Promise.resolve(new Set)}var X}),function o(c,d,f){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield zf(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function Ey(r,e){return function oy(r,e){return r.asyncQueue.enqueue((0,H.A)(function*(){return function(n,i){const o=J(n);return o.persistence.runTransaction("Get named query","readonly",c=>o.Gr.getNamedQuery(c,i))}(yield Va(r),e)}))}(mt(r=Ne(r,tt)),e).then(t=>t?new Kt(r,null,t.query):null)}(this._delegate,e).then(t=>t?new hn(this,t):null)}}class yh extends ip{constructor(e){super(),this.firestore=e}convertBytes(e){return new ac(new kr(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Kn.forKey(t,this.firestore,null)}}class Xm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new yh(e)}get(e){const t=no(e);return this._delegate.get(t).then(n=>new uc(this._firestore,new mi(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=no(e);return n?(ap("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const o=no(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=no(e);return this._delegate.delete(t),this}}class Zm{constructor(e){this._delegate=e}set(e,t,n){const i=no(e);return n?(ap("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const o=no(e);return 2===arguments.length?this._delegate.update(o,t):this._delegate.update(o,t,n,...i),this}delete(e){const t=no(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class to{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new oc(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new cc(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=to.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let o=i.get(t);return o||(o=new to(e,new yh(e),t),i.set(t,o)),o}}to.INSTANCES=new WeakMap;class Kn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new yh(e)}static forPath(e,t,n){if(e.length%2!=0)throw new $("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Kn(t,new lt(t._delegate,n,new ae(e)))}static forKey(e,t,n){return new Kn(t,new lt(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new La(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new La(this.firestore,Tm(this._delegate,e))}catch(t){throw ln(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,Me.Ku)(e))instanceof lt&&wm(this._delegate,e)}set(e,t){t=ap("DocumentReference.set",t);try{return t?Km(this._delegate,e,t):Km(this._delegate,e)}catch(n){throw ln(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?jm(this._delegate,e):jm(this._delegate,e,t,...n)}catch(i){throw ln(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Gy(r){return Oa(Ne(r.firestore,tt),[new qi(r._key,ut.none())])}(this._delegate)}onSnapshot(...e){const t=eg(e),n=tg(e,i=>new uc(this.firestore,new mi(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return zm(this._delegate,t,n)}get(e){let t;return t="cache"===e?.source?function By(r){r=Ne(r,lt);const e=Ne(r.firestore,tt),t=mt(e),n=new es(e);return function ty(r,e){const t=new Pe;return r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return(n=(0,H.A)(function*(o,c,d){try{const f=yield function(I,A){const S=J(I);return S.persistence.runTransaction("read document","readonly",U=>S.localDocuments.getDocument(U,A))}(o,c);f.isFoundDocument()?d.resolve(f):f.isNoDocument()?d.resolve(null):d.reject(new $(N.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(f){const g=Sa(f,`Failed to get document '${c} from cache`);d.reject(g)}}),function i(o,c,d){return n.apply(this,arguments)})(yield Va(r),e,t);var n})),t.promise}(t,r._key).then(i=>new mi(e,n,r._key,i,new eo(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===e?.source?function qy(r){r=Ne(r,lt);const e=Ne(r.firestore,tt);return fm(mt(e),r._key,{source:"server"}).then(t=>sp(e,r,t))}(this._delegate):function Uy(r){r=Ne(r,lt);const e=Ne(r.firestore,tt);return fm(mt(e),r._key).then(t=>sp(e,r,t))}(this._delegate),t.then(n=>new uc(this.firestore,new mi(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new Kn(this.firestore,this._delegate.withConverter(e?to.getInstance(this.firestore,e):null))}}function ln(r,e,t){return r.message=r.message.replace(e,t),r}function eg(r){for(const e of r)if("object"==typeof e&&!up(e))return e;return{}}function tg(r,e){var t,n;let i;return i=up(r[0])?r[0]:up(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:o=>{i.next&&i.next(e(o))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class uc{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Kn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return qm(this._delegate,e._delegate)}}class cc extends uc{data(e){const t=this._delegate.data(e);return this._delegate._converter||function Ee(r){r||D()}(void 0!==t),t}}class hn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new yh(e)}where(e,t,n){try{return new hn(this.firestore,Xi(this._delegate,function by(r,e,t){const n=e,i=dh("where",r);return sc._create(i,n,t)}(e,t,n)))}catch(i){throw ln(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new hn(this.firestore,Xi(this._delegate,function Cy(r,e="asc"){const t=e,n=dh("orderBy",r);return rp._create(n,t)}(e,t)))}catch(n){throw ln(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new hn(this.firestore,Xi(this._delegate,function xy(r){return vm("limit",r),fh._create("limit",r,"F")}(e)))}catch(t){throw ln(t,"limit()","Query.limit()")}}limitToLast(e){try{return new hn(this.firestore,Xi(this._delegate,function Dy(r){return vm("limitToLast",r),fh._create("limitToLast",r,"L")}(e)))}catch(t){throw ln(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new hn(this.firestore,Xi(this._delegate,function Vy(...r){return ph._create("startAt",r,!0)}(...e)))}catch(t){throw ln(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new hn(this.firestore,Xi(this._delegate,function Ny(...r){return ph._create("startAfter",r,!1)}(...e)))}catch(t){throw ln(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new hn(this.firestore,Xi(this._delegate,function ky(...r){return mh._create("endBefore",r,!1)}(...e)))}catch(t){throw ln(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new hn(this.firestore,Xi(this._delegate,function Oy(...r){return mh._create("endAt",r,!0)}(...e)))}catch(t){throw ln(t,"endAt()","Query.endAt()")}}isEqual(e){return $f(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function jy(r){r=Ne(r,Kt);const e=Ne(r.firestore,tt),t=mt(e),n=new es(e);return function ny(r,e){const t=new Pe;return r.asyncQueue.enqueueAndForget((0,H.A)(function*(){return(n=(0,H.A)(function*(o,c,d){try{const f=yield ya(o,c,!0),g=new em(c,f.Ts),I=g.ma(f.documents),A=g.applyChanges(I,!1);d.resolve(A.snapshot)}catch(f){const g=Sa(f,`Failed to execute query '${c} against cache`);d.reject(g)}}),function i(o,c,d){return n.apply(this,arguments)})(yield Va(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Zi(e,n,r,i))}(this._delegate):"server"===e?.source?function zy(r){r=Ne(r,Kt);const e=Ne(r.firestore,tt),t=mt(e),n=new es(e);return pm(t,r._query,{source:"server"}).then(i=>new Zi(e,n,r,i))}(this._delegate):function Ky(r){r=Ne(r,Kt);const e=Ne(r.firestore,tt),t=mt(e),n=new es(e);return Om(r._query),pm(t,r._query).then(i=>new Zi(e,n,r,i))}(this._delegate),t.then(n=>new cp(this.firestore,new Zi(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=eg(e),n=tg(e,i=>new cp(this.firestore,new Zi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return zm(this._delegate,t,n)}withConverter(e){return new hn(this.firestore,this._delegate.withConverter(e?to.getInstance(this.firestore,e):null))}}class gI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new cc(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class cp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new hn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new cc(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new gI(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new cc(this._firestore,n))})}isEqual(e){return qm(this._delegate,e._delegate)}}class La extends hn{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Kn(this.firestore,e):null}doc(e){try{return new Kn(this.firestore,void 0===e?sh(this._delegate):sh(this._delegate,e))}catch(t){throw ln(t,"doc()","CollectionReference.doc()")}}add(e){return function Wy(r,e){const t=Ne(r.firestore,tt),n=sh(r),i=gh(r.converter,e);return Oa(t,[ch(Xs(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,ut.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new Kn(this.firestore,t))}isEqual(e){return wm(this._delegate,e._delegate)}withConverter(e){return new La(this.firestore,this._delegate.withConverter(e?to.getInstance(this.firestore,e):null))}}function no(r){return Ne(r,lt)}class lp{constructor(...e){this._delegate=new pi(...e)}static documentId(){return new lp(Je.keyField().canonicalString())}isEqual(e){return(e=(0,Me.Ku)(e))instanceof pi&&this._delegate._internalPath.isEqual(e._internalPath)}}class ro{constructor(e){this._delegate=e}static serverTimestamp(){const e=function oI(){return new Qf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ro(e)}static delete(){const e=function sI(){return new tc("deleteField")}();return e._methodName="FieldValue.delete",new ro(e)}static arrayUnion(...e){const t=function aI(...r){return new Jf("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new ro(t)}static arrayRemove(...e){const t=function uI(...r){return new Yf("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new ro(t)}static increment(e){const t=function cI(r){return new Xf("increment",r)}(e);return t._methodName="FieldValue.increment",new ro(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const _I={Firestore:Ym,GeoPoint:oh,Timestamp:nt,Blob:ac,Transaction:Xm,WriteBatch:Zm,DocumentReference:Kn,DocumentSnapshot:uc,Query:hn,QueryDocumentSnapshot:cc,QuerySnapshot:cp,CollectionReference:La,FieldPath:lp,FieldValue:ro,setLogLevel:function mI(r){!function po(r){In.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function ng(r,e){return function vI(r,e=Dt.E){return new Ei.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}(r,e)}function hp(r,e){return ng(r,e).pipe((0,St.T)(t=>({payload:t,type:"query"})))}!function II(r){(function yI(r,e){r.INTERNAL.registerComponent(new Ri.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},_I)))})(r,(e,t)=>new Ym(e,t,new pI)),r.registerVersion("@firebase/firestore-compat","0.3.36")}(At.A);class rg{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:o}=ag(n,t);return new og(i,o,this.afs)}snapshotChanges(){return function EI(r,e){return ng(r,e).pipe((0,Wt.Z)(void 0),Mr(),(0,St.T)(t=>{const[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return this.snapshotChanges().pipe((0,St.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,rn.H)(this.ref.get(e)).pipe(Ue)}}function Ih(r,e){return hp(r,e).pipe((0,Wt.Z)(void 0),Mr(),(0,St.T)(t=>{const[n,i]=t,o=i.payload.docChanges(),c=o.map(d=>({type:d.type,payload:d}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((d,f)=>{const g=o.find(A=>A.doc.ref.isEqual(d.ref)),I=n?.payload.docs.find(A=>A.ref.isEqual(d.ref));g&&JSON.stringify(g.doc.metadata)===JSON.stringify(d.metadata)||!g&&I&&JSON.stringify(I.metadata)===JSON.stringify(d.metadata)||c.push({type:"modified",payload:{oldIndex:f,newIndex:f,type:"modified",doc:d}})}),c}))}function ig(r,e,t){return Ih(r,t).pipe((0,Wn.S)((n,i)=>function AI(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function TI(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return dp(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return dp(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return dp(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(o=>o.payload),e),[]),(0,$n.F)(),(0,St.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function dp(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function sg(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class og{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Ih(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,St.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Wt.Z)(void 0),Mr(),(0,Lr.p)(([n,i])=>i.length>0||!n),(0,St.T)(([,n])=>n),Ue)}auditTrail(e){return this.stateChanges(e).pipe((0,Wn.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=sg(e);return ig(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return hp(this.query,this.afs.schedulers.outsideAngular).pipe((0,St.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),Ue)}get(e){return(0,rn.H)(this.query.get(e)).pipe(Ue)}add(e){return this.ref.add(e)}doc(e){return new rg(this.ref.doc(e),this.afs)}}class wI{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ih(this.query,this.afs.schedulers.outsideAngular).pipe((0,St.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,Lr.p)(t=>t.length>0),Ue):Ih(this.query,this.afs.schedulers.outsideAngular).pipe(Ue)}auditTrail(e){return this.stateChanges(e).pipe((0,Wn.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=sg(e);return ig(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return hp(this.query,this.afs.schedulers.outsideAngular).pipe((0,St.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Ue)}get(e){return(0,rn.H)(this.query.get(e)).pipe(Ue)}}const RI=new v.nKC("angularfire2.enableFirestorePersistence"),SI=new v.nKC("angularfire2.firestore.persistenceSettings"),PI=new v.nKC("angularfire2.firestore.settings"),bI=new v.nKC("angularfire2.firestore.use-emulator");function ag(r,e=t=>t){return{query:e(r),ref:r}}let CI=(()=>{class r{schedulers;firestore;persistenceEnabled$;constructor(t,n,i,o,c,d,f,g,I,A,S,U,X,re,Z,de,_e){this.schedulers=f;const se=Ii(t,d,n),ye=I;A&&Vn(se,d,S,X,re,Z,U,de),[this.firestore,this.persistenceEnabled$]=cr(`${se.name}.firestore`,"AngularFirestore",se.name,()=>{const Se=d.runOutsideAngular(()=>se.firestore());if(o&&Se.settings(o),ye&&Se.useEmulator(...ye),i&&!(0,Re.Vy)(c)){const Ce=()=>{try{return(0,rn.H)(Se.enablePersistence(g||void 0).then(()=>!0,()=>!1))}catch(V){return typeof console<"u"&&console.warn(V),(0,Gn.of)(!1)}};return[Se,d.runOutsideAngular(Ce)]}return[Se,(0,Gn.of)(!1)]},[o,ye,i])}collection(t,n){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:o,query:c}=ag(i,n),d=this.schedulers.ngZone.run(()=>o);return new og(d,c,this)}collectionGroup(t,n){const i=n||(c=>c),o=this.firestore.collectionGroup(t);return new wI(i(o),this)}doc(t){let n;n="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>n);return new rg(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(v.KVO(jn),v.KVO(ur,8),v.KVO(RI,8),v.KVO(PI,8),v.KVO(v.Agw),v.KVO(v.SKi),v.KVO(zt),v.KVO(SI,8),v.KVO(bI,8),v.KVO(Nn,8),v.KVO(yn,8),v.KVO(on,8),v.KVO(Tn,8),v.KVO(cs,8),v.KVO(wn,8),v.KVO(fr,8),v.KVO(Vt,8))};static \u0275prov=v.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var xI=fe(1344);let DI=(()=>{class r{constructor(t,n,i,o){this.afs=t,this.afAuth=n,this.router=i,this.ngZone=o,this.afAuth.authState.subscribe(c=>{c?(this.userData=c,localStorage.setItem("toDoom-user",JSON.stringify(this.userData)),JSON.parse(localStorage.getItem("toDoom-user"))):(localStorage.setItem("user","null"),JSON.parse(localStorage.getItem("toDoom-user")))})}SignIn(t,n){return this.afAuth.signInWithEmailAndPassword(t,n).then(i=>{this.SetUserData(i.user),this.afAuth.authState.subscribe(o=>{o&&this.router.navigate([""])})}).catch(i=>{window.alert(i.message)})}SignUp(t,n){return this.afAuth.createUserWithEmailAndPassword(t,n).then(i=>{this.SetUserData(i.user)}).catch(i=>{window.alert(i.message)})}SendVerificationMail(){return this.afAuth.currentUser.then(t=>t.sendEmailVerification()).then(()=>{})}ForgotPassword(t){return this.afAuth.sendPasswordResetEmail(t).then(()=>{window.alert("Password reset email sent, check your inbox.")}).catch(n=>{window.alert(n)})}get isLoggedIn(){const t=JSON.parse(localStorage.getItem("toDoom-user"));return null!==t&&!1!==t.emailVerified}SetUserData(t){return this.afs.doc(`users/${t.uid}`).set({uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,emailVerified:t.emailVerified},{merge:!0})}SignOut(){return this.afAuth.signOut().then(()=>{localStorage.removeItem("toDoom-user"),this.router.navigate(["auth"])})}static#e=this.\u0275fac=function(n){return new(n||r)(v.KVO(CI),v.KVO(Nn),v.KVO(xI.Ix),v.KVO(v.SKi))};static#t=this.\u0275prov=v.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),VI=(()=>{class r{constructor(t){this.authService=t}static#e=this.\u0275fac=function(n){return new(n||r)(v.rXU(DI))};static#t=this.\u0275cmp=v.VBU({type:r,selectors:[["app-auth"]],standalone:!0,features:[v.aNF],decls:25,vars:0,consts:[["userName",""],["userPassword",""],[1,"container"],[1,"displayTableCell"],[1,"authBlock"],[1,"formGroup"],["type","text","placeholder","Username","required","",1,"formControl"],["type","password","placeholder","Password","required","",1,"formControl"],["type","button","value","Log in",1,"btn","btnPrimary",3,"click"],[1,"or"],[1,"orInner"],[1,"forgotPassword"],["routerLink","/forgot-password"],[1,"redirectToLogin"],["routerLink","/register-user",1,"redirect"]],template:function(n,i){if(1&n){const o=v.RV6();v.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3"),v.EFF(4,"Sign In"),v.k0s(),v.j41(5,"div",5),v.nrm(6,"input",6,0),v.k0s(),v.j41(8,"div",5),v.nrm(9,"input",7,1),v.k0s(),v.j41(11,"div",5)(12,"input",8),v.bIt("click",function(){v.eBV(o);const d=v.sdS(7),f=v.sdS(10);return v.Njj(i.authService.SignIn(d.value,f.value))}),v.k0s()(),v.j41(13,"div",5)(14,"span",9)(15,"span",10),v.EFF(16,"Or"),v.k0s()()(),v.j41(17,"div",11)(18,"span",12),v.EFF(19,"Forgot Password?"),v.k0s()()(),v.j41(20,"div",13)(21,"span"),v.EFF(22,"Don't have an account?"),v.j41(23,"span",14),v.EFF(24," Sign Up"),v.k0s()()()()()}}})}return r})()},3345:(uo,pn,fe)=>{fe.d(pn,{A:()=>Vt});var v=fe(1076),Re=fe(1362),pe=fe(7852),Y=fe(8041);class tn{constructor(we,ke){this._delegate=we,this.firebase=ke,(0,pe._addComponent)(we,new Re.uA("app-compat",()=>this,"PUBLIC")),this.container=we.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(we){this._delegate.automaticDataCollectionEnabled=we}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(we=>{this._delegate.checkDestroyed(),we()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,pe.deleteApp)(this._delegate)))}_getService(we,ke=pe._DEFAULT_ENTRY_NAME){var Mt;this._delegate.checkDestroyed();const zt=this._delegate.container.getProvider(we);return!zt.isInitialized()&&"EXPLICIT"===(null===(Mt=zt.getComponent())||void 0===Mt?void 0:Mt.instantiationMode)&&zt.initialize(),zt.getImmediate({identifier:ke})}_removeServiceInstance(we,ke=pe._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(we).clearInstance(ke)}_addComponent(we){(0,pe._addComponent)(this._delegate,we)}_addOrOverwriteComponent(we){(0,pe._addOrOverwriteComponent)(this._delegate,we)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Dt=new v.FA("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),te=function $e(){const Xe=function xn(Xe){const we={},ke={__esModule:!0,initializeApp:function dt(Te,Ue={}){const ft=pe.initializeApp(Te,Ue);if((0,v.gR)(we,ft.name))return we[ft.name];const ne=new Xe(ft,ke);return we[ft.name]=ne,ne},app:zt,registerVersion:pe.registerVersion,setLogLevel:pe.setLogLevel,onLog:pe.onLog,apps:null,SDK_VERSION:pe.SDK_VERSION,INTERNAL:{registerComponent:function Fe(Te){const Ue=Te.name,ft=Ue.replace("-compat","");if(pe._registerComponent(Te)&&"PUBLIC"===Te.type){const ne=(Et=zt())=>{if("function"!=typeof Et[ft])throw Dt.create("invalid-app-argument",{appName:Ue});return Et[ft]()};void 0!==Te.serviceProps&&(0,v.zw)(ne,Te.serviceProps),ke[ft]=ne,Xe.prototype[ft]=function(...Et){return this._getService.bind(this,Ue).apply(this,Te.multipleInstances?Et:[])}}return"PUBLIC"===Te.type?ke[ft]:null},removeApp:function Mt(Te){delete we[Te]},useAsService:function Or(Te,Ue){return"serverAuth"===Ue?null:Ue},modularAPIs:pe}};function zt(Te){if(!(0,v.gR)(we,Te=Te||pe._DEFAULT_ENTRY_NAME))throw Dt.create("no-app",{appName:Te});return we[Te]}return ke.default=ke,Object.defineProperty(ke,"apps",{get:function Ze(){return Object.keys(we).map(Te=>we[Te])}}),zt.App=Xe,ke}(tn);return Xe.INTERNAL=Object.assign(Object.assign({},Xe.INTERNAL),{createFirebaseNamespace:$e,extendNamespace:function we(ke){(0,v.zw)(Xe,ke)},createSubscribe:v.tD,ErrorFactory:v.FA,deepExtend:v.zw}),Xe}(),ie=new Y.Vy("@firebase/app-compat");try{const Xe=(0,v.mS)();if(void 0!==Xe.firebase){ie.warn("\n      Warning: Firebase is already defined in the global scope. Please make sure\n      Firebase library is only loaded once.\n    ");const we=Xe.firebase.SDK_VERSION;we&&we.indexOf("LITE")>=0&&ie.warn("\n        Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n        ")}}catch{}const Vt=te;!function Ke(Xe){(0,pe.registerVersion)("@firebase/app-compat","0.2.40",Xe)}()},7852:(uo,pn,fe)=>{fe.r(pn),fe.d(pn,{FirebaseError:()=>Y.g,SDK_VERSION:()=>$n,_DEFAULT_ENTRY_NAME:()=>_n,_addComponent:()=>Tn,_addOrOverwriteComponent:()=>cs,_apps:()=>sn,_clearComponents:()=>Wt,_components:()=>on,_getProvider:()=>fr,_isFirebaseApp:()=>Nn,_isFirebaseServerApp:()=>fo,_registerComponent:()=>wn,_removeServiceInstance:()=>Vn,_serverApps:()=>yn,deleteApp:()=>pr,getApp:()=>Ut,getApps:()=>Me,initializeApp:()=>H,initializeServerApp:()=>Ri,onLog:()=>R,registerVersion:()=>P,setLogLevel:()=>x});var v=fe(467),Re=fe(1362),pe=fe(8041),Y=fe(1076);const tn=(K,L)=>L.some(D=>K instanceof D);let Lt,Dt;const te=new WeakMap,ie=new WeakMap,Ie=new WeakMap,Le=new WeakMap,Ke=new WeakMap;let we={get(K,L,D){if(K instanceof IDBTransaction){if("done"===L)return ie.get(K);if("objectStoreNames"===L)return K.objectStoreNames||Ie.get(K);if("store"===L)return D.objectStoreNames[1]?void 0:D.objectStore(D.objectStoreNames[0])}return dt(K[L])},set:(K,L,D)=>(K[L]=D,!0),has:(K,L)=>K instanceof IDBTransaction&&("done"===L||"store"===L)||L in K};function zt(K){return"function"==typeof K?function Mt(K){return K!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function $e(){return Dt||(Dt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(K)?function(...L){return K.apply(Ze(this),L),dt(te.get(this))}:function(...L){return dt(K.apply(Ze(this),L))}:function(L,...D){const G=K.call(Ze(this),L,...D);return Ie.set(G,L.sort?L.sort():[L]),dt(G)}}(K):(K instanceof IDBTransaction&&function Xe(K){if(ie.has(K))return;const L=new Promise((D,G)=>{const Ee=()=>{K.removeEventListener("complete",J),K.removeEventListener("error",N),K.removeEventListener("abort",N)},J=()=>{D(),Ee()},N=()=>{G(K.error||new DOMException("AbortError","AbortError")),Ee()};K.addEventListener("complete",J),K.addEventListener("error",N),K.addEventListener("abort",N)});ie.set(K,L)}(K),tn(K,function xn(){return Lt||(Lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(K,we):K)}function dt(K){if(K instanceof IDBRequest)return function Vt(K){const L=new Promise((D,G)=>{const Ee=()=>{K.removeEventListener("success",J),K.removeEventListener("error",N)},J=()=>{D(dt(K.result)),Ee()},N=()=>{G(K.error),Ee()};K.addEventListener("success",J),K.addEventListener("error",N)});return L.then(D=>{D instanceof IDBCursor&&te.set(D,K)}).catch(()=>{}),Ke.set(L,K),L}(K);if(Le.has(K))return Le.get(K);const L=zt(K);return L!==K&&(Le.set(K,L),Ke.set(L,K)),L}const Ze=K=>Ke.get(K),Te=["get","getKey","getAll","getAllKeys","count"],Ue=["put","add","delete","clear"],ft=new Map;function ne(K,L){if(!(K instanceof IDBDatabase)||L in K||"string"!=typeof L)return;if(ft.get(L))return ft.get(L);const D=L.replace(/FromIndex$/,""),G=L!==D,Ee=Ue.includes(D);if(!(D in(G?IDBIndex:IDBObjectStore).prototype)||!Ee&&!Te.includes(D))return;const J=function(){var N=(0,v.A)(function*($,...Pe){const $t=this.transaction($,Ee?"readwrite":"readonly");let Fr=$t.store;return G&&(Fr=Fr.index(Pe.shift())),(yield Promise.all([Fr[D](...Pe),Ee&&$t.done]))[0]});return function(Pe){return N.apply(this,arguments)}}();return ft.set(L,J),J}!function ke(K){we=K(we)}(K=>({...K,get:(L,D,G)=>ne(L,D)||K.get(L,D,G),has:(L,D)=>!!ne(L,D)||K.has(L,D)}));class Et{constructor(L){this.container=L}getPlatformInfoString(){return this.container.getProviders().map(D=>{if(function At(K){const L=K.getComponent();return"VERSION"===L?.type}(D)){const G=D.getImmediate();return`${G.library}/${G.version}`}return null}).filter(D=>D).join(" ")}}const mn="@firebase/app",ar="0.10.10",Gt=new pe.Vy("@firebase/app"),co="@firebase/app-compat",lo="@firebase/analytics-compat",Dn="@firebase/analytics",jn="@firebase/app-check-compat",ur="@firebase/app-check",Ii="@firebase/auth",os="@firebase/auth-compat",Be="@firebase/database",je="@firebase/database-compat",cr="@firebase/functions",vi="@firebase/functions-compat",lr="@firebase/installations",nn="@firebase/installations-compat",zn="@firebase/messaging",as="@firebase/messaging-compat",Gn="@firebase/performance",Ei="@firebase/performance-compat",rn="@firebase/remote-config",Ai="@firebase/remote-config-compat",gn="@firebase/storage",St="@firebase/storage-compat",ho="@firebase/firestore",hr="@firebase/vertexai-preview",dr="@firebase/firestore-compat",Ti="firebase",_n="[DEFAULT]",Lr={[mn]:"fire-core",[co]:"fire-core-compat",[Dn]:"fire-analytics",[lo]:"fire-analytics-compat",[ur]:"fire-app-check",[jn]:"fire-app-check-compat",[Ii]:"fire-auth",[os]:"fire-auth-compat",[Be]:"fire-rtdb",[je]:"fire-rtdb-compat",[cr]:"fire-fn",[vi]:"fire-fn-compat",[lr]:"fire-iid",[nn]:"fire-iid-compat",[zn]:"fire-fcm",[as]:"fire-fcm-compat",[Gn]:"fire-perf",[Ei]:"fire-perf-compat",[rn]:"fire-rc",[Ai]:"fire-rc-compat",[gn]:"fire-gcs",[St]:"fire-gcs-compat",[ho]:"fire-fst",[dr]:"fire-fst-compat",[hr]:"fire-vertex","fire-js":"fire-js",[Ti]:"fire-js-all"},sn=new Map,yn=new Map,on=new Map;function Tn(K,L){try{K.container.addComponent(L)}catch(D){Gt.debug(`Component ${L.name} failed to register with FirebaseApp ${K.name}`,D)}}function cs(K,L){K.container.addOrOverwriteComponent(L)}function wn(K){const L=K.name;if(on.has(L))return Gt.debug(`There were multiple attempts to register component ${L}.`),!1;on.set(L,K);for(const D of sn.values())Tn(D,K);for(const D of yn.values())Tn(D,K);return!0}function fr(K,L){const D=K.container.getProvider("heartbeat").getImmediate({optional:!0});return D&&D.triggerHeartbeat(),K.container.getProvider(L)}function Vn(K,L,D=_n){fr(K,L).clearInstance(D)}function Nn(K){return void 0!==K.options}function fo(K){return void 0!==K.settings}function Wt(){on.clear()}const Ft=new Y.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Mr{constructor(L,D,G){this._isDeleted=!1,this._options=Object.assign({},L),this._config=Object.assign({},D),this._name=D.name,this._automaticDataCollectionEnabled=D.automaticDataCollectionEnabled,this._container=G,this.container.addComponent(new Re.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(L){this.checkDestroyed(),this._automaticDataCollectionEnabled=L}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(L){this._isDeleted=L}checkDestroyed(){if(this.isDeleted)throw Ft.create("app-deleted",{appName:this._name})}}class Wn extends Mr{constructor(L,D,G,Ee){const J=void 0!==D.automaticDataCollectionEnabled&&D.automaticDataCollectionEnabled,N={name:G,automaticDataCollectionEnabled:J};super(void 0!==L.apiKey?L:L.options,N,Ee),this._serverConfig=Object.assign({automaticDataCollectionEnabled:J},D),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,D.releaseOnDeref=void 0,P(mn,ar,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(L){this.isDeleted||(this._refCount++,void 0!==L&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(L,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){pr(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Ft.create("server-app-deleted")}}const $n="10.13.1";function H(K,L={}){let D=K;"object"!=typeof L&&(L={name:L});const G=Object.assign({name:_n,automaticDataCollectionEnabled:!1},L),Ee=G.name;if("string"!=typeof Ee||!Ee)throw Ft.create("bad-app-name",{appName:String(Ee)});if(D||(D=(0,Y.T9)()),!D)throw Ft.create("no-options");const J=sn.get(Ee);if(J){if((0,Y.bD)(D,J.options)&&(0,Y.bD)(G,J.config))return J;throw Ft.create("duplicate-app",{appName:Ee})}const N=new Re.h1(Ee);for(const Pe of on.values())N.addComponent(Pe);const $=new Mr(D,G,N);return sn.set(Ee,$),$}function Ri(K,L){if((0,Y.Bd)()&&!(0,Y.p7)())throw Ft.create("invalid-server-app-environment");let D;void 0===L.automaticDataCollectionEnabled&&(L.automaticDataCollectionEnabled=!1),D=Nn(K)?K.options:K;const G=Object.assign(Object.assign({},L),D);if(void 0!==G.releaseOnDeref&&delete G.releaseOnDeref,void 0!==L.releaseOnDeref&&typeof FinalizationRegistry>"u")throw Ft.create("finalization-registry-not-supported",{});const J=""+($t=JSON.stringify(G),[...$t].reduce((Fr,Qe)=>Math.imul(31,Fr)+Qe.charCodeAt(0)|0,0)),N=yn.get(J);var $t;if(N)return N.incRefCount(L.releaseOnDeref),N;const $=new Re.h1(J);for(const $t of on.values())$.addComponent($t);const Pe=new Wn(D,L,J,$);return yn.set(J,Pe),Pe}function Ut(K=_n){const L=sn.get(K);if(!L&&K===_n&&(0,Y.T9)())return H();if(!L)throw Ft.create("no-app",{appName:K});return L}function Me(){return Array.from(sn.values())}function pr(K){return mr.apply(this,arguments)}function mr(){return(mr=(0,v.A)(function*(K){let L=!1;const D=K.name;sn.has(D)?(L=!0,sn.delete(D)):yn.has(D)&&K.decRefCount()<=0&&(yn.delete(D),L=!0),L&&(yield Promise.all(K.container.getProviders().map(G=>G.delete())),K.isDeleted=!0)})).apply(this,arguments)}function P(K,L,D){var G;let Ee=null!==(G=Lr[K])&&void 0!==G?G:K;D&&(Ee+=`-${D}`);const J=Ee.match(/\s|\//),N=L.match(/\s|\//);if(J||N){const $=[`Unable to register library "${Ee}" with version "${L}":`];return J&&$.push(`library name "${Ee}" contains illegal characters (whitespace or "/")`),J&&N&&$.push("and"),N&&$.push(`version name "${L}" contains illegal characters (whitespace or "/")`),void Gt.warn($.join(" "))}wn(new Re.uA(`${Ee}-version`,()=>({library:Ee,version:L}),"VERSION"))}function R(K,L){if(null!==K&&"function"!=typeof K)throw Ft.create("invalid-log-argument");(0,pe.Ey)(K,L)}function x(K){(0,pe.He)(K)}const Q="firebase-heartbeat-database",q=1,ce="firebase-heartbeat-store";let ve=null;function xe(){return ve||(ve=function Fe(K,L,{blocked:D,upgrade:G,blocking:Ee,terminated:J}={}){const N=indexedDB.open(K,L),$=dt(N);return G&&N.addEventListener("upgradeneeded",Pe=>{G(dt(N.result),Pe.oldVersion,Pe.newVersion,dt(N.transaction),Pe)}),D&&N.addEventListener("blocked",Pe=>D(Pe.oldVersion,Pe.newVersion,Pe)),$.then(Pe=>{J&&Pe.addEventListener("close",()=>J()),Ee&&Pe.addEventListener("versionchange",$t=>Ee($t.oldVersion,$t.newVersion,$t))}).catch(()=>{}),$}(Q,q,{upgrade:(K,L)=>{if(0===L)try{K.createObjectStore(ce)}catch(D){console.warn(D)}}}).catch(K=>{throw Ft.create("idb-open",{originalErrorMessage:K.message})})),ve}function et(){return(et=(0,v.A)(function*(K){try{const D=(yield xe()).transaction(ce),G=yield D.objectStore(ce).get(Nt(K));return yield D.done,G}catch(L){if(L instanceof Y.g)Gt.warn(L.message);else{const D=Ft.create("idb-get",{originalErrorMessage:L?.message});Gt.warn(D.message)}}})).apply(this,arguments)}function _t(K,L){return be.apply(this,arguments)}function be(){return(be=(0,v.A)(function*(K,L){try{const G=(yield xe()).transaction(ce,"readwrite");yield G.objectStore(ce).put(L,Nt(K)),yield G.done}catch(D){if(D instanceof Y.g)Gt.warn(D.message);else{const G=Ft.create("idb-set",{originalErrorMessage:D?.message});Gt.warn(G.message)}}})).apply(this,arguments)}function Nt(K){return`${K.name}!${K.options.appId}`}class Hn{constructor(L){this.container=L,this._heartbeatsCache=null;const D=this.container.getProvider("app").getImmediate();this._storage=new po(D),this._heartbeatsCachePromise=this._storage.read().then(G=>(this._heartbeatsCache=G,G))}triggerHeartbeat(){var L=this;return(0,v.A)(function*(){var D,G;try{const J=L.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),N=In();return null==(null===(D=L._heartbeatsCache)||void 0===D?void 0:D.heartbeats)&&(L._heartbeatsCache=yield L._heartbeatsCachePromise,null==(null===(G=L._heartbeatsCache)||void 0===G?void 0:G.heartbeats))||L._heartbeatsCache.lastSentHeartbeatDate===N||L._heartbeatsCache.heartbeats.some($=>$.date===N)?void 0:(L._heartbeatsCache.heartbeats.push({date:N,agent:J}),L._heartbeatsCache.heartbeats=L._heartbeatsCache.heartbeats.filter($=>{const Pe=new Date($.date).valueOf();return Date.now()-Pe<=2592e6}),L._storage.overwrite(L._heartbeatsCache))}catch(Ee){Gt.warn(Ee)}})()}getHeartbeatsHeader(){var L=this;return(0,v.A)(function*(){var D;try{if(null===L._heartbeatsCache&&(yield L._heartbeatsCachePromise),null==(null===(D=L._heartbeatsCache)||void 0===D?void 0:D.heartbeats)||0===L._heartbeatsCache.heartbeats.length)return"";const G=In(),{heartbeatsToSend:Ee,unsentEntries:J}=function vn(K,L=1024){const D=[];let G=K.slice();for(const Ee of K){const J=D.find(N=>N.agent===Ee.agent);if(J){if(J.dates.push(Ee.date),ee(D)>L){J.dates.pop();break}}else if(D.push({agent:Ee.agent,dates:[Ee.date]}),ee(D)>L){D.pop();break}G=G.slice(1)}return{heartbeatsToSend:D,unsentEntries:G}}(L._heartbeatsCache.heartbeats),N=(0,Y.Uj)(JSON.stringify({version:2,heartbeats:Ee}));return L._heartbeatsCache.lastSentHeartbeatDate=G,J.length>0?(L._heartbeatsCache.heartbeats=J,yield L._storage.overwrite(L._heartbeatsCache)):(L._heartbeatsCache.heartbeats=[],L._storage.overwrite(L._heartbeatsCache)),N}catch(G){return Gt.warn(G),""}})()}}function In(){return(new Date).toISOString().substring(0,10)}class po{constructor(L){this.app=L,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,v.A)(function*(){return!!(0,Y.zW)()&&(0,Y.eX)().then(()=>!0).catch(()=>!1)})()}read(){var L=this;return(0,v.A)(function*(){if(yield L._canUseIndexedDBPromise){const G=yield function Ct(K){return et.apply(this,arguments)}(L.app);return G?.heartbeats?G:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(L){var D=this;return(0,v.A)(function*(){var G;if(yield D._canUseIndexedDBPromise){const J=yield D.read();return _t(D.app,{lastSentHeartbeatDate:null!==(G=L.lastSentHeartbeatDate)&&void 0!==G?G:J.lastSentHeartbeatDate,heartbeats:L.heartbeats})}})()}add(L){var D=this;return(0,v.A)(function*(){var G;if(yield D._canUseIndexedDBPromise){const J=yield D.read();return _t(D.app,{lastSentHeartbeatDate:null!==(G=L.lastSentHeartbeatDate)&&void 0!==G?G:J.lastSentHeartbeatDate,heartbeats:[...J.heartbeats,...L.heartbeats]})}})()}}function ee(K){return(0,Y.Uj)(JSON.stringify({version:2,heartbeats:K})).length}!function He(K){wn(new Re.uA("platform-logger",L=>new Et(L),"PRIVATE")),wn(new Re.uA("heartbeat",L=>new Hn(L),"PRIVATE")),P(mn,ar,K),P(mn,ar,"esm2017"),P("fire-js","")}("")},1362:(uo,pn,fe)=>{fe.d(pn,{h1:()=>xn,uA:()=>pe});var v=fe(467),Re=fe(1076);class pe{constructor(te,ie,Ie){this.name=te,this.instanceFactory=ie,this.type=Ie,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(te){return this.instantiationMode=te,this}setMultipleInstances(te){return this.multipleInstances=te,this}setServiceProps(te){return this.serviceProps=te,this}setInstanceCreatedCallback(te){return this.onInstanceCreated=te,this}}const Y="[DEFAULT]";class tn{constructor(te,ie){this.name=te,this.container=ie,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(te){const ie=this.normalizeInstanceIdentifier(te);if(!this.instancesDeferred.has(ie)){const Ie=new Re.cY;if(this.instancesDeferred.set(ie,Ie),this.isInitialized(ie)||this.shouldAutoInitialize())try{const Le=this.getOrInitializeService({instanceIdentifier:ie});Le&&Ie.resolve(Le)}catch{}}return this.instancesDeferred.get(ie).promise}getImmediate(te){var ie;const Ie=this.normalizeInstanceIdentifier(te?.identifier),Le=null!==(ie=te?.optional)&&void 0!==ie&&ie;if(!this.isInitialized(Ie)&&!this.shouldAutoInitialize()){if(Le)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:Ie})}catch(Ke){if(Le)return null;throw Ke}}getComponent(){return this.component}setComponent(te){if(te.name!==this.name)throw Error(`Mismatching Component ${te.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=te,this.shouldAutoInitialize()){if(function Dt($e){return"EAGER"===$e.instantiationMode}(te))try{this.getOrInitializeService({instanceIdentifier:Y})}catch{}for(const[ie,Ie]of this.instancesDeferred.entries()){const Le=this.normalizeInstanceIdentifier(ie);try{const Ke=this.getOrInitializeService({instanceIdentifier:Le});Ie.resolve(Ke)}catch{}}}}clearInstance(te=Y){this.instancesDeferred.delete(te),this.instancesOptions.delete(te),this.instances.delete(te)}delete(){var te=this;return(0,v.A)(function*(){const ie=Array.from(te.instances.values());yield Promise.all([...ie.filter(Ie=>"INTERNAL"in Ie).map(Ie=>Ie.INTERNAL.delete()),...ie.filter(Ie=>"_delete"in Ie).map(Ie=>Ie._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(te=Y){return this.instances.has(te)}getOptions(te=Y){return this.instancesOptions.get(te)||{}}initialize(te={}){const{options:ie={}}=te,Ie=this.normalizeInstanceIdentifier(te.instanceIdentifier);if(this.isInitialized(Ie))throw Error(`${this.name}(${Ie}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const Le=this.getOrInitializeService({instanceIdentifier:Ie,options:ie});for(const[Ke,Vt]of this.instancesDeferred.entries())Ie===this.normalizeInstanceIdentifier(Ke)&&Vt.resolve(Le);return Le}onInit(te,ie){var Ie;const Le=this.normalizeInstanceIdentifier(ie),Ke=null!==(Ie=this.onInitCallbacks.get(Le))&&void 0!==Ie?Ie:new Set;Ke.add(te),this.onInitCallbacks.set(Le,Ke);const Vt=this.instances.get(Le);return Vt&&te(Vt,Le),()=>{Ke.delete(te)}}invokeOnInitCallbacks(te,ie){const Ie=this.onInitCallbacks.get(ie);if(Ie)for(const Le of Ie)try{Le(te,ie)}catch{}}getOrInitializeService({instanceIdentifier:te,options:ie={}}){let Ie=this.instances.get(te);if(!Ie&&this.component&&(Ie=this.component.instanceFactory(this.container,{instanceIdentifier:($e=te,$e===Y?void 0:$e),options:ie}),this.instances.set(te,Ie),this.instancesOptions.set(te,ie),this.invokeOnInitCallbacks(Ie,te),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,te,Ie)}catch{}var $e;return Ie||null}normalizeInstanceIdentifier(te=Y){return this.component?this.component.multipleInstances?te:Y:te}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class xn{constructor(te){this.name=te,this.providers=new Map}addComponent(te){const ie=this.getProvider(te.name);if(ie.isComponentSet())throw new Error(`Component ${te.name} has already been registered with ${this.name}`);ie.setComponent(te)}addOrOverwriteComponent(te){this.getProvider(te.name).isComponentSet()&&this.providers.delete(te.name),this.addComponent(te)}getProvider(te){if(this.providers.has(te))return this.providers.get(te);const ie=new tn(te,this);return this.providers.set(te,ie),ie}getProviders(){return Array.from(this.providers.values())}}},8041:(uo,pn,fe)=>{fe.d(pn,{$b:()=>Re,Ey:()=>$e,He:()=>xn,Vy:()=>Dt});const v=[];var Re=function(te){return te[te.DEBUG=0]="DEBUG",te[te.VERBOSE=1]="VERBOSE",te[te.INFO=2]="INFO",te[te.WARN=3]="WARN",te[te.ERROR=4]="ERROR",te[te.SILENT=5]="SILENT",te}(Re||{});const pe={debug:Re.DEBUG,verbose:Re.VERBOSE,info:Re.INFO,warn:Re.WARN,error:Re.ERROR,silent:Re.SILENT},Y=Re.INFO,tn={[Re.DEBUG]:"log",[Re.VERBOSE]:"log",[Re.INFO]:"info",[Re.WARN]:"warn",[Re.ERROR]:"error"},Lt=(te,ie,...Ie)=>{if(ie<te.logLevel)return;const Le=(new Date).toISOString(),Ke=tn[ie];if(!Ke)throw new Error(`Attempted to log a message with an invalid logType (value: ${ie})`);console[Ke](`[${Le}]  ${te.name}:`,...Ie)};class Dt{constructor(ie){this.name=ie,this._logLevel=Y,this._logHandler=Lt,this._userLogHandler=null,v.push(this)}get logLevel(){return this._logLevel}set logLevel(ie){if(!(ie in Re))throw new TypeError(`Invalid value "${ie}" assigned to \`logLevel\``);this._logLevel=ie}setLogLevel(ie){this._logLevel="string"==typeof ie?pe[ie]:ie}get logHandler(){return this._logHandler}set logHandler(ie){if("function"!=typeof ie)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=ie}get userLogHandler(){return this._userLogHandler}set userLogHandler(ie){this._userLogHandler=ie}debug(...ie){this._userLogHandler&&this._userLogHandler(this,Re.DEBUG,...ie),this._logHandler(this,Re.DEBUG,...ie)}log(...ie){this._userLogHandler&&this._userLogHandler(this,Re.VERBOSE,...ie),this._logHandler(this,Re.VERBOSE,...ie)}info(...ie){this._userLogHandler&&this._userLogHandler(this,Re.INFO,...ie),this._logHandler(this,Re.INFO,...ie)}warn(...ie){this._userLogHandler&&this._userLogHandler(this,Re.WARN,...ie),this._logHandler(this,Re.WARN,...ie)}error(...ie){this._userLogHandler&&this._userLogHandler(this,Re.ERROR,...ie),this._logHandler(this,Re.ERROR,...ie)}}function xn(te){v.forEach(ie=>{ie.setLogLevel(te)})}function $e(te,ie){for(const Ie of v){let Le=null;ie&&ie.level&&(Le=pe[ie.level]),Ie.userLogHandler=null===te?null:(Ke,Vt,...Xe)=>{const we=Xe.map(ke=>{if(null==ke)return null;if("string"==typeof ke)return ke;if("number"==typeof ke||"boolean"==typeof ke)return ke.toString();if(ke instanceof Error)return ke.message;try{return JSON.stringify(ke)}catch{return null}}).filter(ke=>ke).join(" ");Vt>=(Le??Ke.logLevel)&&te({level:Re[Vt].toLowerCase(),message:we,args:Xe,type:Ke.name})}}}},3200:(uo,pn,fe)=>{var v=fe(467),Re=fe(3345),pe=fe(7852),Y=fe(1076),tn=fe(8041),Lt=fe(1635),Dt=fe(1362);const $e={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const Vt=function Le(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},Xe=function Ke(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},we=new Y.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Mt=new tn.Vy("@firebase/auth");function dt(l,...s){Mt.logLevel<=tn.$b.ERROR&&Mt.error(`Auth (${pe.SDK_VERSION}): ${l}`,...s)}function Ze(l,...s){throw ft(l,...s)}function Fe(l,...s){return ft(l,...s)}function Or(l,s,a){const h=Object.assign(Object.assign({},Xe()),{[s]:a});return new Y.FA("auth","Firebase",h).create(s,{appName:l.name})}function Te(l){return Or(l,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ue(l,s,a){if(!(s instanceof a))throw a.name!==s.constructor.name&&Ze(l,"argument-error"),Or(l,"argument-error",`Type of ${s.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ft(l,...s){if("string"!=typeof l){const a=s[0],h=[...s.slice(1)];return h[0]&&(h[0].appName=l.name),l._errorFactory.create(a,...h)}return we.create(l,...s)}function ne(l,s,...a){if(!l)throw ft(s,...a)}function Et(l){const s="INTERNAL ASSERTION FAILED: "+l;throw dt(s),new Error(s)}function At(l,s){l||Et(s)}function mn(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.href)||""}function ar(){return"http:"===Gt()||"https:"===Gt()}function Gt(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}class Dn{constructor(s,a){this.shortDelay=s,this.longDelay=a,At(a>s,"Short delay should be less than long delay!"),this.isMobile=(0,Y.jZ)()||(0,Y.lV)()}get(){return function co(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ar()||(0,Y.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function jn(l,s){At(l.emulator,"Emulator should always be set here");const{url:a}=l.emulator;return s?`${a}${s.startsWith("/")?s.slice(1):s}`:a}class ur{static initialize(s,a,h){this.fetchImpl=s,a&&(this.headersImpl=a),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void Et("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void Et("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void Et("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ii={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},os=new Dn(3e4,6e4);function Be(l,s){return l.tenantId&&!s.tenantId?Object.assign(Object.assign({},s),{tenantId:l.tenantId}):s}function je(l,s,a,h){return cr.apply(this,arguments)}function cr(){return(cr=(0,v.A)(function*(l,s,a,h,m={}){return vi(l,m,(0,v.A)(function*(){let y={},w={};h&&("GET"===s?w=h:y={body:JSON.stringify(h)});const O=(0,Y.Am)(Object.assign({key:l.config.apiKey},w)).slice(1),z=yield l._getAdditionalHeaders();return z["Content-Type"]="application/json",l.languageCode&&(z["X-Firebase-Locale"]=l.languageCode),ur.fetch()(as(l,l.config.apiHost,a,O),Object.assign({method:s,headers:z,referrerPolicy:"no-referrer"},y))}))})).apply(this,arguments)}function vi(l,s,a){return lr.apply(this,arguments)}function lr(){return(lr=(0,v.A)(function*(l,s,a){l._canInitEmulator=!1;const h=Object.assign(Object.assign({},Ii),s);try{const m=new Ei(l),y=yield Promise.race([a(),m.promise]);m.clearNetworkTimeout();const w=yield y.json();if("needConfirmation"in w)throw rn(l,"account-exists-with-different-credential",w);if(y.ok&&!("errorMessage"in w))return w;{const O=y.ok?w.errorMessage:w.error.message,[z,oe]=O.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===z)throw rn(l,"credential-already-in-use",w);if("EMAIL_EXISTS"===z)throw rn(l,"email-already-in-use",w);if("USER_DISABLED"===z)throw rn(l,"user-disabled",w);const he=h[z]||z.toLowerCase().replace(/[_\s]+/g,"-");if(oe)throw Or(l,he,oe);Ze(l,he)}}catch(m){if(m instanceof Y.g)throw m;Ze(l,"network-request-failed",{message:String(m)})}})).apply(this,arguments)}function nn(l,s,a,h){return zn.apply(this,arguments)}function zn(){return(zn=(0,v.A)(function*(l,s,a,h,m={}){const y=yield je(l,s,a,h,m);return"mfaPendingCredential"in y&&Ze(l,"multi-factor-auth-required",{_serverResponse:y}),y})).apply(this,arguments)}function as(l,s,a,h){const m=`${s}${a}?${h}`;return l.config.emulator?jn(l.config,m):`${l.config.apiScheme}://${m}`}function Gn(l){switch(l){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ei{constructor(s){this.auth=s,this.timer=null,this.promise=new Promise((a,h)=>{this.timer=setTimeout(()=>h(Fe(this.auth,"network-request-failed")),os.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function rn(l,s,a){const h={appName:l.name};a.email&&(h.email=a.email),a.phoneNumber&&(h.phoneNumber=a.phoneNumber);const m=Fe(l,s,h);return m.customData._tokenResponse=a,m}function Ai(l){return void 0!==l&&void 0!==l.getResponse}function gn(l){return void 0!==l&&void 0!==l.enterprise}class St{constructor(s){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===s.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=s.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=s.recaptchaEnforcementState}getProviderEnforcementState(s){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const a of this.recaptchaEnforcementState)if(a.provider&&a.provider===s)return Gn(a.enforcementState);return null}isProviderEnabled(s){return"ENFORCE"===this.getProviderEnforcementState(s)||"AUDIT"===this.getProviderEnforcementState(s)}}function hr(){return(hr=(0,v.A)(function*(l){return(yield je(l,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function dr(l,s){return Ti.apply(this,arguments)}function Ti(){return(Ti=(0,v.A)(function*(l,s){return je(l,"GET","/v2/recaptchaConfig",Be(l,s))})).apply(this,arguments)}function _n(){return(_n=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:delete",s)})).apply(this,arguments)}function sn(){return(sn=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function yn(l,s){return on.apply(this,arguments)}function on(){return(on=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:lookup",s)})).apply(this,arguments)}function Tn(l){if(l)try{const s=new Date(Number(l));if(!isNaN(s.getTime()))return s.toUTCString()}catch{}}function fr(){return(fr=(0,v.A)(function*(l,s=!1){const a=(0,Y.Ku)(l),h=yield a.getIdToken(s),m=Nn(h);ne(m&&m.exp&&m.auth_time&&m.iat,a.auth,"internal-error");const y="object"==typeof m.firebase?m.firebase:void 0,w=y?.sign_in_provider;return{claims:m,token:h,authTime:Tn(Vn(m.auth_time)),issuedAtTime:Tn(Vn(m.iat)),expirationTime:Tn(Vn(m.exp)),signInProvider:w||null,signInSecondFactor:y?.sign_in_second_factor||null}})).apply(this,arguments)}function Vn(l){return 1e3*Number(l)}function Nn(l){const[s,a,h]=l.split(".");if(void 0===s||void 0===a||void 0===h)return dt("JWT malformed, contained fewer than 3 sections"),null;try{const m=(0,Y.u)(a);return m?JSON.parse(m):(dt("Failed to decode base64 JWT payload"),null)}catch(m){return dt("Caught error parsing JWT payload as JSON",m?.toString()),null}}function fo(l){const s=Nn(l);return ne(s,"internal-error"),ne(typeof s.exp<"u","internal-error"),ne(typeof s.iat<"u","internal-error"),Number(s.exp)-Number(s.iat)}function Wt(l,s){return wi.apply(this,arguments)}function wi(){return(wi=(0,v.A)(function*(l,s,a=!1){if(a)return s;try{return yield s}catch(h){throw h instanceof Y.g&&function Ft({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(h)&&l.auth.currentUser===l&&(yield l.auth.signOut()),h}})).apply(this,arguments)}class Mr{constructor(s){this.user=s,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(s){var a;if(s){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const m=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,m)}}schedule(s=!1){var a=this;if(!this.isRunning)return;const h=this.getInterval(s);this.timerId=setTimeout((0,v.A)(function*(){yield a.iteration()}),h)}iteration(){var s=this;return(0,v.A)(function*(){try{yield s.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===a?.code&&s.schedule(!0))}s.schedule()})()}}class Wn{constructor(s,a){this.createdAt=s,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tn(this.lastLoginAt),this.creationTime=Tn(this.createdAt)}_copy(s){this.createdAt=s.createdAt,this.lastLoginAt=s.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function $n(l){return H.apply(this,arguments)}function H(){return(H=(0,v.A)(function*(l){var s;const a=l.auth,h=yield l.getIdToken(),m=yield Wt(l,yn(a,{idToken:h}));ne(m?.users.length,a,"internal-error");const y=m.users[0];l._notifyReloadListener(y);const w=null!==(s=y.providerUserInfo)&&void 0!==s&&s.length?pr(y.providerUserInfo):[],O=function Me(l,s){return[...l.filter(h=>!s.some(m=>m.providerId===h.providerId)),...s]}(l.providerData,w),he=!!l.isAnonymous&&!(l.email&&y.passwordHash||O?.length),le={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:O,metadata:new Wn(y.createdAt,y.lastLoginAt),isAnonymous:he};Object.assign(l,le)})).apply(this,arguments)}function Ut(){return(Ut=(0,v.A)(function*(l){const s=(0,Y.Ku)(l);yield $n(s),yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)})).apply(this,arguments)}function pr(l){return l.map(s=>{var{providerId:a}=s,h=(0,Lt.Tt)(s,["providerId"]);return{providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function P(){return(P=(0,v.A)(function*(l,s){const a=yield vi(l,{},(0,v.A)(function*(){const h=(0,Y.Am)({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:m,apiKey:y}=l.config,w=as(l,m,"/v1/token",`key=${y}`),O=yield l._getAdditionalHeaders();return O["Content-Type"]="application/x-www-form-urlencoded",ur.fetch()(w,{method:"POST",headers:O,body:h})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}function x(){return(x=(0,v.A)(function*(l,s){return je(l,"POST","/v2/accounts:revokeToken",Be(l,s))})).apply(this,arguments)}class Q{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(s){ne(s.idToken,"internal-error"),ne(typeof s.idToken<"u","internal-error"),ne(typeof s.refreshToken<"u","internal-error");const a="expiresIn"in s&&typeof s.expiresIn<"u"?Number(s.expiresIn):fo(s.idToken);this.updateTokensAndExpiration(s.idToken,s.refreshToken,a)}updateFromIdToken(s){ne(0!==s.length,"internal-error");const a=fo(s);this.updateTokensAndExpiration(s,null,a)}getToken(s,a=!1){var h=this;return(0,v.A)(function*(){return a||!h.accessToken||h.isExpired?(ne(h.refreshToken,s,"user-token-expired"),h.refreshToken?(yield h.refresh(s,h.refreshToken),h.accessToken):null):h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(s,a){var h=this;return(0,v.A)(function*(){const{accessToken:m,refreshToken:y,expiresIn:w}=yield function mr(l,s){return P.apply(this,arguments)}(s,a);h.updateTokensAndExpiration(m,y,Number(w))})()}updateTokensAndExpiration(s,a,h){this.refreshToken=a||null,this.accessToken=s||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(s,a){const{refreshToken:h,accessToken:m,expirationTime:y}=a,w=new Q;return h&&(ne("string"==typeof h,"internal-error",{appName:s}),w.refreshToken=h),m&&(ne("string"==typeof m,"internal-error",{appName:s}),w.accessToken=m),y&&(ne("number"==typeof y,"internal-error",{appName:s}),w.expirationTime=y),w}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(s){this.accessToken=s.accessToken,this.refreshToken=s.refreshToken,this.expirationTime=s.expirationTime}_clone(){return Object.assign(new Q,this.toJSON())}_performRefresh(){return Et("not implemented")}}function q(l,s){ne("string"==typeof l||typeof l>"u","internal-error",{appName:s})}class ce{constructor(s){var{uid:a,auth:h,stsTokenManager:m}=s,y=(0,Lt.Tt)(s,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Mr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=m,this.accessToken=m.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new Wn(y.createdAt||void 0,y.lastLoginAt||void 0)}getIdToken(s){var a=this;return(0,v.A)(function*(){const h=yield Wt(a,a.stsTokenManager.getToken(a.auth,s));return ne(h,a.auth,"internal-error"),a.accessToken!==h&&(a.accessToken=h,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),h})()}getIdTokenResult(s){return function wn(l){return fr.apply(this,arguments)}(this,s)}reload(){return function Ri(l){return Ut.apply(this,arguments)}(this)}_assign(s){this!==s&&(ne(this.uid===s.uid,this.auth,"internal-error"),this.displayName=s.displayName,this.photoURL=s.photoURL,this.email=s.email,this.emailVerified=s.emailVerified,this.phoneNumber=s.phoneNumber,this.isAnonymous=s.isAnonymous,this.tenantId=s.tenantId,this.providerData=s.providerData.map(a=>Object.assign({},a)),this.metadata._copy(s.metadata),this.stsTokenManager._assign(s.stsTokenManager))}_clone(s){const a=new ce(Object.assign(Object.assign({},this),{auth:s,stsTokenManager:this.stsTokenManager._clone()}));return a.metadata._copy(this.metadata),a}_onReload(s){ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=s,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(s){this.reloadListener?this.reloadListener(s):this.reloadUserInfo=s}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(s,a=!1){var h=this;return(0,v.A)(function*(){let m=!1;s.idToken&&s.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(s),m=!0),a&&(yield $n(h)),yield h.auth._persistUserIfCurrent(h),m&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var s=this;return(0,v.A)(function*(){if((0,pe._isFirebaseServerApp)(s.auth.app))return Promise.reject(Te(s.auth));const a=yield s.getIdToken();return yield Wt(s,function us(l,s){return _n.apply(this,arguments)}(s.auth,{idToken:a})),s.stsTokenManager.clearRefreshToken(),s.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(s=>Object.assign({},s)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(s,a){var h,m,y,w,O,z,oe,he;const le=null!==(h=a.displayName)&&void 0!==h?h:void 0,Ye=null!==(m=a.email)&&void 0!==m?m:void 0,cn=null!==(y=a.phoneNumber)&&void 0!==y?y:void 0,Js=null!==(w=a.photoURL)&&void 0!==w?w:void 0,Jl=null!==(O=a.tenantId)&&void 0!==O?O:void 0,Ju=null!==(z=a._redirectEventId)&&void 0!==z?z:void 0,Yl=null!==(oe=a.createdAt)&&void 0!==oe?oe:void 0,Xl=null!==(he=a.lastLoginAt)&&void 0!==he?he:void 0,{uid:Yu,emailVerified:Qi,isAnonymous:Ea,providerData:Dr,stsTokenManager:Aa}=a;ne(Yu&&Aa,s,"internal-error");const Ta=Q.fromJSON(this.name,Aa);ne("string"==typeof Yu,s,"internal-error"),q(le,s.name),q(Ye,s.name),ne("boolean"==typeof Qi,s,"internal-error"),ne("boolean"==typeof Ea,s,"internal-error"),q(cn,s.name),q(Js,s.name),q(Jl,s.name),q(Ju,s.name),q(Yl,s.name),q(Xl,s.name);const Vr=new ce({uid:Yu,auth:s,email:Ye,emailVerified:Qi,displayName:le,isAnonymous:Ea,photoURL:Js,phoneNumber:cn,tenantId:Jl,stsTokenManager:Ta,createdAt:Yl,lastLoginAt:Xl});return Dr&&Array.isArray(Dr)&&(Vr.providerData=Dr.map(Xu=>Object.assign({},Xu))),Ju&&(Vr._redirectEventId=Ju),Vr}static _fromIdTokenResponse(s,a,h=!1){return(0,v.A)(function*(){const m=new Q;m.updateFromServerResponse(a);const y=new ce({uid:a.localId,auth:s,stsTokenManager:m,isAnonymous:h});return yield $n(y),y})()}static _fromGetAccountInfoResponse(s,a,h){return(0,v.A)(function*(){const m=a.users[0];ne(void 0!==m.localId,"internal-error");const y=void 0!==m.providerUserInfo?pr(m.providerUserInfo):[],w=!(m.email&&m.passwordHash||y?.length),O=new Q;O.updateFromIdToken(h);const z=new ce({uid:m.localId,auth:s,stsTokenManager:O,isAnonymous:w}),oe={uid:m.localId,displayName:m.displayName||null,photoURL:m.photoUrl||null,email:m.email||null,emailVerified:m.emailVerified||!1,phoneNumber:m.phoneNumber||null,tenantId:m.tenantId||null,providerData:y,metadata:new Wn(m.createdAt,m.lastLoginAt),isAnonymous:!(m.email&&m.passwordHash||y?.length)};return Object.assign(z,oe),z})()}}const ve=new Map;function xe(l){At(l instanceof Function,"Expected a class definition");let s=ve.get(l);return s?(At(s instanceof l,"Instance stored in cache mismatched with class"),s):(s=new l,ve.set(l,s),s)}const et=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,v.A)(function*(){return!0})()}_set(a,h){var m=this;return(0,v.A)(function*(){m.storage[a]=h})()}_get(a){var h=this;return(0,v.A)(function*(){const m=h.storage[a];return void 0===m?null:m})()}_remove(a){var h=this;return(0,v.A)(function*(){delete h.storage[a]})()}_addListener(a,h){}_removeListener(a,h){}}return l.type="NONE",l})();function _t(l,s,a){return`firebase:${l}:${s}:${a}`}class be{constructor(s,a,h){this.persistence=s,this.auth=a,this.userKey=h;const{config:m,name:y}=this.auth;this.fullUserKey=_t(this.userKey,m.apiKey,y),this.fullPersistenceKey=_t("persistence",m.apiKey,y),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(s){return this.persistence._set(this.fullUserKey,s.toJSON())}getCurrentUser(){var s=this;return(0,v.A)(function*(){const a=yield s.persistence._get(s.fullUserKey);return a?ce._fromJSON(s.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(s){var a=this;return(0,v.A)(function*(){if(a.persistence===s)return;const h=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=s,h?a.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(s,a,h="authUser"){return(0,v.A)(function*(){if(!a.length)return new be(xe(et),s,h);const m=(yield Promise.all(a.map(function(){var oe=(0,v.A)(function*(he){if(yield he._isAvailable())return he});return function(he){return oe.apply(this,arguments)}}()))).filter(oe=>oe);let y=m[0]||xe(et);const w=_t(h,s.config.apiKey,s.name);let O=null;for(const oe of a)try{const he=yield oe._get(w);if(he){const le=ce._fromJSON(s,he);oe!==y&&(O=le),y=oe;break}}catch{}const z=m.filter(oe=>oe._shouldAllowMigration);return y._shouldAllowMigration&&z.length?(y=z[0],O&&(yield y._set(w,O.toJSON())),yield Promise.all(a.map(function(){var oe=(0,v.A)(function*(he){if(he!==y)try{yield he._remove(w)}catch{}});return function(he){return oe.apply(this,arguments)}}())),new be(y,s,h)):new be(y,s,h)})()}}function Nt(l){const s=l.toLowerCase();if(s.includes("opera/")||s.includes("opr/")||s.includes("opios/"))return"Opera";if(In(s))return"IEMobile";if(s.includes("msie")||s.includes("trident/"))return"IE";if(s.includes("edge/"))return"Edge";if(kn(s))return"Firefox";if(s.includes("silk/"))return"Silk";if(po(s))return"Blackberry";if(ee(s))return"Webos";if(ct(s))return"Safari";if((s.includes("chrome/")||Hn(s))&&!s.includes("edge/"))return"Chrome";if(vn(s))return"Android";{const h=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===h?.length)return h[1]}return"Other"}function kn(l=(0,Y.ZQ)()){return/firefox\//i.test(l)}function ct(l=(0,Y.ZQ)()){const s=l.toLowerCase();return s.includes("safari/")&&!s.includes("chrome/")&&!s.includes("crios/")&&!s.includes("android")}function Hn(l=(0,Y.ZQ)()){return/crios\//i.test(l)}function In(l=(0,Y.ZQ)()){return/iemobile/i.test(l)}function vn(l=(0,Y.ZQ)()){return/android/i.test(l)}function po(l=(0,Y.ZQ)()){return/blackberry/i.test(l)}function ee(l=(0,Y.ZQ)()){return/webos/i.test(l)}function He(l=(0,Y.ZQ)()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function G(l=(0,Y.ZQ)()){return He(l)||vn(l)||ee(l)||po(l)||/windows phone/i.test(l)||In(l)}function Ee(l,s=[]){let a;switch(l){case"Browser":a=Nt((0,Y.ZQ)());break;case"Worker":a=`${Nt((0,Y.ZQ)())}-${l}`;break;default:a=l}const h=s.length?s.join(","):"FirebaseCore-web";return`${a}/JsCore/${pe.SDK_VERSION}/${h}`}class J{constructor(s){this.auth=s,this.queue=[]}pushCallback(s,a){const h=y=>new Promise((w,O)=>{try{w(s(y))}catch(z){O(z)}});h.onAbort=a,this.queue.push(h);const m=this.queue.length-1;return()=>{this.queue[m]=()=>Promise.resolve()}}runMiddleware(s){var a=this;return(0,v.A)(function*(){if(a.auth.currentUser===s)return;const h=[];try{for(const m of a.queue)yield m(s),m.onAbort&&h.push(m.onAbort)}catch(m){h.reverse();for(const y of h)try{y()}catch{}throw a.auth._errorFactory.create("login-blocked",{originalMessage:m?.message})}})()}}function $(){return($=(0,v.A)(function*(l,s={}){return je(l,"GET","/v2/passwordPolicy",Be(l,s))})).apply(this,arguments)}class $t{constructor(s){var a,h,m,y;const w=s.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(a=w.minPasswordLength)&&void 0!==a?a:6,w.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=w.maxPasswordLength),void 0!==w.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=w.containsLowercaseCharacter),void 0!==w.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=w.containsUppercaseCharacter),void 0!==w.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=w.containsNumericCharacter),void 0!==w.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=w.containsNonAlphanumericCharacter),this.enforcementState=s.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(m=null===(h=s.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==m?m:"",this.forceUpgradeOnSignin=null!==(y=s.forceUpgradeOnSignin)&&void 0!==y&&y,this.schemaVersion=s.schemaVersion}validatePassword(s){var a,h,m,y,w,O;const z={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(s,z),this.validatePasswordCharacterOptions(s,z),z.isValid&&(z.isValid=null===(a=z.meetsMinPasswordLength)||void 0===a||a),z.isValid&&(z.isValid=null===(h=z.meetsMaxPasswordLength)||void 0===h||h),z.isValid&&(z.isValid=null===(m=z.containsLowercaseLetter)||void 0===m||m),z.isValid&&(z.isValid=null===(y=z.containsUppercaseLetter)||void 0===y||y),z.isValid&&(z.isValid=null===(w=z.containsNumericCharacter)||void 0===w||w),z.isValid&&(z.isValid=null===(O=z.containsNonAlphanumericCharacter)||void 0===O||O),z}validatePasswordLengthOptions(s,a){const h=this.customStrengthOptions.minPasswordLength,m=this.customStrengthOptions.maxPasswordLength;h&&(a.meetsMinPasswordLength=s.length>=h),m&&(a.meetsMaxPasswordLength=s.length<=m)}validatePasswordCharacterOptions(s,a){let h;this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);for(let m=0;m<s.length;m++)h=s.charAt(m),this.updatePasswordCharacterOptionsStatuses(a,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(s,a,h,m,y){this.customStrengthOptions.containsLowercaseLetter&&(s.containsLowercaseLetter||(s.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(s.containsUppercaseLetter||(s.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(s.containsNumericCharacter||(s.containsNumericCharacter=m)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(s.containsNonAlphanumericCharacter||(s.containsNonAlphanumericCharacter=y))}}class Fr{constructor(s,a,h,m){this.app=s,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=h,this.config=m,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Cc(this),this.idTokenSubscription=new Cc(this),this.beforeStateQueue=new J(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=we,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=s.name,this.clientVersion=m.sdkClientVersion}_initializeWithPersistence(s,a){var h=this;return a&&(this._popupRedirectResolver=xe(a)),this._initializationPromise=this.queue((0,v.A)(function*(){var m,y;if(!h._deleted&&(h.persistenceManager=yield be.create(h,s),!h._deleted)){if(null!==(m=h._popupRedirectResolver)&&void 0!==m&&m._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(a),h.lastNotifiedUid=(null===(y=h.currentUser)||void 0===y?void 0:y.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var s=this;return(0,v.A)(function*(){if(s._deleted)return;const a=yield s.assertedPersistence.getCurrentUser();if(s.currentUser||a){if(s.currentUser&&a&&s.currentUser.uid===a.uid)return s._currentUser._assign(a),void(yield s.currentUser.getIdToken());yield s._updateCurrentUser(a,!0)}})()}initializeCurrentUserFromIdToken(s){var a=this;return(0,v.A)(function*(){try{const h=yield yn(a,{idToken:s}),m=yield ce._fromGetAccountInfoResponse(a,h,s);yield a.directlySetCurrentUser(m)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),yield a.directlySetCurrentUser(null)}})()}initializeCurrentUser(s){var a=this;return(0,v.A)(function*(){var h;if((0,pe._isFirebaseServerApp)(a.app)){const O=a.app.settings.authIdToken;return O?new Promise(z=>{setTimeout(()=>a.initializeCurrentUserFromIdToken(O).then(z,z))}):a.directlySetCurrentUser(null)}const m=yield a.assertedPersistence.getCurrentUser();let y=m,w=!1;if(s&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const O=null===(h=a.redirectUser)||void 0===h?void 0:h._redirectEventId,z=y?._redirectEventId,oe=yield a.tryRedirectSignIn(s);(!O||O===z)&&oe?.user&&(y=oe.user,w=!0)}if(!y)return a.directlySetCurrentUser(null);if(!y._redirectEventId){if(w)try{yield a.beforeStateQueue.runMiddleware(y)}catch(O){y=m,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(O))}return y?a.reloadAndSetCurrentUserOrClear(y):a.directlySetCurrentUser(null)}return ne(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===y._redirectEventId?a.directlySetCurrentUser(y):a.reloadAndSetCurrentUserOrClear(y)})()}tryRedirectSignIn(s){var a=this;return(0,v.A)(function*(){let h=null;try{h=yield a._popupRedirectResolver._completeRedirectFn(a,s,!0)}catch{yield a._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(s){var a=this;return(0,v.A)(function*(){try{yield $n(s)}catch(h){if("auth/network-request-failed"!==h?.code)return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(s)})()}useDeviceLanguage(){this.languageCode=function lo(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var s=this;return(0,v.A)(function*(){s._deleted=!0})()}updateCurrentUser(s){var a=this;return(0,v.A)(function*(){if((0,pe._isFirebaseServerApp)(a.app))return Promise.reject(Te(a));const h=s?(0,Y.Ku)(s):null;return h&&ne(h.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(h&&h._clone(a))})()}_updateCurrentUser(s,a=!1){var h=this;return(0,v.A)(function*(){if(!h._deleted)return s&&ne(h.tenantId===s.tenantId,h,"tenant-id-mismatch"),a||(yield h.beforeStateQueue.runMiddleware(s)),h.queue((0,v.A)(function*(){yield h.directlySetCurrentUser(s),h.notifyAuthListeners()}))})()}signOut(){var s=this;return(0,v.A)(function*(){return(0,pe._isFirebaseServerApp)(s.app)?Promise.reject(Te(s)):(yield s.beforeStateQueue.runMiddleware(null),(s.redirectPersistenceManager||s._popupRedirectResolver)&&(yield s._setRedirectUser(null)),s._updateCurrentUser(null,!0))})()}setPersistence(s){var a=this;return(0,pe._isFirebaseServerApp)(this.app)?Promise.reject(Te(this)):this.queue((0,v.A)(function*(){yield a.assertedPersistence.setPersistence(xe(s))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(s){var a=this;return(0,v.A)(function*(){a._getPasswordPolicyInternal()||(yield a._updatePasswordPolicy());const h=a._getPasswordPolicyInternal();return h.schemaVersion!==a.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(a._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(s)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var s=this;return(0,v.A)(function*(){const a=yield function N(l){return $.apply(this,arguments)}(s),h=new $t(a);null===s.tenantId?s._projectPasswordPolicy=h:s._tenantPasswordPolicies[s.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(s){this._errorFactory=new Y.FA("auth","Firebase",s())}onAuthStateChanged(s,a,h){return this.registerStateListener(this.authStateSubscription,s,a,h)}beforeAuthStateChanged(s,a){return this.beforeStateQueue.pushCallback(s,a)}onIdTokenChanged(s,a,h){return this.registerStateListener(this.idTokenSubscription,s,a,h)}authStateReady(){return new Promise((s,a)=>{if(this.currentUser)s();else{const h=this.onAuthStateChanged(()=>{h(),s()},a)}})}revokeAccessToken(s){var a=this;return(0,v.A)(function*(){if(a.currentUser){const h=yield a.currentUser.getIdToken(),m={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:s,idToken:h};null!=a.tenantId&&(m.tenantId=a.tenantId),yield function R(l,s){return x.apply(this,arguments)}(a,m)}})()}toJSON(){var s;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(s=this._currentUser)||void 0===s?void 0:s.toJSON()}}_setRedirectUser(s,a){var h=this;return(0,v.A)(function*(){const m=yield h.getOrInitRedirectPersistenceManager(a);return null===s?m.removeCurrentUser():m.setCurrentUser(s)})()}getOrInitRedirectPersistenceManager(s){var a=this;return(0,v.A)(function*(){if(!a.redirectPersistenceManager){const h=s&&xe(s)||a._popupRedirectResolver;ne(h,a,"argument-error"),a.redirectPersistenceManager=yield be.create(a,[xe(h._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(s){var a=this;return(0,v.A)(function*(){var h,m;return a._isInitialized&&(yield a.queue((0,v.A)(function*(){}))),(null===(h=a._currentUser)||void 0===h?void 0:h._redirectEventId)===s?a._currentUser:(null===(m=a.redirectUser)||void 0===m?void 0:m._redirectEventId)===s?a.redirectUser:null})()}_persistUserIfCurrent(s){var a=this;return(0,v.A)(function*(){if(s===a.currentUser)return a.queue((0,v.A)(function*(){return a.directlySetCurrentUser(s)}))})()}_notifyListenersIfCurrent(s){s===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var s,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(a=null===(s=this.currentUser)||void 0===s?void 0:s.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(s,a,h,m){if(this._deleted)return()=>{};const y="function"==typeof a?a:a.next.bind(a);let w=!1;const O=this._isInitialized?Promise.resolve():this._initializationPromise;if(ne(O,this,"internal-error"),O.then(()=>{w||y(this.currentUser)}),"function"==typeof a){const z=s.addObserver(a,h,m);return()=>{w=!0,z()}}{const z=s.addObserver(a);return()=>{w=!0,z()}}}directlySetCurrentUser(s){var a=this;return(0,v.A)(function*(){a.currentUser&&a.currentUser!==s&&a._currentUser._stopProactiveRefresh(),s&&a.isProactiveRefreshEnabled&&s._startProactiveRefresh(),a.currentUser=s,s?yield a.assertedPersistence.setCurrentUser(s):yield a.assertedPersistence.removeCurrentUser()})()}queue(s){return this.operations=this.operations.then(s,s),this.operations}get assertedPersistence(){return ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(s){!s||this.frameworks.includes(s)||(this.frameworks.push(s),this.frameworks.sort(),this.clientVersion=Ee(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var s=this;return(0,v.A)(function*(){var a;const h={"X-Client-Version":s.clientVersion};s.app.options.appId&&(h["X-Firebase-gmpid"]=s.app.options.appId);const m=yield null===(a=s.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();m&&(h["X-Firebase-Client"]=m);const y=yield s._getAppCheckToken();return y&&(h["X-Firebase-AppCheck"]=y),h})()}_getAppCheckToken(){var s=this;return(0,v.A)(function*(){var a;const h=yield null===(a=s.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getToken();return h?.error&&function zt(l,...s){Mt.logLevel<=tn.$b.WARN&&Mt.warn(`Auth (${pe.SDK_VERSION}): ${l}`,...s)}(`Error while retrieving App Check token: ${h.error}`),h?.token})()}}function Qe(l){return(0,Y.Ku)(l)}class Cc{constructor(s){this.auth=s,this.observer=null,this.addObserver=(0,Y.tD)(a=>this.observer=a)}get next(){return ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ls={loadJS:()=>(0,v.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function mo(l){return ls.loadJS(l)}function qa(l){return`__${l}${Math.floor(1e6*Math.random())}`}class Ka{constructor(s){this.type="recaptcha-enterprise",this.auth=Qe(s)}verify(s="verify",a=!1){var h=this;return(0,v.A)(function*(){function y(){return y=(0,v.A)(function*(O){if(!a){if(null==O.tenantId&&null!=O._agentRecaptchaConfig)return O._agentRecaptchaConfig.siteKey;if(null!=O.tenantId&&void 0!==O._tenantRecaptchaConfigs[O.tenantId])return O._tenantRecaptchaConfigs[O.tenantId].siteKey}return new Promise(function(){var z=(0,v.A)(function*(oe,he){dr(O,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(le=>{if(void 0!==le.recaptchaKey){const Ye=new St(le);return null==O.tenantId?O._agentRecaptchaConfig=Ye:O._tenantRecaptchaConfigs[O.tenantId]=Ye,oe(Ye.siteKey)}he(new Error("recaptcha Enterprise site key undefined"))}).catch(le=>{he(le)})});return function(oe,he){return z.apply(this,arguments)}}())}),y.apply(this,arguments)}function w(O,z,oe){const he=window.grecaptcha;gn(he)?he.enterprise.ready(()=>{he.enterprise.execute(O,{action:s}).then(le=>{z(le)}).catch(()=>{z("NO_RECAPTCHA")})}):oe(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((O,z)=>{(function m(O){return y.apply(this,arguments)})(h.auth).then(oe=>{if(!a&&gn(window.grecaptcha))w(oe,O,z);else{if(typeof window>"u")return void z(new Error("RecaptchaVerifier is only supported in browser"));let he=function Fp(){return ls.recaptchaEnterpriseScript}();0!==he.length&&(he+=oe),mo(he).then(()=>{w(oe,O,z)}).catch(le=>{z(le)})}}).catch(oe=>{z(oe)})})})()}}function nt(l,s,a){return me.apply(this,arguments)}function me(){return(me=(0,v.A)(function*(l,s,a,h=!1){const m=new Ka(l);let y;try{y=yield m.verify(a)}catch{y=yield m.verify(a,!0)}const w=Object.assign({},s);return Object.assign(w,h?{captchaResp:y}:{captchaResponse:y}),Object.assign(w,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(w,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),w})).apply(this,arguments)}function Qn(l,s,a,h){return De.apply(this,arguments)}function De(){return De=(0,v.A)(function*(l,s,a,h){var m;if(null!==(m=l._getRecaptchaConfig())&&void 0!==m&&m.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const y=yield nt(l,s,a,"getOobCode"===a);return h(l,y)}return h(l,s).catch(function(){var y=(0,v.A)(function*(w){if("auth/missing-recaptcha-token"===w.code){console.log(`${a} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const O=yield nt(l,s,a,"getOobCode"===a);return h(l,O)}return Promise.reject(w)});return function(w){return y.apply(this,arguments)}}())}),De.apply(this,arguments)}function gr(l){const s=l.indexOf(":");return s<0?"":l.substr(0,s+1)}function _r(l){if(!l)return null;const s=Number(l);return isNaN(s)?null:s}class Rn{constructor(s,a){this.providerId=s,this.signInMethod=a}toJSON(){return Et("not implemented")}_getIdTokenResponse(s){return Et("not implemented")}_linkToIdToken(s,a){return Et("not implemented")}_getReauthenticationResolver(s){return Et("not implemented")}}function ja(l,s){return _o.apply(this,arguments)}function _o(){return(_o=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:resetPassword",Be(l,s))})).apply(this,arguments)}function hs(){return(hs=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function xc(l,s){return yo.apply(this,arguments)}function yo(){return(yo=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:signUp",s)})).apply(this,arguments)}function ds(){return(ds=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:update",Be(l,s))})).apply(this,arguments)}function F(l,s){return bi.apply(this,arguments)}function bi(){return(bi=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithPassword",Be(l,s))})).apply(this,arguments)}function un(l,s){return Io.apply(this,arguments)}function Io(){return(Io=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:sendOobCode",Be(l,s))})).apply(this,arguments)}function Ur(){return(Ur=(0,v.A)(function*(l,s){return un(l,s)})).apply(this,arguments)}function Ir(l,s){return za.apply(this,arguments)}function za(){return(za=(0,v.A)(function*(l,s){return un(l,s)})).apply(this,arguments)}function Br(l,s){return vo.apply(this,arguments)}function vo(){return(vo=(0,v.A)(function*(l,s){return un(l,s)})).apply(this,arguments)}function Wa(){return(Wa=(0,v.A)(function*(l,s){return un(l,s)})).apply(this,arguments)}function Bt(){return(Bt=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithEmailLink",Be(l,s))})).apply(this,arguments)}function qr(){return(qr=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithEmailLink",Be(l,s))})).apply(this,arguments)}class Ci extends Rn{constructor(s,a,h,m=null){super("password",h),this._email=s,this._password=a,this._tenantId=m}static _fromEmailAndPassword(s,a){return new Ci(s,a,"password")}static _fromEmailAndCode(s,a,h=null){return new Ci(s,a,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s;if(a?.email&&a?.password){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(s){var a=this;return(0,v.A)(function*(){switch(a.signInMethod){case"password":return Qn(s,{returnSecureToken:!0,email:a._email,password:a._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",F);case"emailLink":return function zh(l,s){return Bt.apply(this,arguments)}(s,{email:a._email,oobCode:a._password});default:Ze(s,"internal-error")}})()}_linkToIdToken(s,a){var h=this;return(0,v.A)(function*(){switch(h.signInMethod){case"password":return Qn(s,{idToken:a,returnSecureToken:!0,email:h._email,password:h._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xc);case"emailLink":return function fs(l,s){return qr.apply(this,arguments)}(s,{idToken:a,email:h._email,oobCode:h._password});default:Ze(s,"internal-error")}})()}_getReauthenticationResolver(s){return this._getIdTokenResponse(s)}}function ot(l,s){return $a.apply(this,arguments)}function $a(){return($a=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithIdp",Be(l,s))})).apply(this,arguments)}class Tt extends Rn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(s){const a=new Tt(s.providerId,s.signInMethod);return s.idToken||s.accessToken?(s.idToken&&(a.idToken=s.idToken),s.accessToken&&(a.accessToken=s.accessToken),s.nonce&&!s.pendingToken&&(a.nonce=s.nonce),s.pendingToken&&(a.pendingToken=s.pendingToken)):s.oauthToken&&s.oauthTokenSecret?(a.accessToken=s.oauthToken,a.secret=s.oauthTokenSecret):Ze("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:h,signInMethod:m}=a,y=(0,Lt.Tt)(a,["providerId","signInMethod"]);if(!h||!m)return null;const w=new Tt(h,m);return w.idToken=y.idToken||void 0,w.accessToken=y.accessToken||void 0,w.secret=y.secret,w.nonce=y.nonce,w.pendingToken=y.pendingToken||null,w}_getIdTokenResponse(s){return ot(s,this.buildRequest())}_linkToIdToken(s,a){const h=this.buildRequest();return h.idToken=a,ot(s,h)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,ot(s,a)}buildRequest(){const s={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)s.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),s.postBody=(0,Y.Am)(a)}return s}}function xi(){return(xi=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:sendVerificationCode",Be(l,s))})).apply(this,arguments)}function Ha(){return(Ha=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithPhoneNumber",Be(l,s))})).apply(this,arguments)}function Qa(){return(Qa=(0,v.A)(function*(l,s){const a=yield nn(l,"POST","/v1/accounts:signInWithPhoneNumber",Be(l,s));if(a.temporaryProof)throw rn(l,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Wh={USER_NOT_FOUND:"user-not-found"};function Ja(){return(Ja=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithPhoneNumber",Be(l,Object.assign(Object.assign({},s),{operation:"REAUTH"})),Wh)})).apply(this,arguments)}class Kr extends Rn{constructor(s){super("phone","phone"),this.params=s}static _fromVerification(s,a){return new Kr({verificationId:s,verificationCode:a})}static _fromTokenResponse(s,a){return new Kr({phoneNumber:s,temporaryProof:a})}_getIdTokenResponse(s){return function Nc(l,s){return Ha.apply(this,arguments)}(s,this._makeVerificationRequest())}_linkToIdToken(s,a){return function Gh(l,s){return Qa.apply(this,arguments)}(s,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(s){return function $h(l,s){return Ja.apply(this,arguments)}(s,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:s,phoneNumber:a,verificationId:h,verificationCode:m}=this.params;return s&&a?{temporaryProof:s,phoneNumber:a}:{sessionInfo:h,code:m}}toJSON(){const s={providerId:this.providerId};return this.params.phoneNumber&&(s.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(s.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(s.verificationCode=this.params.verificationCode),this.params.verificationId&&(s.verificationId=this.params.verificationId),s}static fromJSON(s){"string"==typeof s&&(s=JSON.parse(s));const{verificationId:a,verificationCode:h,phoneNumber:m,temporaryProof:y}=s;return h||a||m||y?new Kr({verificationId:a,verificationCode:h,phoneNumber:m,temporaryProof:y}):null}}class ps{constructor(s){var a,h,m,y,w,O;const z=(0,Y.I9)((0,Y.hp)(s)),oe=null!==(a=z.apiKey)&&void 0!==a?a:null,he=null!==(h=z.oobCode)&&void 0!==h?h:null,le=function Hh(l){switch(l){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(m=z.mode)&&void 0!==m?m:null);ne(oe&&he&&le,"argument-error"),this.apiKey=oe,this.operation=le,this.code=he,this.continueUrl=null!==(y=z.continueUrl)&&void 0!==y?y:null,this.languageCode=null!==(w=z.languageCode)&&void 0!==w?w:null,this.tenantId=null!==(O=z.tenantId)&&void 0!==O?O:null}static parseLink(s){const a=function Qh(l){const s=(0,Y.I9)((0,Y.hp)(l)).link,a=s?(0,Y.I9)((0,Y.hp)(s)).deep_link_id:null,h=(0,Y.I9)((0,Y.hp)(l)).deep_link_id;return(h?(0,Y.I9)((0,Y.hp)(h)).link:null)||h||a||s||l}(s);try{return new ps(a)}catch{return null}}}let Ya=(()=>{class l{constructor(){this.providerId=l.PROVIDER_ID}static credential(a,h){return Ci._fromEmailAndPassword(a,h)}static credentialWithLink(a,h){const m=ps.parseLink(h);return ne(m,"argument-error"),Ci._fromEmailAndCode(a,m.code,m.tenantId)}}return l.PROVIDER_ID="password",l.EMAIL_PASSWORD_SIGN_IN_METHOD="password",l.EMAIL_LINK_SIGN_IN_METHOD="emailLink",l})();class Jn{constructor(s){this.providerId=s,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(s){this.defaultLanguageCode=s}setCustomParameters(s){return this.customParameters=s,this}getCustomParameters(){return this.customParameters}}class Di extends Jn{constructor(){super(...arguments),this.scopes=[]}addScope(s){return this.scopes.includes(s)||this.scopes.push(s),this}getScopes(){return[...this.scopes]}}class Vi extends Di{static credentialFromJSON(s){const a="string"==typeof s?JSON.parse(s):s;return ne("providerId"in a&&"signInMethod"in a,"argument-error"),Tt._fromParams(a)}credential(s){return this._credential(Object.assign(Object.assign({},s),{nonce:s.rawNonce}))}_credential(s){return ne(s.idToken||s.accessToken,"argument-error"),Tt._fromParams(Object.assign(Object.assign({},s),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(s){return Vi.oauthCredentialFromTaggedObject(s)}static credentialFromError(s){return Vi.oauthCredentialFromTaggedObject(s.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{oauthIdToken:a,oauthAccessToken:h,oauthTokenSecret:m,pendingToken:y,nonce:w,providerId:O}=s;if(!h&&!m&&!a&&!y||!O)return null;try{return new Vi(O)._credential({idToken:a,accessToken:h,nonce:w,pendingToken:y})}catch{return null}}}let Xa=(()=>{class l extends Di{constructor(){super("facebook.com")}static credential(a){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.FACEBOOK_SIGN_IN_METHOD="facebook.com",l.PROVIDER_ID="facebook.com",l})(),kc=(()=>{class l extends Di{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:m}=a;if(!h&&!m)return null;try{return l.credential(h,m)}catch{return null}}}return l.GOOGLE_SIGN_IN_METHOD="google.com",l.PROVIDER_ID="google.com",l})(),Za=(()=>{class l extends Di{constructor(){super("github.com")}static credential(a){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return l.credential(a.oauthAccessToken)}catch{return null}}}return l.GITHUB_SIGN_IN_METHOD="github.com",l.PROVIDER_ID="github.com",l})();class vr extends Rn{constructor(s,a){super(s,s),this.pendingToken=a}_getIdTokenResponse(s){return ot(s,this.buildRequest())}_linkToIdToken(s,a){const h=this.buildRequest();return h.idToken=a,ot(s,h)}_getReauthenticationResolver(s){const a=this.buildRequest();return a.autoCreate=!1,ot(s,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(s){const a="string"==typeof s?JSON.parse(s):s,{providerId:h,signInMethod:m,pendingToken:y}=a;return h&&m&&y&&h===m?new vr(h,y):null}static _create(s,a){return new vr(s,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Eo extends Jn{constructor(s){ne(s.startsWith("saml."),"argument-error"),super(s)}static credentialFromResult(s){return Eo.samlCredentialFromTaggedObject(s)}static credentialFromError(s){return Eo.samlCredentialFromTaggedObject(s.customData||{})}static credentialFromJSON(s){const a=vr.fromJSON(s);return ne(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:s}){if(!s)return null;const{pendingToken:a,providerId:h}=s;if(!a||!h)return null;try{return vr._create(h,a)}catch{return null}}}let Ao=(()=>{class l extends Di{constructor(){super("twitter.com")}static credential(a,h){return Tt._fromParams({providerId:l.PROVIDER_ID,signInMethod:l.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:h,oauthTokenSecret:m}=a;if(!h||!m)return null;try{return l.credential(h,m)}catch{return null}}}return l.TWITTER_SIGN_IN_METHOD="twitter.com",l.PROVIDER_ID="twitter.com",l})();function yt(l,s){return To.apply(this,arguments)}function To(){return(To=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signUp",Be(l,s))})).apply(this,arguments)}class wt{constructor(s){this.user=s.user,this.providerId=s.providerId,this._tokenResponse=s._tokenResponse,this.operationType=s.operationType}static _fromIdTokenResponse(s,a,h,m=!1){return(0,v.A)(function*(){const y=yield ce._fromIdTokenResponse(s,h,m),w=eu(h);return new wt({user:y,providerId:w,_tokenResponse:h,operationType:a})})()}static _forOperation(s,a,h){return(0,v.A)(function*(){yield s._updateTokensIfNecessary(h,!0);const m=eu(h);return new wt({user:s,providerId:m,_tokenResponse:h,operationType:a})})()}}function eu(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}function We(){return(We=(0,v.A)(function*(l){var s;if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const a=Qe(l);if(yield a._initializationPromise,null!==(s=a.currentUser)&&void 0!==s&&s.isAnonymous)return new wt({user:a.currentUser,providerId:null,operationType:"signIn"});const h=yield yt(a,{returnSecureToken:!0}),m=yield wt._fromIdTokenResponse(a,"signIn",h,!0);return yield a._updateCurrentUser(m.user),m})).apply(this,arguments)}class jr extends Y.g{constructor(s,a,h,m){var y;super(a.code,a.message),this.operationType=h,this.user=m,Object.setPrototypeOf(this,jr.prototype),this.customData={appName:s.name,tenantId:null!==(y=s.tenantId)&&void 0!==y?y:void 0,_serverResponse:a.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(s,a,h,m){return new jr(s,a,h,m)}}function Pt(l,s,a,h){return("reauthenticate"===s?a._getReauthenticationResolver(l):a._getIdTokenResponse(l)).catch(y=>{throw"auth/multi-factor-auth-required"===y.code?jr._fromErrorAndOperation(l,y,s,h):y})}function ze(l){return new Set(l.map(({providerId:s})=>s).filter(s=>!!s))}function Er(){return Er=(0,v.A)(function*(l,s){const a=(0,Y.Ku)(l);yield Ro(!0,a,s);const{providerUserInfo:h}=yield function Lr(l,s){return sn.apply(this,arguments)}(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[s]}),m=ze(h||[]);return a.providerData=a.providerData.filter(y=>m.has(y.providerId)),m.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a}),Er.apply(this,arguments)}function kt(l,s){return wo.apply(this,arguments)}function wo(){return(wo=(0,v.A)(function*(l,s,a=!1){const h=yield Wt(l,s._linkToIdToken(l.auth,yield l.getIdToken()),a);return wt._forOperation(l,"link",h)})).apply(this,arguments)}function Ro(l,s,a){return at.apply(this,arguments)}function at(){return(at=(0,v.A)(function*(l,s,a){yield $n(s);const m=!1===l?"provider-already-linked":"no-such-provider";ne(ze(s.providerData).has(a)===l,s.auth,m)})).apply(this,arguments)}function Fc(l,s){return Sn.apply(this,arguments)}function Sn(){return(Sn=(0,v.A)(function*(l,s,a=!1){const{auth:h}=l;if((0,pe._isFirebaseServerApp)(h.app))return Promise.reject(Te(h));const m="reauthenticate";try{const y=yield Wt(l,Pt(h,m,s,l),a);ne(y.idToken,h,"internal-error");const w=Nn(y.idToken);ne(w,h,"internal-error");const{sub:O}=w;return ne(l.uid===O,h,"user-mismatch"),wt._forOperation(l,m,y)}catch(y){throw"auth/user-not-found"===y?.code&&Ze(h,"user-mismatch"),y}})).apply(this,arguments)}function rt(l,s){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,v.A)(function*(l,s,a=!1){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h="signIn",m=yield Pt(l,h,s),y=yield wt._fromIdTokenResponse(l,h,m);return a||(yield l._updateCurrentUser(y.user)),y})).apply(this,arguments)}function zr(l,s){return Ni.apply(this,arguments)}function Ni(){return(Ni=(0,v.A)(function*(l,s){return rt(Qe(l),s)})).apply(this,arguments)}function ki(l,s){return tu.apply(this,arguments)}function tu(){return(tu=(0,v.A)(function*(l,s){const a=(0,Y.Ku)(l);return yield Ro(!1,a,s.providerId),kt(a,s)})).apply(this,arguments)}function Yn(l,s){return On.apply(this,arguments)}function On(){return(On=(0,v.A)(function*(l,s){return Fc((0,Y.Ku)(l),s)})).apply(this,arguments)}function Ln(){return(Ln=(0,v.A)(function*(l,s){return nn(l,"POST","/v1/accounts:signInWithCustomToken",Be(l,s))})).apply(this,arguments)}function Gr(){return Gr=(0,v.A)(function*(l,s){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const a=Qe(l),h=yield function So(l,s){return Ln.apply(this,arguments)}(a,{token:s,returnSecureToken:!0}),m=yield wt._fromIdTokenResponse(a,"signIn",h);return yield a._updateCurrentUser(m.user),m}),Gr.apply(this,arguments)}class En{constructor(s,a){this.factorId=s,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(s,a){return"phoneInfo"in a?Po._fromServerResponse(s,a):"totpInfo"in a?bo._fromServerResponse(s,a):Ze(s,"internal-error")}}class Po extends En{constructor(s){super("phone",s),this.phoneNumber=s.phoneInfo}static _fromServerResponse(s,a){return new Po(a)}}class bo extends En{constructor(s){super("totp",s)}static _fromServerResponse(s,a){return new bo(a)}}function Xn(l,s,a){var h;ne((null===(h=a.url)||void 0===h?void 0:h.length)>0,l,"invalid-continue-uri"),ne(typeof a.dynamicLinkDomain>"u"||a.dynamicLinkDomain.length>0,l,"invalid-dynamic-link-domain"),s.continueUrl=a.url,s.dynamicLinkDomain=a.dynamicLinkDomain,s.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(ne(a.iOS.bundleId.length>0,l,"missing-ios-bundle-id"),s.iOSBundleId=a.iOS.bundleId),a.android&&(ne(a.android.packageName.length>0,l,"missing-android-pkg-name"),s.androidInstallApp=a.android.installApp,s.androidMinimumVersionCode=a.android.minimumVersion,s.androidPackageName=a.android.packageName)}function ms(l){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,v.A)(function*(l){const s=Qe(l);s._getPasswordPolicyInternal()&&(yield s._updatePasswordPolicy())})).apply(this,arguments)}function gs(){return(gs=(0,v.A)(function*(l,s,a){const h=Qe(l),m={requestType:"PASSWORD_RESET",email:s,clientType:"CLIENT_TYPE_WEB"};a&&Xn(h,m,a),yield Qn(h,m,"getOobCode",Ir)})).apply(this,arguments)}function Co(){return Co=(0,v.A)(function*(l,s,a){yield ja((0,Y.Ku)(l),{oobCode:s,newPassword:a}).catch(function(){var h=(0,v.A)(function*(m){throw"auth/password-does-not-meet-requirements"===m.code&&ms(l),m});return function(m){return h.apply(this,arguments)}}())}),Co.apply(this,arguments)}function Li(){return Li=(0,v.A)(function*(l,s){yield function yr(l,s){return ds.apply(this,arguments)}((0,Y.Ku)(l),{oobCode:s})}),Li.apply(this,arguments)}function ys(l,s){return $r.apply(this,arguments)}function $r(){return($r=(0,v.A)(function*(l,s){const a=(0,Y.Ku)(l),h=yield ja(a,{oobCode:s}),m=h.requestType;switch(ne(m,a,"internal-error"),m){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ne(h.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ne(h.mfaInfo,a,"internal-error");default:ne(h.email,a,"internal-error")}let y=null;return h.mfaInfo&&(y=En._fromServerResponse(Qe(a),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:y},operation:m}})).apply(this,arguments)}function xo(){return(xo=(0,v.A)(function*(l,s){const{data:a}=yield ys((0,Y.Ku)(l),s);return a.email})).apply(this,arguments)}function nu(){return(nu=(0,v.A)(function*(l,s,a){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h=Qe(l),w=yield Qn(h,{returnSecureToken:!0,email:s,password:a,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",yt).catch(z=>{throw"auth/password-does-not-meet-requirements"===z.code&&ms(l),z}),O=yield wt._fromIdTokenResponse(h,"signIn",w);return yield h._updateCurrentUser(O.user),O})).apply(this,arguments)}function Rt(){return(Rt=(0,v.A)(function*(l,s,a){const h=Qe(l),m={requestType:"EMAIL_SIGNIN",email:s,clientType:"CLIENT_TYPE_WEB"};(function y(w,O){ne(O.handleCodeInApp,h,"argument-error"),O&&Xn(h,w,O)})(m,a),yield Qn(h,m,"getOobCode",Br)})).apply(this,arguments)}function Fn(){return(Fn=(0,v.A)(function*(l,s,a){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h=(0,Y.Ku)(l),m=Ya.credentialWithLink(s,a||mn());return ne(m._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),zr(h,m)})).apply(this,arguments)}function Do(){return(Do=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:createAuthUri",Be(l,s))})).apply(this,arguments)}function ru(){return ru=(0,v.A)(function*(l,s){const h={identifier:s,continueUri:ar()?mn():"http://localhost"},{signinMethods:m}=yield function zc(l,s){return Do.apply(this,arguments)}((0,Y.Ku)(l),h);return m||[]}),ru.apply(this,arguments)}function Ve(){return Ve=(0,v.A)(function*(l,s){const a=(0,Y.Ku)(l),m={requestType:"VERIFY_EMAIL",idToken:yield l.getIdToken()};s&&Xn(a.auth,m,s);const{email:y}=yield function jh(l,s){return Ur.apply(this,arguments)}(a.auth,m);y!==l.email&&(yield l.reload())}),Ve.apply(this,arguments)}function Ar(){return Ar=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l),y={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield l.getIdToken(),newEmail:s};a&&Xn(h.auth,y,a);const{email:w}=yield function Ga(l,s){return Wa.apply(this,arguments)}(h.auth,y);w!==l.email&&(yield l.reload())}),Ar.apply(this,arguments)}function vs(){return(vs=(0,v.A)(function*(l,s){return je(l,"POST","/v1/accounts:update",s)})).apply(this,arguments)}function Es(){return Es=(0,v.A)(function*(l,{displayName:s,photoURL:a}){if(void 0===s&&void 0===a)return;const h=(0,Y.Ku)(l),y={idToken:yield h.getIdToken(),displayName:s,photoUrl:a,returnSecureToken:!0},w=yield Wt(h,function iu(l,s){return vs.apply(this,arguments)}(h.auth,y));h.displayName=w.displayName||null,h.photoURL=w.photoUrl||null;const O=h.providerData.find(({providerId:z})=>"password"===z);O&&(O.displayName=h.displayName,O.photoURL=h.photoURL),yield h._updateTokensIfNecessary(w)}),Es.apply(this,arguments)}function su(l,s,a){return ou.apply(this,arguments)}function ou(){return ou=(0,v.A)(function*(l,s,a){const{auth:h}=l,y={idToken:yield l.getIdToken(),returnSecureToken:!0};s&&(y.email=s),a&&(y.password=a);const w=yield Wt(l,function an(l,s){return hs.apply(this,arguments)}(h,y));yield l._updateTokensIfNecessary(w,!0)}),ou.apply(this,arguments)}class Mi{constructor(s,a,h={}){this.isNewUser=s,this.providerId=a,this.profile=h}}class au extends Mi{constructor(s,a,h,m){super(s,a,h),this.username=m}}class Zh extends Mi{constructor(s,a){super(s,"facebook.com",a)}}class Qc extends au{constructor(s,a){super(s,"github.com",a,"string"==typeof a?.login?a?.login:null)}}class ed extends Mi{constructor(s,a){super(s,"google.com",a)}}class td extends au{constructor(s,a,h){super(s,"twitter.com",a,h)}}function nd(l){const{user:s,_tokenResponse:a}=l;return s.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function Xh(l){var s,a;if(!l)return null;const{providerId:h}=l,m=l.rawUserInfo?JSON.parse(l.rawUserInfo):{},y=l.isNewUser||"identitytoolkit#SignupNewUserResponse"===l.kind;if(!h&&l?.idToken){const w=null===(a=null===(s=Nn(l.idToken))||void 0===s?void 0:s.firebase)||void 0===a?void 0:a.sign_in_provider;if(w)return new Mi(y,"anonymous"!==w&&"custom"!==w?w:null)}if(!h)return null;switch(h){case"facebook.com":return new Zh(y,m);case"github.com":return new Qc(y,m);case"google.com":return new ed(y,m);case"twitter.com":return new td(y,m,l.screenName||null);case"custom":case"anonymous":return new Mi(y,null);default:return new Mi(y,h,m)}}(a)}class pt{constructor(s,a,h){this.type=s,this.credential=a,this.user=h}static _fromIdtoken(s,a){return new pt("enroll",s,a)}static _fromMfaPendingCredential(s){return new pt("signin",s)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(s){var a,h;if(s?.multiFactorSession){if(null!==(a=s.multiFactorSession)&&void 0!==a&&a.pendingCredential)return pt._fromMfaPendingCredential(s.multiFactorSession.pendingCredential);if(null!==(h=s.multiFactorSession)&&void 0!==h&&h.idToken)return pt._fromIdtoken(s.multiFactorSession.idToken)}return null}}class ko{constructor(s,a,h){this.session=s,this.hints=a,this.signInResolver=h}static _fromError(s,a){const h=Qe(s),m=a.customData._serverResponse,y=(m.mfaInfo||[]).map(O=>En._fromServerResponse(h,O));ne(m.mfaPendingCredential,h,"internal-error");const w=pt._fromMfaPendingCredential(m.mfaPendingCredential);return new ko(w,y,function(){var O=(0,v.A)(function*(z){const oe=yield z._process(h,w);delete m.mfaInfo,delete m.mfaPendingCredential;const he=Object.assign(Object.assign({},m),{idToken:oe.idToken,refreshToken:oe.refreshToken});switch(a.operationType){case"signIn":const le=yield wt._fromIdTokenResponse(h,a.operationType,he);return yield h._updateCurrentUser(le.user),le;case"reauthenticate":return ne(a.user,h,"internal-error"),wt._forOperation(a.user,a.operationType,he);default:Ze(h,"internal-error")}});return function(z){return O.apply(this,arguments)}}())}resolveSignIn(s){var a=this;return(0,v.A)(function*(){return a.signInResolver(s)})()}}class Hr{constructor(s){this.user=s,this.enrolledFactors=[],s._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(h=>En._fromServerResponse(s.auth,h)))})}static _fromUser(s){return new Hr(s)}getSession(){var s=this;return(0,v.A)(function*(){return pt._fromIdtoken(yield s.user.getIdToken(),s.user)})()}enroll(s,a){var h=this;return(0,v.A)(function*(){const m=s,y=yield h.getSession(),w=yield Wt(h.user,m._process(h.user.auth,y,a));return yield h.user._updateTokensIfNecessary(w),h.user.reload()})()}unenroll(s){var a=this;return(0,v.A)(function*(){const h="string"==typeof s?s:s.uid,m=yield a.user.getIdToken();try{const y=yield Wt(a.user,function Bi(l,s){return je(l,"POST","/v2/accounts/mfaEnrollment:withdraw",Be(l,s))}(a.user.auth,{idToken:m,mfaEnrollmentId:h}));a.enrolledFactors=a.enrolledFactors.filter(({uid:w})=>w!==h),yield a.user._updateTokensIfNecessary(y),yield a.user.reload()}catch(y){throw y}})()}}const Mo=new WeakMap,Fo="__sak";class Un{constructor(s,a){this.storageRetriever=s,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Fo,"1"),this.storage.removeItem(Fo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(s,a){return this.storage.setItem(s,JSON.stringify(a)),Promise.resolve()}_get(s){const a=this.storage.getItem(s);return Promise.resolve(a?JSON.parse(a):null)}_remove(s){return this.storage.removeItem(s),Promise.resolve()}get storage(){return this.storageRetriever()}}const Rr=(()=>{class l extends Un{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=G(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const m=this.storage.getItem(h),y=this.localCache[h];m!==y&&a(h,y,m)}}onStorageEvent(a,h=!1){if(!a.key)return void this.forAllChangedKeys((O,z,oe)=>{this.notifyListeners(O,oe)});const m=a.key;h?this.detachListener():this.stopPolling();const y=()=>{const O=this.storage.getItem(m);!h&&this.localCache[m]===O||this.notifyListeners(m,O)},w=this.storage.getItem(m);!function D(){return(0,Y.lT)()&&10===document.documentMode}()||w===a.newValue||a.newValue===a.oldValue?y():setTimeout(y,10)}notifyListeners(a,h){this.localCache[a]=h;const m=this.listeners[a];if(m)for(const y of Array.from(m))y(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,m)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:m}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,h){var m=()=>super._set,y=this;return(0,v.A)(function*(){yield m().call(y,a,h),y.localCache[a]=JSON.stringify(h)})()}_get(a){var h=()=>super._get,m=this;return(0,v.A)(function*(){const y=yield h().call(m,a);return m.localCache[a]=JSON.stringify(y),y})()}_remove(a){var h=()=>super._remove,m=this;return(0,v.A)(function*(){yield h().call(m,a),delete m.localCache[a]})()}}return l.type="LOCAL",l})(),xt=(()=>{class l extends Un{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}return l.type="SESSION",l})();let Ts=(()=>{class l{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(y=>y.isListeningto(a));if(h)return h;const m=new l(a);return this.receivers.push(m),m}isListeningto(a){return this.eventTarget===a}handleEvent(a){var h=this;return(0,v.A)(function*(){const m=a,{eventId:y,eventType:w,data:O}=m.data,z=h.handlersMap[w];if(!z?.size)return;m.ports[0].postMessage({status:"ack",eventId:y,eventType:w});const oe=Array.from(z).map(function(){var le=(0,v.A)(function*(Ye){return Ye(m.origin,O)});return function(Ye){return le.apply(this,arguments)}}()),he=yield function nl(l){return Promise.all(l.map(function(){var s=(0,v.A)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(h){return{fulfilled:!1,reason:h}}});return function(a){return s.apply(this,arguments)}}()))}(oe);m.ports[0].postMessage({status:"done",eventId:y,eventType:w,response:he})})()}_subscribe(a,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return l.receivers=[],l})();function ws(l="",s=10){let a="";for(let h=0;h<s;h++)a+=Math.floor(10*Math.random());return l+a}class cd{constructor(s){this.target=s,this.handlers=new Set}removeMessageHandler(s){s.messageChannel&&(s.messageChannel.port1.removeEventListener("message",s.onMessage),s.messageChannel.port1.close()),this.handlers.delete(s)}_send(s,a,h=50){var m=this;return(0,v.A)(function*(){const y=typeof MessageChannel<"u"?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let w,O;return new Promise((z,oe)=>{const he=ws("",20);y.port1.start();const le=setTimeout(()=>{oe(new Error("unsupported_event"))},h);O={messageChannel:y,onMessage(Ye){const cn=Ye;if(cn.data.eventId===he)switch(cn.data.status){case"ack":clearTimeout(le),w=setTimeout(()=>{oe(new Error("timeout"))},3e3);break;case"done":clearTimeout(w),z(cn.data.response);break;default:clearTimeout(le),clearTimeout(w),oe(new Error("invalid_response"))}}},m.handlers.add(O),y.port1.addEventListener("message",O.onMessage),m.target.postMessage({eventType:s,eventId:he,data:a},[y.port2])}).finally(()=>{O&&m.removeMessageHandler(O)})})()}}function ge(){return window}function Rs(){return typeof ge().WorkerGlobalScope<"u"&&"function"==typeof ge().importScripts}function Uo(){return(Uo=(0,v.A)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const il="firebaseLocalStorageDb",Ss="firebaseLocalStorage",Qr="fbase_key";class bn{constructor(s){this.request=s}toPromise(){return new Promise((s,a)=>{this.request.addEventListener("success",()=>{s(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Ps(l,s){return l.transaction([Ss],s?"readwrite":"readonly").objectStore(Ss)}function qo(){const l=indexedDB.open(il,1);return new Promise((s,a)=>{l.addEventListener("error",()=>{a(l.error)}),l.addEventListener("upgradeneeded",()=>{const h=l.result;try{h.createObjectStore(Ss,{keyPath:Qr})}catch(m){a(m)}}),l.addEventListener("success",(0,v.A)(function*(){const h=l.result;h.objectStoreNames.contains(Ss)?s(h):(h.close(),yield function Jr(){const l=indexedDB.deleteDatabase(il);return new bn(l).toPromise()}(),s(yield qo()))}))})}function Yr(l,s,a){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,v.A)(function*(l,s,a){const h=Ps(l,!0).put({[Qr]:s,value:a});return new bn(h).toPromise()})).apply(this,arguments)}function Xr(){return(Xr=(0,v.A)(function*(l,s){const a=Ps(l,!1).get(s),h=yield new bn(a).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function ol(l,s){const a=Ps(l,!0).delete(s);return new bn(a).toPromise()}const Zn=(()=>{class l{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,v.A)(function*(){return a.db||(a.db=yield qo()),a.db})()}_withRetries(a){var h=this;return(0,v.A)(function*(){let m=0;for(;;)try{const y=yield h._openDb();return yield a(y)}catch(y){if(m++>3)throw y;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,v.A)(function*(){return Rs()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,v.A)(function*(){a.receiver=Ts._getInstance(function Bo(){return Rs()?self:null}()),a.receiver._subscribe("keyChanged",function(){var h=(0,v.A)(function*(m,y){return{keyProcessed:(yield a._poll()).includes(y.key)}});return function(m,y){return h.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var h=(0,v.A)(function*(m,y){return["keyChanged"]});return function(m,y){return h.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,v.A)(function*(){var h,m;if(a.activeServiceWorker=yield function cu(){return Uo.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new cd(a.activeServiceWorker);const y=yield a.sender._send("ping",{},800);y&&null!==(h=y[0])&&void 0!==h&&h.fulfilled&&null!==(m=y[0])&&void 0!==m&&m.value.includes("keyChanged")&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var h=this;return(0,v.A)(function*(){if(h.sender&&h.activeServiceWorker&&function rl(){var l;return(null===(l=navigator?.serviceWorker)||void 0===l?void 0:l.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:a},h.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,v.A)(function*(){try{if(!indexedDB)return!1;const a=yield qo();return yield Yr(a,Fo,"1"),yield ol(a,Fo),!0}catch{}return!1})()}_withPendingWrite(a){var h=this;return(0,v.A)(function*(){h.pendingWrites++;try{yield a()}finally{h.pendingWrites--}})()}_set(a,h){var m=this;return(0,v.A)(function*(){return m._withPendingWrite((0,v.A)(function*(){return yield m._withRetries(y=>Yr(y,a,h)),m.localCache[a]=h,m.notifyServiceWorker(a)}))})()}_get(a){var h=this;return(0,v.A)(function*(){const m=yield h._withRetries(y=>function sl(l,s){return Xr.apply(this,arguments)}(y,a));return h.localCache[a]=m,m})()}_remove(a){var h=this;return(0,v.A)(function*(){return h._withPendingWrite((0,v.A)(function*(){return yield h._withRetries(m=>ol(m,a)),delete h.localCache[a],h.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,v.A)(function*(){const h=yield a._withRetries(w=>{const O=Ps(w,!1).getAll();return new bn(O).toPromise()});if(!h)return[];if(0!==a.pendingWrites)return[];const m=[],y=new Set;if(0!==h.length)for(const{fbase_key:w,value:O}of h)y.add(w),JSON.stringify(a.localCache[w])!==JSON.stringify(O)&&(a.notifyListeners(w,O),m.push(w));for(const w of Object.keys(a.localCache))a.localCache[w]&&!y.has(w)&&(a.notifyListeners(w,null),m.push(w));return m})()}notifyListeners(a,h){this.localCache[a]=h;const m=this.listeners[a];if(m)for(const y of Array.from(m))y(h)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,v.A)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return l.type="LOCAL",l})(),er=1e12;class tr{constructor(s){this.auth=s,this.counter=er,this._widgets=new Map}render(s,a){const h=this.counter;return this._widgets.set(h,new cl(s,this.auth.name,a||{})),this.counter++,h}reset(s){var a;const h=s||er;null===(a=this._widgets.get(h))||void 0===a||a.delete(),this._widgets.delete(h)}getResponse(s){var a;return(null===(a=this._widgets.get(s||er))||void 0===a?void 0:a.getResponse())||""}execute(s){var a=this;return(0,v.A)(function*(){var h;return null===(h=a._widgets.get(s||er))||void 0===h||h.execute(),""})()}}class cl{constructor(s,a,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const m="string"==typeof s?document.getElementById(s):s;ne(m,"argument-error",{appName:a}),this.container=m,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function ll(l){const s=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<l;h++)s.push(a.charAt(Math.floor(62*Math.random())));return s.join("")}(50);const{callback:s,"expired-callback":a}=this.params;if(s)try{s(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const jo=qa("rcb"),qi=new Dn(3e4,6e4);class hu{constructor(){var s;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(s=ge().grecaptcha)||void 0===s||!s.render)}load(s,a=""){return ne(function du(l){return l.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(l)}(a),s,"argument-error"),this.shouldResolveImmediately(a)&&Ai(ge().grecaptcha)?Promise.resolve(ge().grecaptcha):new Promise((h,m)=>{const y=ge().setTimeout(()=>{m(Fe(s,"network-request-failed"))},qi.get());ge()[jo]=()=>{ge().clearTimeout(y),delete ge()[jo];const O=ge().grecaptcha;if(!O||!Ai(O))return void m(Fe(s,"internal-error"));const z=O.render;O.render=(oe,he)=>{const le=z(oe,he);return this.counter++,le},this.hostLanguage=a,h(O)},mo(`${function Fh(){return ls.recaptchaV2Script}()}?${(0,Y.Am)({onload:jo,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(y),m(Fe(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(s){var a;return!(null===(a=ge().grecaptcha)||void 0===a||!a.render)&&(s===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class fu{load(s){return(0,v.A)(function*(){return new tr(s)})()}clearedOneInstance(){}}const zo="recaptcha",hl={theme:"light",type:"image"};class md{constructor(s,a,h=Object.assign({},hl)){this.parameters=h,this.type=zo,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Qe(s),this.isInvisible="invisible"===this.parameters.size,ne(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const m="string"==typeof a?document.getElementById(a):a;ne(m,this.auth,"argument-error"),this.container=m,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new fu:new hu,this.validateStartingState()}verify(){var s=this;return(0,v.A)(function*(){s.assertNotDestroyed();const a=yield s.render(),h=s.getAssertedRecaptcha();return h.getResponse(a)||new Promise(y=>{const w=O=>{O&&(s.tokenChangeListeners.delete(w),y(O))};s.tokenChangeListeners.add(w),s.isInvisible&&h.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(s){return Promise.reject(s)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(s=>{throw this.renderPromise=null,s})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(s=>{this.container.removeChild(s)})}validateStartingState(){ne(!this.parameters.sitekey,this.auth,"argument-error"),ne(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ne(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(s){return a=>{if(this.tokenChangeListeners.forEach(h=>h(a)),"function"==typeof s)s(a);else if("string"==typeof s){const h=ge()[s];"function"==typeof h&&h(a)}}}assertNotDestroyed(){ne(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var s=this;return(0,v.A)(function*(){if(yield s.init(),!s.widgetId){let a=s.container;if(!s.isInvisible){const h=document.createElement("div");a.appendChild(h),a=h}s.widgetId=s.getAssertedRecaptcha().render(a,s.parameters)}return s.widgetId})()}init(){var s=this;return(0,v.A)(function*(){ne(ar()&&!Rs(),s.auth,"internal-error"),yield function It(){let l=null;return new Promise(s=>{"complete"!==document.readyState?(l=()=>s(),window.addEventListener("load",l)):s()}).catch(s=>{throw l&&window.removeEventListener("load",l),s})}(),s.recaptcha=yield s._recaptchaLoader.load(s.auth,s.auth.languageCode||void 0);const a=yield function ho(l){return hr.apply(this,arguments)}(s.auth);ne(a,s.auth,"internal-error"),s.parameters.sitekey=a})()}getAssertedRecaptcha(){return ne(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Oe{constructor(s,a){this.verificationId=s,this.onConfirmation=a}confirm(s){const a=Kr._fromVerification(this.verificationId,s);return this.onConfirmation(a)}}function Go(){return(Go=(0,v.A)(function*(l,s,a){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h=Qe(l),m=yield Cs(h,s,(0,Y.Ku)(a));return new Oe(m,y=>zr(h,y))})).apply(this,arguments)}function $o(){return($o=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);yield Ro(!1,h,"phone");const m=yield Cs(h.auth,s,(0,Y.Ku)(a));return new Oe(m,y=>ki(h,y))})).apply(this,arguments)}function Ho(){return(Ho=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);if((0,pe._isFirebaseServerApp)(h.auth.app))return Promise.reject(Te(h.auth));const m=yield Cs(h.auth,s,(0,Y.Ku)(a));return new Oe(m,y=>Yn(h,y))})).apply(this,arguments)}function Cs(l,s,a){return xs.apply(this,arguments)}function xs(){return xs=(0,v.A)(function*(l,s,a){var h;const m=yield a.verify();try{let y;if(ne("string"==typeof m,l,"argument-error"),ne(a.type===zo,l,"argument-error"),y="string"==typeof s?{phoneNumber:s}:s,"session"in y){const w=y.session;if("phoneNumber"in y)return ne("enroll"===w.type,l,"internal-error"),(yield function uu(l,s){return je(l,"POST","/v2/accounts/mfaEnrollment:start",Be(l,s))}(l,{idToken:w.credential,phoneEnrollmentInfo:{phoneNumber:y.phoneNumber,recaptchaToken:m}})).phoneSessionInfo.sessionInfo;{ne("signin"===w.type,l,"internal-error");const O=(null===(h=y.multiFactorHint)||void 0===h?void 0:h.uid)||y.multiFactorUid;return ne(O,l,"missing-multi-factor-info"),(yield function al(l,s){return je(l,"POST","/v2/accounts/mfaSignIn:start",Be(l,s))}(l,{mfaPendingCredential:w.credential,mfaEnrollmentId:O,phoneSignInInfo:{recaptchaToken:m}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:w}=yield function Vc(l,s){return xi.apply(this,arguments)}(l,{phoneNumber:y.phoneNumber,recaptchaToken:m});return w}}finally{a._reset()}}),xs.apply(this,arguments)}function Zr(){return(Zr=(0,v.A)(function*(l,s){const a=(0,Y.Ku)(l);if((0,pe._isFirebaseServerApp)(a.auth.app))return Promise.reject(Te(a.auth));yield kt(a,s)})).apply(this,arguments)}let nr=(()=>{class l{constructor(a){this.providerId=l.PROVIDER_ID,this.auth=Qe(a)}verifyPhoneNumber(a,h){return Cs(this.auth,a,(0,Y.Ku)(h))}static credential(a,h){return Kr._fromVerification(a,h)}static credentialFromResult(a){return l.credentialFromTaggedObject(a)}static credentialFromError(a){return l.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:h,temporaryProof:m}=a;return h&&m?Kr._fromTokenResponse(h,m):null}}return l.PROVIDER_ID="phone",l.PHONE_SIGN_IN_METHOD="phone",l})();function Bn(l,s){return s?xe(s):(ne(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}class Qo extends Rn{constructor(s){super("custom","custom"),this.params=s}_getIdTokenResponse(s){return ot(s,this._buildIdpRequest())}_linkToIdToken(s,a){return ot(s,this._buildIdpRequest(a))}_getReauthenticationResolver(s){return ot(s,this._buildIdpRequest())}_buildIdpRequest(s){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return s&&(a.idToken=s),a}}function fl(l){return rt(l.auth,new Qo(l),l.bypassAuthState)}function pl(l){const{auth:s,user:a}=l;return ne(a,s,"internal-error"),Fc(a,new Qo(l),l.bypassAuthState)}function _d(l){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,v.A)(function*(l){const{auth:s,user:a}=l;return ne(a,s,"internal-error"),kt(a,new Qo(l),l.bypassAuthState)})).apply(this,arguments)}class pu{constructor(s,a,h,m,y=!1){this.auth=s,this.resolver=h,this.user=m,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var s=this;return new Promise(function(){var a=(0,v.A)(function*(h,m){s.pendingPromise={resolve:h,reject:m};try{s.eventManager=yield s.resolver._initialize(s.auth),yield s.onExecution(),s.eventManager.registerConsumer(s)}catch(y){s.reject(y)}});return function(h,m){return a.apply(this,arguments)}}())}onAuthEvent(s){var a=this;return(0,v.A)(function*(){const{urlResponse:h,sessionId:m,postBody:y,tenantId:w,error:O,type:z}=s;if(O)return void a.reject(O);const oe={auth:a.auth,requestUri:h,sessionId:m,tenantId:w||void 0,postBody:y||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(z)(oe))}catch(he){a.reject(he)}})()}onError(s){this.reject(s)}getIdpTask(s){switch(s){case"signInViaPopup":case"signInViaRedirect":return fl;case"linkViaPopup":case"linkViaRedirect":return _d;case"reauthViaPopup":case"reauthViaRedirect":return pl;default:Ze(this.auth,"internal-error")}}resolve(s){At(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(s),this.unregisterAndCleanUp()}reject(s){At(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(s),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const yd=new Dn(2e3,1e4);function mu(){return(mu=(0,v.A)(function*(l,s,a){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Fe(l,"operation-not-supported-in-this-environment"));const h=Qe(l);Ue(l,s,Jn);const m=Bn(h,a);return new gu(h,"signInViaPopup",s,m).executeNotNull()})).apply(this,arguments)}function Vs(){return(Vs=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);if((0,pe._isFirebaseServerApp)(h.auth.app))return Promise.reject(Fe(h.auth,"operation-not-supported-in-this-environment"));Ue(h.auth,s,Jn);const m=Bn(h.auth,a);return new gu(h.auth,"reauthViaPopup",s,m,h).executeNotNull()})).apply(this,arguments)}function Yo(){return(Yo=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);Ue(h.auth,s,Jn);const m=Bn(h.auth,a);return new gu(h.auth,"linkViaPopup",s,m,h).executeNotNull()})).apply(this,arguments)}let gu=(()=>{class l extends pu{constructor(a,h,m,y,w){super(a,h,y,w),this.provider=m,this.authWindow=null,this.pollId=null,l.currentPopupAction&&l.currentPopupAction.cancel(),l.currentPopupAction=this}executeNotNull(){var a=this;return(0,v.A)(function*(){const h=yield a.execute();return ne(h,a.auth,"internal-error"),h})()}onExecution(){var a=this;return(0,v.A)(function*(){At(1===a.filter.length,"Popup operations only handle one event");const h=ws();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],h),a.authWindow.associatedEvent=h,a.resolver._originValidation(a.auth).catch(m=>{a.reject(m)}),a.resolver._isIframeWebStorageSupported(a.auth,m=>{m||a.reject(Fe(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Fe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,l.currentPopupAction=null}pollUserCancellation(){const a=()=>{var h,m;this.pollId=null!==(m=null===(h=this.authWindow)||void 0===h?void 0:h.window)&&void 0!==m&&m.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Fe(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(a,yd.get())};a()}}return l.currentPopupAction=null,l})();const gt="pendingRedirect",ei=new Map;class _u extends pu{constructor(s,a,h=!1){super(s,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,h),this.eventId=null}execute(){var s=()=>super.execute,a=this;return(0,v.A)(function*(){let h=ei.get(a.auth._key());if(!h){try{const y=(yield function ml(l,s){return ti.apply(this,arguments)}(a.resolver,a.auth))?yield s().call(a):null;h=()=>Promise.resolve(y)}catch(m){h=()=>Promise.reject(m)}ei.set(a.auth._key(),h)}return a.bypassAuthState||ei.set(a.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(s){var a=()=>super.onAuthEvent,h=this;return(0,v.A)(function*(){if("signInViaRedirect"===s.type)return a().call(h,s);if("unknown"!==s.type){if(s.eventId){const m=yield h.auth._redirectUserForId(s.eventId);if(m)return h.user=m,a().call(h,s);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,v.A)(function*(){})()}cleanUp(){}}function ti(){return(ti=(0,v.A)(function*(l,s){const a=Iu(s),h=yu(l);if(!(yield h._isAvailable()))return!1;const m="true"===(yield h._get(a));return yield h._remove(a),m})).apply(this,arguments)}function An(l,s){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,v.A)(function*(l,s){return yu(l)._set(Iu(s),"true")})).apply(this,arguments)}function Ns(l,s){ei.set(l._key(),s)}function yu(l){return xe(l._redirectPersistence)}function Iu(l){return _t(gt,l.config.apiKey,l.name)}function _l(l,s,a){return function Ed(l,s,a){return vu.apply(this,arguments)}(l,s,a)}function vu(){return(vu=(0,v.A)(function*(l,s,a){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h=Qe(l);Ue(l,s,Jn),yield h._initializationPromise;const m=Bn(h,a);return yield An(m,h),m._openRedirect(h,s,"signInViaRedirect")})).apply(this,arguments)}function ks(l,s,a){return function Eu(l,s,a){return Au.apply(this,arguments)}(l,s,a)}function Au(){return(Au=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);if(Ue(h.auth,s,Jn),(0,pe._isFirebaseServerApp)(h.auth.app))return Promise.reject(Te(h.auth));yield h.auth._initializationPromise;const m=Bn(h.auth,a);yield An(m,h.auth);const y=yield vl(h);return m._openRedirect(h.auth,s,"reauthViaRedirect",y)})).apply(this,arguments)}function yl(l,s,a){return function Zo(l,s,a){return ea.apply(this,arguments)}(l,s,a)}function ea(){return(ea=(0,v.A)(function*(l,s,a){const h=(0,Y.Ku)(l);Ue(h.auth,s,Jn),yield h.auth._initializationPromise;const m=Bn(h.auth,a);yield Ro(!1,h,s.providerId),yield An(m,h.auth);const y=yield vl(h);return m._openRedirect(h.auth,s,"linkViaRedirect",y)})).apply(this,arguments)}function Tu(){return(Tu=(0,v.A)(function*(l,s){return yield Qe(l)._initializationPromise,Os(l,s,!1)})).apply(this,arguments)}function Os(l,s){return wu.apply(this,arguments)}function wu(){return(wu=(0,v.A)(function*(l,s,a=!1){if((0,pe._isFirebaseServerApp)(l.app))return Promise.reject(Te(l));const h=Qe(l),m=Bn(h,s),w=yield new _u(h,m,a).execute();return w&&!a&&(delete w.user._redirectEventId,yield h._persistUserIfCurrent(w.user),yield h._setRedirectUser(null,s)),w})).apply(this,arguments)}function vl(l){return Ru.apply(this,arguments)}function Ru(){return(Ru=(0,v.A)(function*(l){const s=ws(`${l.uid}:::`);return l._redirectEventId=s,yield l.auth._setRedirectUser(l),yield l.auth._persistUserIfCurrent(l),s})).apply(this,arguments)}class ni{constructor(s){this.auth=s,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(s){this.consumers.add(s),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,s)&&(this.sendToConsumer(this.queuedRedirectEvent,s),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(s){this.consumers.delete(s)}onEvent(s){if(this.hasEventBeenHandled(s))return!1;let a=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(s,h)&&(a=!0,this.sendToConsumer(s,h),this.saveEventToCache(s))}),this.hasHandledPotentialRedirect||!function Al(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return El(l);default:return!1}}(s)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=s,a=!0)),a}sendToConsumer(s,a){var h;if(s.error&&!El(s)){const m=(null===(h=s.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";a.onError(Fe(this.auth,m))}else a.onAuthEvent(s)}isEventForConsumer(s,a){const h=null===a.eventId||!!s.eventId&&s.eventId===a.eventId;return a.filter.includes(s.type)&&h}hasEventBeenHandled(s){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Su(s))}saveEventToCache(s){this.cachedEventUids.add(Su(s)),this.lastProcessedEventTime=Date.now()}}function Su(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(s=>s).join("-")}function El({type:l,error:s}){return"unknown"===l&&"auth/no-auth-event"===s?.code}function qn(l){return ta.apply(this,arguments)}function ta(){return(ta=(0,v.A)(function*(l,s={}){return je(l,"GET","/v1/projects",s)})).apply(this,arguments)}const Ad=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Tl=/^https?/;function rr(){return(rr=(0,v.A)(function*(l){if(l.config.emulator)return;const{authorizedDomains:s}=yield qn(l);for(const a of s)try{if(ri(a))return}catch{}Ze(l,"unauthorized-domain")})).apply(this,arguments)}function ri(l){const s=mn(),{protocol:a,hostname:h}=new URL(s);if(l.startsWith("chrome-extension://")){const w=new URL(l);return""===w.hostname&&""===h?"chrome-extension:"===a&&l.replace("chrome-extension://","")===s.replace("chrome-extension://",""):"chrome-extension:"===a&&w.hostname===h}if(!Tl.test(a))return!1;if(Ad.test(l))return h===l;const m=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+m+"|"+m+")$","i").test(h)}const ii=new Dn(3e4,6e4);function ji(){const l=ge().___jsl;if(l?.H)for(const s of Object.keys(l.H))if(l.H[s].r=l.H[s].r||[],l.H[s].L=l.H[s].L||[],l.H[s].r=[...l.H[s].L],l.CP)for(let a=0;a<l.CP.length;a++)l.CP[a]=null}let zi=null;const Rl=new Dn(5e3,15e3),Sl="__/auth/iframe",Td="emulator/auth/iframe",Pl={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bl=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ra(l){const s=l.config;ne(s.authDomain,l,"auth-domain-config-required");const a=s.emulator?jn(s,Td):`https://${l.config.authDomain}/${Sl}`,h={apiKey:s.apiKey,appName:l.name,v:pe.SDK_VERSION},m=bl.get(l.config.apiHost);m&&(h.eid=m);const y=l._getFrameworks();return y.length&&(h.fw=y.join(",")),`${a}?${(0,Y.Am)(h).slice(1)}`}function bu(){return bu=(0,v.A)(function*(l){const s=yield function Pu(l){return zi=zi||function wl(l){return new Promise((s,a)=>{var h,m,y;function w(){ji(),gapi.load("gapi.iframes",{callback:()=>{s(gapi.iframes.getContext())},ontimeout:()=>{ji(),a(Fe(l,"network-request-failed"))},timeout:ii.get()})}if(null!==(m=null===(h=ge().gapi)||void 0===h?void 0:h.iframes)&&void 0!==m&&m.Iframe)s(gapi.iframes.getContext());else{if(null===(y=ge().gapi)||void 0===y||!y.load){const O=qa("iframefcb");return ge()[O]=()=>{gapi.load?w():a(Fe(l,"network-request-failed"))},mo(`${function Uh(){return ls.gapiScript}()}?onload=${O}`).catch(z=>a(z))}w()}}).catch(s=>{throw zi=null,s})}(l),zi}(l),a=ge().gapi;return ne(a,l,"internal-error"),s.open({where:document.body,url:ra(l),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Pl,dontclear:!0},h=>new Promise(function(){var m=(0,v.A)(function*(y,w){yield h.restyle({setHideOnLeave:!1});const O=Fe(l,"network-request-failed"),z=ge().setTimeout(()=>{w(O)},Rl.get());function oe(){ge().clearTimeout(z),y(h)}h.ping(oe).then(oe,()=>{w(O)})});return function(y,w){return m.apply(this,arguments)}}()))}),bu.apply(this,arguments)}const si={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class xl{constructor(s){this.window=s,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const Pr="__/auth/handler",Dl="emulator/auth/handler",Vl=encodeURIComponent("fac");function ia(l,s,a,h,m,y){return Cu.apply(this,arguments)}function Cu(){return(Cu=(0,v.A)(function*(l,s,a,h,m,y){ne(l.config.authDomain,l,"auth-domain-config-required"),ne(l.config.apiKey,l,"invalid-api-key");const w={apiKey:l.config.apiKey,appName:l.name,authType:a,redirectUrl:h,v:pe.SDK_VERSION,eventId:m};if(s instanceof Jn){s.setDefaultLanguage(l.languageCode),w.providerId=s.providerId||"",(0,Y.Im)(s.getCustomParameters())||(w.customParameters=JSON.stringify(s.getCustomParameters()));for(const[he,le]of Object.entries(y||{}))w[he]=le}if(s instanceof Di){const he=s.getScopes().filter(le=>""!==le);he.length>0&&(w.scopes=he.join(","))}l.tenantId&&(w.tid=l.tenantId);const O=w;for(const he of Object.keys(O))void 0===O[he]&&delete O[he];const z=yield l._getAppCheckToken(),oe=z?`#${Vl}=${encodeURIComponent(z)}`:"";return`${function xu({config:l}){return l.emulator?jn(l,Dl):`https://${l.authDomain}/${Pr}`}(l)}?${(0,Y.Am)(O).slice(1)}${oe}`})).apply(this,arguments)}const Fs="webStorageSupport",sa=class Nl{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xt,this._completeRedirectFn=Os,this._overrideRedirectResult=Ns}_openPopup(s,a,h,m){var y=this;return(0,v.A)(function*(){var w;At(null===(w=y.eventManagers[s._key()])||void 0===w?void 0:w.manager,"_initialize() not called before _openPopup()");const O=yield ia(s,a,h,mn(),m);return function Ms(l,s,a,h=500,m=600){const y=Math.max((window.screen.availHeight-m)/2,0).toString(),w=Math.max((window.screen.availWidth-h)/2,0).toString();let O="";const z=Object.assign(Object.assign({},si),{width:h.toString(),height:m.toString(),top:y,left:w}),oe=(0,Y.ZQ)().toLowerCase();a&&(O=Hn(oe)?"_blank":a),kn(oe)&&(s=s||"http://localhost",z.scrollbars="yes");const he=Object.entries(z).reduce((Ye,[cn,Js])=>`${Ye}${cn}=${Js},`,"");if(function L(l=(0,Y.ZQ)()){var s;return He(l)&&!(null===(s=window.navigator)||void 0===s||!s.standalone)}(oe)&&"_self"!==O)return function oi(l,s){const a=document.createElement("a");a.href=l,a.target=s;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(h)}(s||"",O),new xl(null);const le=window.open(s||"",O,he);ne(le,l,"popup-blocked");try{le.focus()}catch{}return new xl(le)}(s,O,ws())})()}_openRedirect(s,a,h,m){var y=this;return(0,v.A)(function*(){return yield y._originValidation(s),function ld(l){ge().location.href=l}(yield ia(s,a,h,mn(),m)),new Promise(()=>{})})()}_initialize(s){const a=s._key();if(this.eventManagers[a]){const{manager:m,promise:y}=this.eventManagers[a];return m?Promise.resolve(m):(At(y,"If manager is not set, promise should be"),y)}const h=this.initAndGetManager(s);return this.eventManagers[a]={promise:h},h.catch(()=>{delete this.eventManagers[a]}),h}initAndGetManager(s){var a=this;return(0,v.A)(function*(){const h=yield function Ls(l){return bu.apply(this,arguments)}(s),m=new ni(s);return h.register("authEvent",y=>(ne(y?.authEvent,s,"invalid-auth-event"),{status:m.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[s._key()]={manager:m},a.iframes[s._key()]=h,m})()}_isIframeWebStorageSupported(s,a){this.iframes[s._key()].send(Fs,{type:Fs},m=>{var y;const w=null===(y=m?.[0])||void 0===y?void 0:y[Fs];void 0!==w&&a(!!w),Ze(s,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function na(l){return rr.apply(this,arguments)}(s)),this.originValidationPromises[a]}get _shouldInitProactively(){return G()||ct()||He()}};class oa{constructor(s){this.factorId=s}_process(s,a,h){switch(a.type){case"enroll":return this._finalizeEnroll(s,a.credential,h);case"signin":return this._finalizeSignIn(s,a.credential);default:return Et("unexpected MultiFactorSessionType")}}}class aa extends oa{constructor(s){super("phone"),this.credential=s}static _fromCredential(s){return new aa(s)}_finalizeEnroll(s,a,h){return function Oo(l,s){return je(l,"POST","/v2/accounts/mfaEnrollment:finalize",Be(l,s))}(s,{idToken:a,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(s,a){return function fd(l,s){return je(l,"POST","/v2/accounts/mfaSignIn:finalize",Be(l,s))}(s,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let ua=(()=>{class l{constructor(){}static assertion(a){return aa._fromCredential(a)}}return l.FACTOR_ID="phone",l})();var Du="@firebase/auth";class qs{constructor(s){this.auth=s,this.internalListeners=new Map}getUid(){var s;return this.assertAuthConfigured(),(null===(s=this.auth.currentUser)||void 0===s?void 0:s.uid)||null}getToken(s){var a=this;return(0,v.A)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(s)}:null})()}addAuthTokenListener(s){if(this.assertAuthConfigured(),this.internalListeners.has(s))return;const a=this.auth.onIdTokenChanged(h=>{s(h?.stsTokenManager.accessToken||null)});this.internalListeners.set(s,a),this.updateProactiveRefresh()}removeAuthTokenListener(s){this.assertAuthConfigured();const a=this.internalListeners.get(s);a&&(this.internalListeners.delete(s),a(),this.updateProactiveRefresh())}assertAuthConfigured(){ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Qt(){return window}(0,Y.XA)("authIdTokenMaxAge"),function Mh(l){ls=l}({loadJS:l=>new Promise((s,a)=>{const h=document.createElement("script");h.setAttribute("src",l),h.onload=s,h.onerror=m=>{const y=Fe("internal-error");y.customData=m,a(y)},h.type="text/javascript",h.charset="UTF-8",function Ll(){var l,s;return null!==(s=null===(l=document.getElementsByTagName("head"))||void 0===l?void 0:l[0])&&void 0!==s?s:document}().appendChild(h)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function kl(l){(0,pe._registerComponent)(new Dt.uA("auth",(s,{options:a})=>{const h=s.getProvider("app").getImmediate(),m=s.getProvider("heartbeat"),y=s.getProvider("app-check-internal"),{apiKey:w,authDomain:O}=h.options;ne(w&&!w.includes(":"),"invalid-api-key",{appName:h.name});const z={apiKey:w,authDomain:O,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ee(l)},oe=new Fr(h,m,y,z);return function Pi(l,s){const a=s?.persistence||[],h=(Array.isArray(a)?a:[a]).map(xe);s?.errorMap&&l._updateErrorMap(s.errorMap),l._initializeWithPersistence(h,s?.popupRedirectResolver)}(oe,a),oe},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((s,a,h)=>{s.getProvider("auth-internal").initialize()})),(0,pe._registerComponent)(new Dt.uA("auth-internal",s=>{const a=Qe(s.getProvider("auth").getImmediate());return new qs(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,pe.registerVersion)(Du,"1.7.8",function Gi(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(l)),(0,pe.registerVersion)(Du,"1.7.8","esm2017")}("Browser");function ir(){return ir=(0,v.A)(function*(l,s,a){var h;const{BuildInfo:m}=Qt();At(s.sessionId,"AuthEvent did not contain a session ID");const y=yield function Ul(l){return ku.apply(this,arguments)}(s.sessionId),w={};return He()?w.ibi=m.packageName:vn()?w.apn=m.packageName:Ze(l,"operation-not-supported-in-this-environment"),m.displayName&&(w.appDisplayName=m.displayName),w.sessionId=y,ia(l,a,s.type,void 0,null!==(h=s.eventId)&&void 0!==h?h:void 0,w)}),ir.apply(this,arguments)}function br(){return(br=(0,v.A)(function*(l){const{BuildInfo:s}=Qt(),a={};He()?a.iosBundleId=s.packageName:vn()?a.androidPackageName=s.packageName:Ze(l,"operation-not-supported-in-this-environment"),yield qn(l,a)})).apply(this,arguments)}function ha(){return(ha=(0,v.A)(function*(l,s,a){const{cordova:h}=Qt();let m=()=>{};try{yield new Promise((y,w)=>{let O=null;function z(){var le;y();const Ye=null===(le=h.plugins.browsertab)||void 0===le?void 0:le.close;"function"==typeof Ye&&Ye(),"function"==typeof a?.close&&a.close()}function oe(){O||(O=window.setTimeout(()=>{w(Fe(l,"redirect-cancelled-by-user"))},2e3))}function he(){"visible"===document?.visibilityState&&oe()}s.addPassiveListener(z),document.addEventListener("resume",oe,!1),vn()&&document.addEventListener("visibilitychange",he,!1),m=()=>{s.removePassiveListener(z),document.removeEventListener("resume",oe,!1),document.removeEventListener("visibilitychange",he,!1),O&&window.clearTimeout(O)}})}finally{m()}})).apply(this,arguments)}function ku(){return(ku=(0,v.A)(function*(l){const s=function Bl(l){if(At(/[0-9a-zA-Z]+/.test(l),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(l);const s=new ArrayBuffer(l.length),a=new Uint8Array(s);for(let h=0;h<l.length;h++)a[h]=l.charCodeAt(h);return a}(l),a=yield crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(m=>m.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class da extends ni{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(s=>{this.resolveInitialized=s})}addPassiveListener(s){this.passiveListeners.add(s)}removePassiveListener(s){this.passiveListeners.delete(s)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(s){return this.resolveInitialized(),this.passiveListeners.forEach(a=>a(s)),super.onEvent(s)}initialized(){var s=this;return(0,v.A)(function*(){yield s.initPromise})()}}function Ou(l){return Lu.apply(this,arguments)}function Lu(){return(Lu=(0,v.A)(function*(l){const s=yield ci()._get(fa(l));return s&&(yield ci()._remove(fa(l))),s})).apply(this,arguments)}function ui(){const l=[];for(let a=0;a<20;a++){const h=Math.floor(62*Math.random());l.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(h))}return l.join("")}function ci(){return xe(Rr)}function fa(l){return _t("authEvent",l.config.apiKey,l.name)}function Ks(l){if(!l?.includes("?"))return{};const[s,...a]=l.split("?");return(0,Y.I9)(a.join("?"))}const kd=class Nd{constructor(){this._redirectPersistence=xt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Os,this._overrideRedirectResult=Ns}_initialize(s){var a=this;return(0,v.A)(function*(){const h=s._key();let m=a.eventManagers.get(h);return m||(m=new da(s),a.eventManagers.set(h,m),a.attachCallbackListeners(s,m)),m})()}_openPopup(s){Ze(s,"operation-not-supported-in-this-environment")}_openRedirect(s,a,h,m){var y=this;return(0,v.A)(function*(){!function bd(l){var s,a,h,m,y,w,O,z,oe,he;const le=Qt();ne("function"==typeof(null===(s=le?.universalLinks)||void 0===s?void 0:s.subscribe),l,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),ne(typeof(null===(a=le?.BuildInfo)||void 0===a?void 0:a.packageName)<"u",l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),ne("function"==typeof(null===(y=null===(m=null===(h=le?.cordova)||void 0===h?void 0:h.plugins)||void 0===m?void 0:m.browsertab)||void 0===y?void 0:y.openUrl),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ne("function"==typeof(null===(z=null===(O=null===(w=le?.cordova)||void 0===w?void 0:w.plugins)||void 0===O?void 0:O.browsertab)||void 0===z?void 0:z.isAvailable),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ne("function"==typeof(null===(he=null===(oe=le?.cordova)||void 0===oe?void 0:oe.InAppBrowser)||void 0===he?void 0:he.open),l,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(s);const w=yield y._initialize(s);yield w.initialized(),w.resetRedirect(),function gl(){ei.clear()}(),yield y._originValidation(s);const O=function ql(l,s,a=null){return{type:s,eventId:a,urlResponse:null,sessionId:ui(),postBody:null,tenantId:l.tenantId,error:Fe(l,"no-auth-event")}}(s,h,m);yield function xd(l,s){return ci()._set(fa(l),s)}(s,O);const z=yield function Ml(l,s,a){return ir.apply(this,arguments)}(s,O,a),oe=yield function Fl(l){const{cordova:s}=Qt();return new Promise(a=>{s.plugins.browsertab.isAvailable(h=>{let m=null;h?s.plugins.browsertab.openUrl(l):m=s.InAppBrowser.open(l,function K(l=(0,Y.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(l)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(l)}()?"_blank":"_system","location=yes"),a(m)})})}(z);return function Cr(l,s,a){return ha.apply(this,arguments)}(s,w,oe)})()}_isIframeWebStorageSupported(s,a){throw new Error("Method not implemented.")}_originValidation(s){const a=s._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Pd(l){return br.apply(this,arguments)}(s)),this.originValidationPromises[a]}attachCallbackListeners(s,a){const{universalLinks:h,handleOpenURL:m,BuildInfo:y}=Qt(),w=setTimeout((0,v.A)(function*(){yield Ou(s),a.onEvent(pa())}),500),O=function(){var he=(0,v.A)(function*(le){clearTimeout(w);const Ye=yield Ou(s);let cn=null;Ye&&le?.url&&(cn=function Kl(l,s){var a,h;const m=function Dd(l){const s=Ks(l),a=s.link?decodeURIComponent(s.link):void 0,h=Ks(a).link,m=s.deep_link_id?decodeURIComponent(s.deep_link_id):void 0;return Ks(m).link||m||h||a||l}(s);if(m.includes("/__/auth/callback")){const y=Ks(m),w=y.firebaseError?function jl(l){try{return JSON.parse(l)}catch{return null}}(decodeURIComponent(y.firebaseError)):null,O=null===(h=null===(a=w?.code)||void 0===a?void 0:a.split("auth/"))||void 0===h?void 0:h[1],z=O?Fe(O):null;return z?{type:l.type,eventId:l.eventId,tenantId:l.tenantId,error:z,urlResponse:null,sessionId:null,postBody:null}:{type:l.type,eventId:l.eventId,tenantId:l.tenantId,sessionId:l.sessionId,urlResponse:m,postBody:null}}return null}(Ye,le.url)),a.onEvent(cn||pa())});return function(Ye){return he.apply(this,arguments)}}();typeof h<"u"&&"function"==typeof h.subscribe&&h.subscribe(null,O);const z=m,oe=`${y.packageName.toLowerCase()}://`;Qt().handleOpenURL=function(){var he=(0,v.A)(function*(le){if(le.toLowerCase().startsWith(oe)&&O({url:le}),"function"==typeof z)try{z(le)}catch(Ye){console.error(Ye)}});return function(le){return he.apply(this,arguments)}}()}};function pa(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Fe("no-auth-event")}}function js(){var l;return(null===(l=self?.location)||void 0===l?void 0:l.protocol)||null}function zl(l=(0,Y.ZQ)()){return!("file:"!==js()&&"ionic:"!==js()&&"capacitor:"!==js()||!l.toLowerCase().match(/iphone|ipad|ipod|android/))}function _a(){try{const l=self.localStorage,s=ws();if(l)return l.setItem(s,"1"),l.removeItem(s),!function Gl(l=(0,Y.ZQ)()){return function ga(){return(0,Y.lT)()&&11===document?.documentMode}()||function Fd(l=(0,Y.ZQ)()){return/Edge\/\d+/.test(l)}(l)}()||(0,Y.zW)()}catch{return zs()&&(0,Y.zW)()}return!1}function zs(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function li(){return(function Mu(){return"http:"===js()||"https:"===js()}()||(0,Y.sr)()||zl())&&!function ma(){return(0,Y.lV)()||(0,Y.Ll)()}()&&_a()&&!zs()}function Gs(){return zl()&&typeof document<"u"}function Ws(){return(Ws=(0,v.A)(function*(){return!!Gs()&&new Promise(l=>{const s=setTimeout(()=>{l(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(s),l(!0)})})})).apply(this,arguments)}const Jt={LOCAL:"local",NONE:"none",SESSION:"session"},$s=ne,Uu="persistence";function Hs(l){return Bu.apply(this,arguments)}function Bu(){return(Bu=(0,v.A)(function*(l){yield l._initializationPromise;const s=Hl(),a=_t(Uu,l.config.apiKey,l.name);s&&s.setItem(a,l._getPersistence())})).apply(this,arguments)}function Hl(){var l;try{return(null===(l=function Ud(){return typeof window<"u"?window:null}())||void 0===l?void 0:l.sessionStorage)||null}catch{return null}}const Ql=ne;class xr{constructor(){this.browserResolver=xe(sa),this.cordovaResolver=xe(kd),this.underlyingResolver=null,this._redirectPersistence=xt,this._completeRedirectFn=Os,this._overrideRedirectResult=Ns}_initialize(s){var a=this;return(0,v.A)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(s)})()}_openPopup(s,a,h,m){var y=this;return(0,v.A)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openPopup(s,a,h,m)})()}_openRedirect(s,a,h,m){var y=this;return(0,v.A)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openRedirect(s,a,h,m)})()}_isIframeWebStorageSupported(s,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(s,a)}_originValidation(s){return this.assertedUnderlyingResolver._originValidation(s)}get _shouldInitProactively(){return Gs()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ql(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var s=this;return(0,v.A)(function*(){if(s.underlyingResolver)return;const a=yield function Fu(){return Ws.apply(this,arguments)}();s.underlyingResolver=a?s.cordovaResolver:s.browserResolver})()}}function hi(l){return l.unwrap()}function qu(l){return Ku(l)}function Ku(l){const{_tokenResponse:s}=l instanceof Y.g?l.customData:l;if(!s)return null;if(!(l instanceof Y.g)&&"temporaryProof"in s&&"phoneNumber"in s)return nr.credentialFromResult(l);const a=s.providerId;if(!a||a===$e.PASSWORD)return null;let h;switch(a){case $e.GOOGLE:h=kc;break;case $e.FACEBOOK:h=Xa;break;case $e.GITHUB:h=Za;break;case $e.TWITTER:h=Ao;break;default:const{oauthIdToken:m,oauthAccessToken:y,oauthTokenSecret:w,pendingToken:O,nonce:z}=s;return y||w||m||O?O?a.startsWith("saml.")?vr._create(a,O):Tt._fromParams({providerId:a,signInMethod:a,pendingToken:O,idToken:m,accessToken:y}):new Vi(a).credential({idToken:m,accessToken:y,rawNonce:z}):null}return l instanceof Y.g?h.credentialFromError(l):h.credentialFromResult(l)}function qt(l,s){return s.catch(a=>{throw a instanceof Y.g&&function ya(l,s){var a;const h=null===(a=s.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===s?.code)s.resolver=new zu(l,function Zc(l,s){var a;const h=(0,Y.Ku)(l),m=s;return ne(s.customData.operationType,h,"argument-error"),ne(null===(a=m.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,h,"argument-error"),ko._fromError(h,m)}(l,s));else if(h){const m=Ku(s),y=s;m&&(y.credential=m,y.tenantId=h.tenantId||void 0,y.email=h.email||void 0,y.phoneNumber=h.phoneNumber||void 0)}}(l,a),a}).then(a=>{const m=a.user;return{operationType:a.operationType,credential:qu(a),additionalUserInfo:nd(a),user:sr.getOrCreate(m)}})}function Ia(l,s){return ju.apply(this,arguments)}function ju(){return(ju=(0,v.A)(function*(l,s){const a=yield s;return{verificationId:a.verificationId,confirm:h=>qt(l,a.confirm(h))}})).apply(this,arguments)}class zu{constructor(s,a){this.resolver=a,this.auth=function $i(l){return l.wrapped()}(s)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(s){return qt(hi(this.auth),this.resolver.resolveSignIn(s))}}class sr{constructor(s){this._delegate=s,this.multiFactor=function tl(l){const s=(0,Y.Ku)(l);return Mo.has(s)||Mo.set(s,Hr._fromUser(s)),Mo.get(s)}(s)}static getOrCreate(s){return sr.USER_MAP.has(s)||sr.USER_MAP.set(s,new sr(s)),sr.USER_MAP.get(s)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(s){return this._delegate.getIdTokenResult(s)}getIdToken(s){return this._delegate.getIdToken(s)}linkAndRetrieveDataWithCredential(s){return this.linkWithCredential(s)}linkWithCredential(s){var a=this;return(0,v.A)(function*(){return qt(a.auth,ki(a._delegate,s))})()}linkWithPhoneNumber(s,a){var h=this;return(0,v.A)(function*(){return Ia(h.auth,function Wo(l,s,a){return $o.apply(this,arguments)}(h._delegate,s,a))})()}linkWithPopup(s){var a=this;return(0,v.A)(function*(){return qt(a.auth,function Ki(l,s,a){return Yo.apply(this,arguments)}(a._delegate,s,xr))})()}linkWithRedirect(s){var a=this;return(0,v.A)(function*(){return yield Hs(Qe(a.auth)),yl(a._delegate,s,xr)})()}reauthenticateAndRetrieveDataWithCredential(s){return this.reauthenticateWithCredential(s)}reauthenticateWithCredential(s){var a=this;return(0,v.A)(function*(){return qt(a.auth,Yn(a._delegate,s))})()}reauthenticateWithPhoneNumber(s,a){return Ia(this.auth,function gd(l,s,a){return Ho.apply(this,arguments)}(this._delegate,s,a))}reauthenticateWithPopup(s){return qt(this.auth,function vd(l,s,a){return Vs.apply(this,arguments)}(this._delegate,s,xr))}reauthenticateWithRedirect(s){var a=this;return(0,v.A)(function*(){return yield Hs(Qe(a.auth)),ks(a._delegate,s,xr)})()}sendEmailVerification(s){return function Gc(l,s){return Ve.apply(this,arguments)}(this._delegate,s)}unlink(s){var a=this;return(0,v.A)(function*(){return yield function Mc(l,s){return Er.apply(this,arguments)}(a._delegate,s),a})()}updateEmail(s){return function $c(l,s){const a=(0,Y.Ku)(l);return(0,pe._isFirebaseServerApp)(a.auth.app)?Promise.reject(Te(a.auth)):su(a,s,null)}(this._delegate,s)}updatePassword(s){return function Hc(l,s){return su((0,Y.Ku)(l),null,s)}(this._delegate,s)}updatePhoneNumber(s){return function Ds(l,s){return Zr.apply(this,arguments)}(this._delegate,s)}updateProfile(s){return function Wc(l,s){return Es.apply(this,arguments)}(this._delegate,s)}verifyBeforeUpdateEmail(s,a){return function Ge(l,s,a){return Ar.apply(this,arguments)}(this._delegate,s,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}sr.USER_MAP=new WeakMap;const di=ne;let Gu=(()=>{class l{constructor(a,h){if(this.app=a,h.isInitialized())return this._delegate=h.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:m}=a.options;di(m,"invalid-api-key",{appName:a.name}),di(m,"invalid-api-key",{appName:a.name});const y=typeof window<"u"?xr:void 0;this._delegate=h.initialize({options:{persistence:$u(m,a.name),popupRedirectResolver:y}}),this._delegate._updateErrorMap(Vt),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?sr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,h){!function go(l,s,a){const h=Qe(l);ne(h._canInitEmulator,h,"emulator-config-failed"),ne(/^https?:\/\//.test(s),h,"invalid-emulator-scheme");const m=!!a?.disableWarnings,y=gr(s),{host:w,port:O}=function qh(l){const s=gr(l),a=/(\/\/)?([^?#/]+)/.exec(l.substr(s.length));if(!a)return{host:"",port:null};const h=a[2].split("@").pop()||"",m=/^(\[[^\]]+\])(:|$)/.exec(h);if(m){const y=m[1];return{host:y,port:_r(h.substr(y.length+1))}}{const[y,w]=h.split(":");return{host:y,port:_r(w)}}}(s);h.config.emulator={url:`${y}//${w}${null===O?"":`:${O}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:w,port:O,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:m})}),m||function Kh(){function l(){const s=document.createElement("p"),a=s.style;s.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",s.classList.add("firebase-emulator-warning"),document.body.appendChild(s)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",l):l())}()}(this._delegate,a,h)}applyActionCode(a){return function Uc(l,s){return Li.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return ys(this._delegate,a)}confirmPasswordReset(a,h){return function _s(l,s,a){return Co.apply(this,arguments)}(this._delegate,a,h)}createUserWithEmailAndPassword(a,h){var m=this;return(0,v.A)(function*(){return qt(m._delegate,function Yh(l,s,a){return nu.apply(this,arguments)}(m._delegate,a,h))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function Is(l,s){return ru.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function jc(l,s){const a=ps.parseLink(s);return"EMAIL_SIGNIN"===a?.operation}(0,a)}getRedirectResult(){var a=this;return(0,v.A)(function*(){di(li(),a._delegate,"operation-not-supported-in-this-environment");const h=yield function Il(l,s){return Tu.apply(this,arguments)}(a._delegate,xr);return h?qt(a._delegate,Promise.resolve(h)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function bt(l,s){Qe(l)._logFramework(s)}(this._delegate,a)}onAuthStateChanged(a,h,m){const{next:y,error:w,complete:O}=Wu(a,h,m);return this._delegate.onAuthStateChanged(y,w,O)}onIdTokenChanged(a,h,m){const{next:y,error:w,complete:O}=Wu(a,h,m);return this._delegate.onIdTokenChanged(y,w,O)}sendSignInLinkToEmail(a,h){return function Kc(l,s,a){return Rt.apply(this,arguments)}(this._delegate,a,h)}sendPasswordResetEmail(a,h){return function Wr(l,s,a){return gs.apply(this,arguments)}(this._delegate,a,h||void 0)}setPersistence(a){var h=this;return(0,v.A)(function*(){let m;switch(function Wl(l,s){$s(Object.values(Jt).includes(s),l,"invalid-persistence-type"),(0,Y.lV)()?$s(s!==Jt.SESSION,l,"unsupported-persistence-type"):(0,Y.Ll)()?$s(s===Jt.NONE,l,"unsupported-persistence-type"):zs()?$s(s===Jt.NONE||s===Jt.LOCAL&&(0,Y.zW)(),l,"unsupported-persistence-type"):$s(s===Jt.NONE||_a(),l,"unsupported-persistence-type")}(h._delegate,a),a){case Jt.SESSION:m=xt;break;case Jt.LOCAL:m=(yield xe(Zn)._isAvailable())?Zn:Rr;break;case Jt.NONE:m=et;break;default:return Ze("argument-error",{appName:h._delegate.name})}return h._delegate.setPersistence(m)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return qt(this._delegate,function Lc(l){return We.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return qt(this._delegate,zr(this._delegate,a))}signInWithCustomToken(a){return qt(this._delegate,function Mn(l,s){return Gr.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,h){return qt(this._delegate,function qc(l,s,a){return(0,pe._isFirebaseServerApp)(l.app)?Promise.reject(Te(l)):zr((0,Y.Ku)(l),Ya.credential(s,a)).catch(function(){var h=(0,v.A)(function*(m){throw"auth/password-does-not-meet-requirements"===m.code&&ms(l),m});return function(m){return h.apply(this,arguments)}}())}(this._delegate,a,h))}signInWithEmailLink(a,h){return qt(this._delegate,function it(l,s,a){return Fn.apply(this,arguments)}(this._delegate,a,h))}signInWithPhoneNumber(a,h){return Ia(this._delegate,function dl(l,s,a){return Go.apply(this,arguments)}(this._delegate,a,h))}signInWithPopup(a){var h=this;return(0,v.A)(function*(){return di(li(),h._delegate,"operation-not-supported-in-this-environment"),qt(h._delegate,function Id(l,s,a){return mu.apply(this,arguments)}(h._delegate,a,xr))})()}signInWithRedirect(a){var h=this;return(0,v.A)(function*(){return di(li(),h._delegate,"operation-not-supported-in-this-environment"),yield Hs(h._delegate),_l(h._delegate,a,xr)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function Bc(l,s){return xo.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return l.Persistence=Jt,l})();function Wu(l,s,a){let h=l;"function"!=typeof l&&({next:h,error:s,complete:a}=l);const m=h;return{next:w=>m(w&&sr.getOrCreate(w)),error:s,complete:a}}function $u(l,s){const a=function $l(l,s){const a=Hl();if(!a)return[];const h=_t(Uu,l,s);switch(a.getItem(h)){case Jt.NONE:return[et];case Jt.LOCAL:return[Zn,xt];case Jt.SESSION:return[xt];default:return[]}}(l,s);if(typeof self<"u"&&!a.includes(Zn)&&a.push(Zn),typeof window<"u")for(const h of[Rr,xt])a.includes(h)||a.push(h);return a.includes(et)||a.push(et),a}class Hi{constructor(){this.providerId="phone",this._delegate=new nr(hi(Re.A.auth()))}static credential(s,a){return nr.credential(s,a)}verifyPhoneNumber(s,a){return this._delegate.verifyPhoneNumber(s,a)}unwrap(){return this._delegate}}Hi.PHONE_SIGN_IN_METHOD=nr.PHONE_SIGN_IN_METHOD,Hi.PROVIDER_ID=nr.PROVIDER_ID;const Qs=ne;class va{constructor(s,a,h=Re.A.app()){var m;Qs(null===(m=h.options)||void 0===m?void 0:m.apiKey,"invalid-api-key",{appName:h.name}),this._delegate=new md(h.auth(),s,a),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Qu(l){l.INTERNAL.registerComponent(new Dt.uA("auth-compat",s=>{const a=s.getProvider("app-compat").getImmediate(),h=s.getProvider("auth");return new Gu(a,h)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Ya,FacebookAuthProvider:Xa,GithubAuthProvider:Za,GoogleAuthProvider:kc,OAuthProvider:Vi,SAMLAuthProvider:Eo,PhoneAuthProvider:Hi,PhoneMultiFactorGenerator:ua,RecaptchaVerifier:va,TwitterAuthProvider:Ao,Auth:Gu,AuthCredential:Rn,Error:Y.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),l.registerVersion("@firebase/auth-compat","0.5.13")}(Re.A)}}]);